<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); 
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title"> Les principales actualités des dernières 24 heures

</div>    
        <div class="header-subtitle"> Dernière mise à jour : 28/06/2025 - 12h24</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '0', 'title': "Le temps qu'il fera ce samedi 28 juin 2025", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/430420-le-temps-quil-fera-ce-samedi-28-juin-2025.html', 'summary': "Le temps qu'il fera ce samedi 28 juin 2025. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le samedi 28 juin 2025 – Temps chaud à localement très chaud sur les côtes et les plaines Nord et Centre, les régions de l’Anti-Atlas, l’extrême Sud-Est et l’intérieur des provinces Sud. – Foyers orageux avec ondées ou averses sur les régions . ", 'size': 2}, {'id': '121', 'title': 'Les prévisions du samedi 28 juin', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/les-previsions-du-samedi-28-juin-305620/', 'summary': 'Les prévisions du samedi 28 juin. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le samedi 28 juin 2025. -Temps chaud à localement très chaud sur les côtes et les plaines Nord et Centre, les régions de l’Anti-Atlas, l’extrême Sud-Est et l’intérieur des provinces Sud. -Foyers orageux avec ondées ou averses', 'size': 2}], 'main_title': "Le temps qu'il fera ce samedi 28 juin 2025"}, {'community_id': '7', 'articles': [{'id': '3', 'title': "CHAN 2024 : le Maroc disputera son premier match contre l'Angola, le 3 août à Nairobi", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/430845-chan-2024-le-maroc-disputera-son-premier-match-contre-langola-le-3-aout-a-nairobi.html', 'summary': "CHAN 2024 : le Maroc disputera son premier match contre l'Angola, le 3 août à Nairobi. Le Maroc disputera son premier match contre l’Angola, le 3 août au stade Nyayo à Nairobi dans le cadre du Championnat d’Afrique des Nations CAF TotalEnergies (CHAN), prévu du 2 au 30 août 2025 au Kenya, Ouganda et Tanzanie. La sélection marocaine, qui évoluera dans le groupe A, affrontera son homologue kényane le 10 août . ", 'size': 2}, {'id': '133', 'title': 'CHAN 2024: le Maroc disputera son premier match contre l’Angola, le 3 août au stade Nyayo à Nairobi', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/chan-2024-le-maroc-disputera-son-premier-match-contre-langola-le-3-aout-au-stade-nyayo-a-nairobi/', 'summary': 'CHAN 2024: le Maroc disputera son premier match contre l’Angola, le 3 août au stade Nyayo à Nairobi. Le Maroc disputera son premier match contre l’Angola, le 3 août au stade Nyayo à Nairobi dans le cadre du Championnat d’Afrique des Nations CAF TotalEnergies (CHAN), prévu du 2 au 30 août 2025 au Kenya, Ouganda et Tanzanie. La sélection marocaine, qui évoluera dans le groupe A, affrontera son homologue kényane le 10 août .', 'size': 2}], 'main_title': "CHAN 2024 : le Maroc disputera son premier match contre l'Angola, le 3 août à Nairobi"}, {'community_id': '6', 'articles': [{'id': '12', 'title': 'Ni l’Union Européenne, ni aucun de ses États membres ne reconnaissent la pseudo "rasd" (porte-parole de l\'UE)', 'source': 'lematin.ma', 'link': 'https://lematin.ma/nation/ni-lue-ni-aucun-de-ses-etats-membres-ne-reconnaissent-la-pseudo-rasd/288016', 'summary': 'Ni l’Union Européenne, ni aucun de ses États membres ne reconnaissent la pseudo "rasd" (porte-parole de l\'UE). Cette déclaration est intervenue alors que certains relais séparatistes sur-communiquaient au sujet de la réunion ministérielle Union Européenne-Union Africaine, qui se tient ce ve.', 'size': 3}, {'id': '17', 'title': 'Réunion ministérielle UE-UA : Bruxelles dément avoir invité le Polisario', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Reunion-ministerielle-UE-UA-Bruxelles-dement-avoir-invite-le-Polisario_a69250.html', 'summary': 'Réunion ministérielle UE-UA : Bruxelles dément avoir invité le Polisario. Le porte-parole de l’Union Européenne (UE) pour les Affaires étrangères a réaffirmé, vendredi, que "ni l’UE, ni aucun de ses États membres ne reconnaissent la +rasd+".', 'size': 3}, {'id': '81', 'title': 'L’UE réaffirme ne pas reconnaître la pseudo «\xa0rasd\xa0»', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/lue-reaffirme-ne-pas-reconnaitre-la-pseudo-rasd/', 'summary': 'L’UE réaffirme ne pas reconnaître la pseudo « rasd ». Le porte-parole de l’Union Européenne (UE) pour les Affaires étrangères a réaffirmé, vendredi, que « ni l’UE, ni aucun de ses États membres ne reconnaissent la +rasd+ ». Cette déclaration est intervenue alors que certains relais séparatistes sur-communiquaient au sujet de la réunion ministérielle Union Européenne-Union Africaine, qui se tient ce vendredi à Rome. Rappelant que les .', 'size': 4}, {'id': '86', 'title': 'Porte-parole de l’UE: «\xa0ni l’Union Européenne, ni aucun de ses États membres ne reconnaissent\xa0» la pseudo «\xa0rasd\xa0»', 'source': 'atlasinfo.fr', 'link': 'https://atlasinfo.fr/porte-parole-de-lue-ni-lunion-europeenne-ni-aucun-de-ses-etats-membres-ne-reconnaissent-la-pseudo-rasd.html', 'summary': 'Porte-parole de l’UE: « ni l’Union Européenne, ni aucun de ses États membres ne reconnaissent » la pseudo « rasd ». Le porte-parole de l’Union Européenne (UE) pour les Affaires étrangères a réaffirmé, vendredi, que « ni l’UE, ni aucun de ses États membres ne reconnaissent la +rasd+ » du Polisario. Cette déclaration est intervenue alors que certains relais séparatistes sur-communiquaient au sujet de la réunion ministérielle Union Européenne-Union Africaine, qui se tient ce vendredi à Rome. Rappelant . L’article est apparu en premier sur .', 'size': 4}], 'main_title': 'L’UE réaffirme ne pas reconnaître la pseudo «\xa0rasd\xa0»'}, {'community_id': '1', 'articles': [{'id': '67', 'title': 'Mondial des Clubs : Fin de parcours pour le Wydad', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/videos/mondial-des-clubs-fin-de-parcours-pour-le-wydad/', 'summary': 'Mondial des Clubs : Fin de parcours pour le Wydad. Le Wydad casablancais a quitté la compétition dès la phase de groupes. Après deux défaites face à Manchester City et à la Juventus, le club marocain s’est incliné lors du 3e match contre Al Aïn (2-1), jeudi à Washington.', 'size': 2}, {'id': '90', 'title': 'Coupe du monde des clubs : Le Wydad Casablanca conclut sa campagne par une défaite', 'source': 'lnt.ma', 'link': 'https://lnt.ma/coupe-du-monde-des-clubs-le-wydad-casablanca-conclut-sa-campagne-par-une-defaite/', 'summary': 'Coupe du monde des clubs : Le Wydad Casablanca conclut sa campagne par une défaite. Le Wydad Casablanca a clôturé sa participation à la première édition élargie de la Coupe du monde des clubs (32 équipes) par une nouvelle défaite, cette fois face à la formation émiratie d’Al Aïn, sur le score de 2 à 1, jeudi au stade Audi Field de Washington, dans le cadre de la troisième et . ', 'size': 2}], 'main_title': 'Mondial des Clubs : Fin de parcours pour le Wydad'}, {'community_id': '5', 'articles': [{'id': '72', 'title': 'Francina Armengol : La coopération maroco-espagnole, un partenariat mutuellement bénéfique', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/pouvoirs/diplomatie/francina-armengol-la-cooperation-maroco-espagnole-un-partenariat-mutuellement-benefique/', 'summary': 'Francina Armengol : La coopération maroco-espagnole, un partenariat mutuellement bénéfique. La présidente du Congrès des députés espagnol, Francina Armengol, salue à Malaga la coopération maroco-espagnole, qu\'elle qualifie de "mutuellement bénéfique", notamment en matière migratoire et d’échanges économiques.', 'size': 2}, {'id': '88', 'title': 'La coopération maroco-espagnole, un exemple de partenariat “mutuellement bénéfique”', 'source': 'www.lereporter.ma', 'link': 'https://www.lereporter.ma/la-cooperation-maroco-espagnole-un-exemple-de-partenariat-mutuellement-benefique/', 'summary': 'La coopération maroco-espagnole, un exemple de partenariat “mutuellement bénéfique”. La coopération entre le Maroc et l’Espagne est un exemple de partenariat “mutuellement bénéfique”, a affirmé la présidente du Congrès des députés espagnol, Francina Armengol. “Le Maroc et l’Espagne ont développé une coopération exemplaire dans le domaine de la gestion des flux migratoires et de la migration circulaire”, a souligné Mme Armengol dans une déclaration ', 'size': 2}], 'main_title': 'Francina Armengol : La coopération maroco-espagnole, un partenariat mutuellement bénéfique'}, {'community_id': '2', 'articles': [{'id': '85', 'title': 'Températures prévues pour le vendredi 27 juin 2025', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/temperatures-prevues-pour-le-vendredi-27-juin-2025-2/', 'summary': 'Températures prévues pour le vendredi 27 juin 2025. Voici les températures minimales et maximales prévues par la Direction générale de la météorologie pour le vendredi 27 juin 2025 : Min Max – Oujda 23 38 – Bouarfa 25 35 – Al Hoceima 20 27 – Tétouan 20 27 – Sebta 20 24 – Mellilia 21 26 – Tanger 23 32 – Kénitra 21 .', 'size': 2}, {'id': '99', 'title': 'Les températures attendues ce samedi 28 juin 2025', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/430424-les-temperatures-attendues-ce-samedi-28-juin-2025.html', 'summary': 'Les températures attendues ce samedi 28 juin 2025. Voici les températures minimales et maximales prévues par la Direction générale de la météorologie pour la journée du samedi 28 juin 2025 Min Max – Oujda 21 39 – Bouarfa 27 37 – Al Hoceima 21 27 – Tétouan 21 27 – Sebta 21 24 – Mellilia 22 27 – Tanger 23 33 – Kénitra . ', 'size': 2}], 'main_title': 'Températures prévues pour le vendredi 27 juin 2025'}, {'community_id': '3', 'articles': [{'id': '95', 'title': 'Rabat : Un membre de Daech arrêté par le BCIJ', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/430991-rabat-un-membre-de-daech-arrete-par-le-bcij.html', 'summary': 'Rabat : Un membre de Daech arrêté par le BCIJ. Le Bureau Central d’Investigations Judiciaires (BCIJ) a interpellé, vendredi, sur la base de renseignements précis fournis par la Direction Générale de la Surveillance du Territoire (DGST), une extrémiste affiliée à l’organisation terroriste « Daech », poursuivant ses études dans l’un des institut supérieurs techniques, pour son implication présumée dans la préparation et la planification de l’exécution d’un . ', 'size': 5}, {'id': '108', 'title': "BCIJ : Arrestation d'une extrémiste de Daech en cours de préparation d'un attentat", 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/BCIJ-Arrestation-d-une-extremiste-de-Daech-en-cours-de-preparation-d-un-attentat_a69259.html', 'summary': 'BCIJ : Arrestation d\'une extrémiste de Daech en cours de préparation d\'un attentat. Le Bureau Central d’Investigations Judiciaires (BCIJ) a interpellé, vendredi, sur la base de renseignements précis fournis par la Direction Générale de la Surveillance du Territoire (DGST), une extrémiste affiliée à l\'organisation terroriste "Daech", poursuivant ses études dans l\'un des institut supérieurs techniques, pour son implication présumée dans la préparation et la planification de l\'exécution d’un plan terroriste extrêmement dangereux visant à porter gravement atteinte à l’ordre public.', 'size': 5}, {'id': '118', 'title': 'Rabat : arrestation d’une extrémiste affiliée à «\xa0Daech\xa0»', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/rabat-arrestation-dune-extremiste-affiliee-a-daech-305634/', 'summary': 'Rabat : arrestation d’une extrémiste affiliée à « Daech ». Le Bureau Central d’Investigations Judiciaires (BCIJ) a interpellé, vendredi, sur la base de renseignements précis fournis par la Direction Générale de la Surveillance du Territoire (DGST), une extrémiste affiliée à l’organisation terroriste « Daech », poursuivant ses études dans l’un des institut supérieurs techniques, pour son implication présumée dans la préparation et', 'size': 5}, {'id': '123', 'title': 'BCIJ: Interpellation à Rabat d’une extrémiste affiliée à Daech', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/actualite/bcij-interpellation-a-rabat-dune-extremiste-affiliee-a-daech', 'summary': 'BCIJ: Interpellation à Rabat d’une extrémiste affiliée à Daech. Le Bureau Central d’Investigations Judiciaires (BCIJ) a interpellé, vendredi, sur la base de renseignements précis fournis par la Direction Générale de la Surveillance du Territoire (DGST), une extrémiste affiliée à l’organisation terroriste « Daech », poursuivant ses études dans l’un des institut supérieurs techniques, pour son implication présumée dans la préparation et la planification de l’exécution d’un .', 'size': 5}, {'id': '130', 'title': 'Rabat : Une extrémiste affiliée à Daech arrêtée pour plan terroriste (BCIJ)', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/rabat-une-extremiste-affiliee-a-daech-arretee-pour-plan-terroriste-bcij/', 'summary': 'Rabat : Une extrémiste affiliée à Daech arrêtée pour plan terroriste (BCIJ). Le Bureau Central d’Investigations Judiciaires (BCIJ) a interpellé, vendredi, sur la base de renseignements précis fournis par la Direction Générale de la Surveillance du Territoire (DGST), une extrémiste affiliée à l’organisation terroriste « Daech », poursuivant ses études dans l’un des institut supérieurs techniques, pour son implication présumée dans la préparation et la planification de l’exécution d’un .', 'size': 5}], 'main_title': 'Rabat : Un membre de Daech arrêté par le BCIJ'}, {'community_id': '4', 'articles': [{'id': '102', 'title': 'Le Maroc et la Turquie renforcent leur coopération routière et maritime', 'source': 'lematin.ma', 'link': 'https://lematin.ma/economie/le-maroc-et-la-turquie-renforcent-leur-cooperation-routiere-et-maritime/288059', 'summary': 'Le Maroc et la Turquie renforcent leur coopération routière et maritime. Ces deux MoU ont été signés par le ministre du Transport et de la Logistique, Abdessamad Kayouh, qui conduit une délégation de haut niveau à ce forum international, et son homologu.', 'size': 2}, {'id': '131', 'title': 'Le Maroc et la Turquie signent deux MoU sur la sécurité routière et les corridors maritimes', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/le-maroc-et-la-turquie-signent-deux-mou-sur-la-securite-routiere-et-les-corridors-maritimes/', 'summary': 'Le Maroc et la Turquie signent deux MoU sur la sécurité routière et les corridors maritimes. Le Maroc et la Turquie ont signé, vendredi à Istanbul, en marge du Forum mondial sur la connectivité des transports, deux mémorandums d’entente (MoU) relatifs à la sécurité routière et aux corridors maritimes. Ces deux MoU ont été signés par le ministre du Transport et de la Logistique, Abdessamad Kayouh, qui conduit une délégation de .', 'size': 2}], 'main_title': 'Le Maroc et la Turquie renforcent leur coopération routière et maritime'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
                        
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ? d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        // Fonction pour cacher le tooltip
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = '';
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
    
    
</body>




</html>
    