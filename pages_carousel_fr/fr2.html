<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); 
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title"> Les principales actualités des dernières 24 heures

</div>    
        <div class="header-subtitle"> Dernière mise à jour : 05/10/2025 - 06h16</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '1', 'title': 'Marrakech : La justice dément toute mort lors des événements de Sidi Youssef Ben Ali', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/443951-marrakech-la-justice-dement-toute-mort-lors-des-evenements-de-sidi-youssef-ben-ali.html', 'summary': 'Marrakech : La justice dément toute mort lors des événements de Sidi Youssef Ben Ali. Le parquet de la Cour d’appel de Marrakech a formellement démenti, ce jeudi, les informations faisant état du décès d’un citoyen lors des récentes manifestations dans le quartier de Sidi Youssef Ben Ali. Cette annonce fait suite à la diffusion d’un communiqué par la section locale de l’Association Marocaine des Droits de l’Homme (AMDH), relayé . ', 'size': 4}, {'id': '75', 'title': 'Marrakech : Le parquet dément le décès d’un citoyen lors des événements de Sidi Youssef Ben Ali', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/au-royaume/scans/marrakech-le-parquet-dement-le-deces-dun-citoyen-lors-des-evenements-de-sidi-youssef-ben-ali/', 'summary': "Marrakech : Le parquet dément le décès d’un citoyen lors des événements de Sidi Youssef Ben Ali. Il s'agit d'un citoyen qui exerçait comme vendeur ambulant dans la rue Msalla où il a été victime d'un malaise, le 1er octobre 2025, avant de s'écrouler près de son étalage au niveau du magasin Koutoubia, loin du lieu de la manifestation.", 'size': 2}, {'id': '95', 'title': 'Décès d’un citoyen à Marrakech : le Parquet clarifie les faits et écarte tout lien avec les manifestations', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/deces-dun-citoyen-a-marrakech-le-parquet-clarifie-les-faits-et-ecarte-tout-lien-avec-les-manifestations/', 'summary': 'Décès d’un citoyen à Marrakech : le Parquet clarifie les faits et écarte tout lien avec les manifestations. À la suite d’informations relayées sur les réseaux sociaux faisant état du décès d’un citoyen lors des incidents survenus à Sidi Youssef Ben Ali, le Parquet général près la Cour d’appel de Marrakech a démenti catégoriquement cette rumeur. Aucun décès n’a été enregistré, précisant que la personne évoquée est décédée d’un malaise sans lien avec .', 'size': 4}, {'id': '142', 'title': "Marrakech: le Parquet dément le décès d'un citoyen lors des émeutes de Sidi Youssef Ben Ali", 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Marrakech-le-Parquet-dement-le-deces-d-un-citoyen-lors-des-emeutes-de-Sidi-Youssef-Ben-Ali_a72480.html', 'summary': "Marrakech: le Parquet dément le décès d'un citoyen lors des émeutes de Sidi Youssef Ben Ali. La nouvelle de la mort d’un citoyen lors des événements de Sidi Youssef Ben Ali est dénuée de tout fondement, apprend-on via un communiqué du Procureur général du Roi près la Cour d’appel de Marrakech.", 'size': 5}, {'id': '150', 'title': 'Marrakech : Aucun décès lors des violences à Sidi Youssef Ben Ali (procureur général)', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/178008/marrakech-aucun-deces-lors-violences.html', 'summary': 'Marrakech : Aucun décès lors des violences à Sidi Youssef Ben Ali (procureur général). Le procureur général du roi près la Cour dappel de Marrakech indique que les allégations véhiculées par certains médias, sur la base dun communiqué de lAssociation marocaine des droits humains (AMDH/section Marrakech Menara), concernant le décès dun citoyen lors des événements survenus dans le quartier de Sidi Youssef Ben Ali, sont dénuées de tout fondement.', 'size': 4}], 'main_title': "Marrakech: le Parquet dément le décès d'un citoyen lors des émeutes de Sidi Youssef Ben Ali"}, {'community_id': '8', 'articles': [{'id': '10', 'title': 'Vueling inaugure une nouvelle ligne aérienne Essaouira-Séville', 'source': 'lematin.ma', 'link': 'https://lematin.ma/economie/vueling-inaugure-une-nouvelle-ligne-aerienne-essaouira-seville/305630', 'summary': "Vueling inaugure une nouvelle ligne aérienne Essaouira-Séville. Cette nouvelle desserte, assurée à raison d’une fréquence hebdomadaire chaque samedi, vient renforcer la connectivité d'Essaouira et consolider son positionnement sur la carte.", 'size': 2}, {'id': '145', 'title': 'Vueling inaugure la ligne aérienne Séville-Essaouira', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/vueling-inaugure-la-ligne-aerienne-seville-essaouira-310971/', 'summary': 'Vueling inaugure la ligne aérienne Séville-Essaouira. Un avion de la compagnie aérienne espagnole Vueling a atterri, samedi à l’aéroport international Essaouira-Mogador, marquant l’inauguration officielle d’une nouvelle ligne aérienne reliant Séville en Espagne à la', 'size': 2}, {'id': '153', 'title': 'Vueling inaugure une nouvelle ligne aérienne direct reliant Essaouira à Séville', 'source': 'www.lereporter.ma', 'link': 'https://www.lereporter.ma/vueling-inaugure-une-nouvelle-ligne-aerienne-direct-reliant-essaouira-a-seville/', 'summary': 'Vueling inaugure une nouvelle ligne aérienne direct reliant Essaouira à Séville. Un avion de la compagnie aérienne espagnole “Vueling” a atterri, samedi à l’aéroport international Essaouira-Mogador, marquant l’inauguration officielle d’une nouvelle ligne aérienne reliant Séville en Espagne à la Cité des Alizés. Cette nouvelle desserte, assurée à raison d’une fréquence hebdomadaire chaque samedi, vient renforcer la connectivité d’Essaouira et consolider son positionnement sur la carte touristique ', 'size': 3}], 'main_title': 'Vueling inaugure une nouvelle ligne aérienne direct reliant Essaouira à Séville'}, {'community_id': '4', 'articles': [{'id': '16', 'title': 'FC Barcelone : Lamine Yamal absent pour deux à trois semaines', 'source': 'lematin.ma', 'link': 'https://lematin.ma/sports/fc-barcelone-lamine-yamal-absent-pour-deux-a-trois-semaines/305594', 'summary': "FC Barcelone : Lamine Yamal absent pour deux à trois semaines. Les douleurs au pubis qui gênaient le joueur Lamine Yamal sont réapparues après le match contre le PSG, écrit le Barça dans un communiqué, ajoutant que l'ailier de.", 'size': 2}, {'id': '52', 'title': 'Espagne : Lamine Yamal forfait “pour deux à trois semaines”', 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/10/03/espagne-lamine-yamal-forfait-pour-deux-a-trois-semaines_1954007/', 'summary': 'Espagne : Lamine Yamal forfait “pour deux à trois semaines”. Le prodige du FC Barcelone Lamine Yamal, de retour comme titulaire face au PSG mercredi (défaite 2-1) en Ligue des champions, souffre à nouveau de douleurs au pubis et sera indisponible « pour deux à trois semaines », a annoncé vendredi le club catalan. Les douleurs au pubis qui gênaient le joueur Lamine Yamal sont réapparues après.', 'size': 2}], 'main_title': 'FC Barcelone : Lamine Yamal absent pour deux à trois semaines'}, {'community_id': '5', 'articles': [{'id': '48', 'title': 'Maroc-Allemagne : la BVMW inaugure son bureau à Rabat', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Maroc-Allemagne-la-BVMW-inaugure-son-bureau-a-Rabat_a72457.html', 'summary': 'Maroc-Allemagne : la BVMW inaugure son bureau à Rabat. \u200bL’Association fédérale allemande des petites et moyennes entreprises (Bundesverband mittelständische Wirtschaft – BVMW) a inauguré, vendredi à Rabat, son Bureau Maroc, en présence du ministre délégué chargé de l’Investissement, de la Convergence et de l’Évaluation des Politiques Publiques, Karim Zidane, et du directeur générale de la BVMW Berlin, Christoph Ahlhaus.', 'size': 3}, {'id': '53', 'title': "Entreprises : l'association fédérale allemande des PME inaugure son bureau au Maroc", 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/10/03/entreprises-lassociation-federale-allemande-des-pme-inaugure-son-bureau-au-maroc_1953975/', 'summary': "Entreprises : l'association fédérale allemande des PME inaugure son bureau au Maroc. L’Association fédérale allemande des petites et moyennes entreprises (Bundesverband mittelständische Wirtschaft – BVMW) a inauguré, vendredi à Rabat, son Bureau Maroc, en présence du ministre délégué chargé de l’Investissement, de la Convergence et de l’évaluation des politiques publiques, Karim Zidane, et du directeur générale de la BVMW Berlin, Christoph Ahlhaus. Cette initiative marque une étape.", 'size': 3}, {'id': '60', 'title': 'La BVMW, association des PME allemandes, s’installe au Maroc', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/la-bvmw-association-des-pme-allemandes-sinstalle-au-maroc-310953/', 'summary': 'La BVMW, association des PME allemandes, s’installe au Maroc. La Bundesverband Mittelständische Wirtschaft (BVMW), l’association fédérale allemande des petites et moyennes entreprises (PME), a ouvert, vendred 3 octobre 2025, un Bureau à Rabat, afin de renforcer les', 'size': 3}], 'main_title': 'Maroc-Allemagne : la BVMW inaugure son bureau à Rabat'}, {'community_id': '3', 'articles': [{'id': '59', 'title': 'Les prévisions météorologiques du samedi 04 octobre 2025', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/les-previsions-meteorologiques-du-samedi-04-octobre-2025-310957/', 'summary': 'Les prévisions météorologiques du samedi 04 octobre 2025. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le samedi 04 octobre 2025: – Temps assez chaud sur le Sud-Est et l’extrême Sud', 'size': 2}, {'id': '121', 'title': "Le temps qu'il fera ce dimanche 5 octobre 2025", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/443979-le-temps-quil-fera-ce-dimanche-5-octobre-2025.html', 'summary': "Le temps qu'il fera ce dimanche 5 octobre 2025. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le dimanche 5 octobre 2025 – Temps assez chaud sur les plaines à l’Ouest de l’Atlas, le Sud-Est et l’extrême Sud des provinces sahariennes. – Nuages bas et formations brumeuses ou bruine locale sur les plaines atlantiques Nord et Centre et le . ", 'size': 2}], 'main_title': 'Les prévisions météorologiques du samedi 04 octobre 2025'}, {'community_id': '2', 'articles': [{'id': '69', 'title': 'Crédit bancaire : un encours de 1.161 milliards DH à fin août', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/economie/credit-bancaire-un-encours-de-1-161-milliards-dh-a-fin-aout', 'summary': 'Crédit bancaire : un encours de 1.161 milliards DH à fin août. L’encours du crédit bancaire s’est établi à 1.161 milliards de dirhams (MMDH) à fin août 2025, en progression de 5,3% par rapport à la même période de l’année précédente, selon Bank Al-Maghrib (BAM). Cette évolution couvre une hausse, en glissement annuel, des crédits aux agents non financiers (+3,4%) et aux agents financiers (+15,9%), précise BAM .', 'size': 2}, {'id': '102', 'title': 'Crédits-Dépôts bancaires : le tableau de bord de BAM en 5 points clés', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/credits-depots-bancaires-le-tableau-de-bord-de-bam-en-5-points-cles-2/', 'summary': 'Crédits-Dépôts bancaires : le tableau de bord de BAM en 5 points clés. Voici cinq points clés du tableau de bord « Crédits-Dépôts bancaires » de Bank Al-Maghrib (BAM) au titre du mois d’août 2025 : 1- L’encours du crédit bancaire s’est établi à 1.161 milliards de dirhams (MMDH) à fin août, en hausse annuelle de 5,3%. 2- Les concours aux agents non financiers ont progressé de 3,4%, tandis que .', 'size': 2}], 'main_title': 'Crédit bancaire : un encours de 1.161 milliards DH à fin août'}, {'community_id': '1', 'articles': [{'id': '97', 'title': 'Commémoration à Al Hoceima du 70è anniversaire du lancement des opérations de l’armée de libération dans le Nord', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/commemoration-a-al-hoceima-du-70e-anniversaire-du-lancement-des-operations-de-larmee-de-liberation-dans-le-nord/', 'summary': 'Commémoration à Al Hoceima du 70è anniversaire du lancement des opérations de l’armée de libération dans le Nord. Un meeting commémoratif a été organisé vendredi à Sidi Bouzineb, relevant de la province d’Al Hoceima, à l’occasion du 70è anniversaire du lancement des opérations de l’Armée de libération dans le nord du Royaume. Le Haut-Commissaire aux anciens résistants et anciens membres de l’Armée de libération (HCAR) a souligné, dans un discours prononcé en son .', 'size': 2}, {'id': '144', 'title': 'Al Hoceima (Sidi Bouzineb): Célébration de l’épopée héroïque de l’Armée de libération', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Al-Hoceima-Sidi-Bouzineb-Celebration-de-l-epopee-heroique-de-l-Armee-de-liberation_a72478.html', 'summary': 'Al Hoceima (Sidi Bouzineb): Célébration de l’épopée héroïque de l’Armée de libération. Un meeting commémoratif a été organisé, récemment, à Sidi Bouzineb à l’occasion du 70è anniversaire du lancement des opérations de l’Armée de libération dans le nord du Royaume. Détails.', 'size': 2}], 'main_title': 'Commémoration à Al Hoceima du 70è anniversaire du lancement des opérations de l’armée de libération dans le Nord'}, {'community_id': '6', 'articles': [{'id': '122', 'title': "Saisie de 53,6 kg de cocaïne au poste-frontière d'El Guerguerat", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/443977-saisie-de-536-kg-de-cocaine-au-poste-frontiere-del-guerguerat.html', 'summary': "Saisie de 53,6 kg de cocaïne au poste-frontière d'El Guerguerat. Une opération sécuritaire menée conjointement par les éléments de la Sûreté nationale et de la Douane au poste-frontière El Guerguerat, au sud de la ville de Dakhla, a permis, samedi soir, de mettre en échec une tentative de trafic international de drogues et de saisir 53 kilogrammes et 630 grammes de cocaïne, a-t-on indiqué de . ", 'size': 2}, {'id': '152', 'title': 'El Guerguerat : Mise en échec d’une tentative de trafic international de drogues et saisie de 53,6 kg de cocaïne', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/actualite/el-guerguerat-mise-en-echec-dune-tentative-de-trafic-international-de-drogues-et-saisie-de-536-kg-de-cocaine', 'summary': 'El Guerguerat : Mise en échec d’une tentative de trafic international de drogues et saisie de 53,6 kg de cocaïne. Une opération sécuritaire menée conjointement par les éléments de la Sûreté nationale et de la Douane au poste-frontière El Guerguerat, au sud de la ville de Dakhla, a permis, samedi soir, de mettre en échec une tentative de trafic international de drogues et de saisir 53 kilogrammes et 630 grammes de cocaïne, a-t-on indiqué de .', 'size': 2}], 'main_title': "Saisie de 53,6 kg de cocaïne au poste-frontière d'El Guerguerat"}, {'community_id': '7', 'articles': [{'id': '136', 'title': 'Emeutes : 17 individus déférés devant le parquet suites aux évènements de Sidi Taibi', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Emeutes-17-individus-deferes-devant-le-parquet-suites-aux-evenements-de-Sidi-Taibi_a72486.html', 'summary': "Emeutes : 17 individus déférés devant le parquet suites aux évènements de Sidi Taibi. Suite aux incidents portant atteinte à la sécurité et à l'ordre publics survenus, mercredi dernier, dans la zone de Sidi Taibi relevant de la province de Kénitra, et marqués par des actes de pillage, violence et destruction de biens publics et privés et d'incendie volontaire, 17 individus arrêtés ont été déférés, samedi, devant le parquet près de la Cour d'Appel de Kénitra, indique un communiqué du procureur général du Roi près cette juridiction.", 'size': 2}, {'id': '149', 'title': 'Kénitra : 17 individus déférés devant le parquet après les violences à Sidi Taibi', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/178009/kenitra-individus-deferes-devant-parquet.html', 'summary': 'Kénitra : 17 individus déférés devant le parquet après les violences à Sidi Taibi. Suite aux incidents portant atteinte à la sécurité et à lordre publics survenus, mercredi dernier, dans la zone de Sidi Taibi relevant de la province de Kénitra, et marqués par des actes de pillage, violence et destruction de biens publics et privés et dincendie volontaire, 17 individus arrêtés ont été déférés, samedi, devant le parquet près de la Cour dAppel de Kénitra, indique un communiqué du procureur général du roi près cette juridiction.', 'size': 2}], 'main_title': 'Emeutes : 17 individus déférés devant le parquet suites aux évènements de Sidi Taibi'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
                        
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ? d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        // Fonction pour cacher le tooltip
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = '';
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
    
    
</body>




</html>
    