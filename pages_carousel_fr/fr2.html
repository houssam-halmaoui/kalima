<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); 
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title"> Les principales actualités des dernières 24 heures

</div>    
        <div class="header-subtitle"> Dernière mise à jour : 07/07/2025 - 12h27</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '5', 'articles': [{'id': '1', 'title': "Sahel: Le 2ème Sommet des Etats de l'AES prévu pour décembre", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/432086-sahel-le-2eme-sommet-des-etats-de-laes-prevu-pour-decembre.html', 'summary': "Sahel: Le 2ème Sommet des Etats de l'AES prévu pour décembre. La deuxième session du Collège des chefs d’État de la Confédération des États du Sahel (AES) regroupant le Mali, le Niger et le Burkina Faso, se tiendra en décembre 2025 à Bamako, a annoncé le président de Transition au Mali, le général Assimi Goïta. La décision a été prise en concertation avec les présidents du . ", 'size': 2}, {'id': '70', 'title': 'Le 2ème sommet de l’AES en décembre à Bamako', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/le-2eme-sommet-de-laes-en-decembre-a-bamako/', 'summary': 'Le 2ème sommet de l’AES en décembre à Bamako. La deuxième session du Collège des chefs d’État de la Confédération des États du Sahel (AES) regroupant le Mali, le Niger et le Burkina Faso, se tiendra en décembre 2025 à Bamako, a annoncé le président de Transition au Mali, le général Assimi Goïta. La décision a été prise en concertation avec les présidents du .', 'size': 2}], 'main_title': "Sahel: Le 2ème Sommet des Etats de l'AES prévu pour décembre"}, {'community_id': '3', 'articles': [{'id': '25', 'title': 'Jazzablanca 2025 : Casablanca vibre entre électro-swing, jazz cosmopolite et légendes de la pop', 'source': 'lematin.ma', 'link': 'https://lematin.ma/culture/jazzablanca-2025-casablanca-vibre-entre-electro-swing-et-jazz-cosmopolite/289464', 'summary': 'Jazzablanca 2025 : Casablanca vibre entre électro-swing, jazz cosmopolite et légendes de la pop. Le festival Jazzablanca continue de faire battre le cœur musical de la métropole. Ce samedi, la troisième soirée de cette 18ᵉ édition a rassemblé un public venu en nombre savourer.', 'size': 2}, {'id': '36', 'title': 'Jazzablanca : Black Eyed Peas, Caravan Palace et Nubya Garcia galvanisent les foules', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Jazzablanca-Black-Eyed-Peas-Caravan-Palace-et-Nubya-Garcia-galvanisent-les-foules_a69529.html', 'summary': 'Jazzablanca : Black Eyed Peas, Caravan Palace et Nubya Garcia galvanisent les foules. Samedi 5 juillet, Casablanca s’est transformée en épicentre de la création musicale mondiale à l’occasion de la troisième soirée de la 18ᵉ édition du festival Jazzablanca. Trois univers artistiques, trois esthétiques sonores, trois moments d’exception : Caravan Palace, Nubya Garcia et les Black Eyed Peas ont transporté le public casablancais dans une expérience sensorielle où se sont entremêlés jazz contemporain, électro-swing survolté et pop urbaine planétaire.', 'size': 3}, {'id': '60', 'title': 'Jazzablanca : La nuit la plus folle est signée Caravan Palace et Black Eyed Peas', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/170950/jazzablanca-nuit-plus-folle-signee.html', 'summary': 'Jazzablanca : La nuit la plus folle est signée Caravan Palace et Black Eyed Peas. Lors de la troisième nuit de Jazzablanca, une foule vibrante sest rassemblée pour une programmation électrisante mettant en vedette Caravan Palace et les Black Eyed Peas. Du set puissant au saxophone de Nubya Garcia à un final rempli de confettis avec will.i.am enveloppé dans le drapeau marocain, la soirée fut une célébration de rythme, dénergie et de connexion.', 'size': 3}, {'id': '77', 'title': 'Jazzablanca 2025 : une soirée intense portée par les rythmes de Black Eyed Peas, Caravan Palace et Nubya Garcia', 'source': 'lnt.ma', 'link': 'https://lnt.ma/jazzablanca-2025-une-soiree-intense-portee-par-les-rythmes-de-black-eyed-peas-caravan-palace-et-nubya-garcia/', 'summary': 'Jazzablanca 2025 : une soirée intense portée par les rythmes de Black Eyed Peas, Caravan Palace et Nubya Garcia. La troisième soirée de la 18ᵉ édition du festival Jazzablanca a offert au public casablancais une expérience musicale d’envergure, mêlant des sonorités venues d’horizons multiples à travers les prestations remarquées de trois têtes d’affiche internationales : les Black Eyed Peas, Caravan Palace et Nubya Garcia. Cette soirée, placée sous le signe du métissage et de . ', 'size': 4}], 'main_title': 'Jazzablanca 2025 : une soirée intense portée par les rythmes de Black Eyed Peas, Caravan Palace et Nubya Garcia'}, {'community_id': '2', 'articles': [{'id': '28', 'title': 'Gaza: Début des négociations à Doha', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Gaza-Debut-des-negociations-a-Doha_a69538.html', 'summary': "Gaza: Début des négociations à Doha. Les négociations indirectes entre Israël et le Hamas palestinien en vue d'un accord de cessez-le-feu et de libération d'otages à Gaza ont commencé dimanche soir à Doha, à la veille d'une rencontre à Washington entre Benjamin Netanyahu et Donald Trump.", 'size': 2}, {'id': '85', 'title': 'Gaza: Netanyahu à Washington, Trump espère un accord Israël-Hamas "cette semaine"', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/432186-gaza-netanyahu-a-washington-trump-espere-un-accord-israel-hamas-cette-semaine.html', 'summary': 'Gaza: Netanyahu à Washington, Trump espère un accord Israël-Hamas "cette semaine". Le Premier ministre israélien Benjamin Netanyahu est à Washington lundi pour rencontrer le président américain Donald Trump, qui a dit espérer un accord « cette semaine » entre Israël et le Hamas palestinien pour une libération d’otages dans la bande de Gaza. Des négociations indirectes entre Israël et le Hamas ont commencé dimanche soir à Doha en . ', 'size': 2}], 'main_title': 'Gaza: Début des négociations à Doha'}, {'community_id': '7', 'articles': [{'id': '80', 'title': 'Aéroport Mohammed V : coup d’envoi des travaux du nouveau terminal', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/432201-aeroport-mohammed-v-coup-denvoi-des-travaux-du-nouveau-terminal.html', 'summary': 'Aéroport Mohammed V : coup d’envoi des travaux du nouveau terminal. L’Office National des Aéroports (ONDA) annonce le lancement officiel des travaux de terrassement du chantier du nouveau terminal de l’aéroport Mohammed V de Casablanca, première phase concrète pour l’un des projets d’infrastructure les plus ambitieux du Maroc à l’horizon 2030. Avec un investissement global estimé à 15 milliards de dirhams, ce nouveau terminal, conçu pour . ', 'size': 3}, {'id': '94', 'title': 'Aéroport Mohammed V-Casablanca : début des travaux de terrassements pour le nouveau terminal', 'source': 'lematin.ma', 'link': 'https://lematin.ma/regions/aeroport-mohammed-v-debut-des-terrassements-pour-le-nouveau-terminal/289605', 'summary': 'Aéroport Mohammed V-Casablanca : début des travaux de terrassements pour le nouveau terminal. Le chantier du futur terminal de l’aéroport Mohammed V de Casablanca entre dans sa phase concrète. Les travaux de terrassement ont officiellement démarré, donnant le coup d’envoi à.', 'size': 4}, {'id': '115', 'title': 'Aéroport Mohammed-V : démarrage des travaux du futur terminal à 15 milliards de dirhams', 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/07/07/aeroport-mohammed-v-demarrage-des-travaux-du-futur-terminal-a-15-milliards-de-dirhams_1941214/', 'summary': 'Aéroport Mohammed-V : démarrage des travaux du futur terminal à 15 milliards de dirhams. Les travaux de terrassement du futur terminal de l’aéroport Mohammed V ont officiellement démarré, marquant le début de la première étape de terrain de ce projet visant à transformer Casablanca en hub aérien de référence à l’échelle mondiale. L’aéroport Mohammed V de Casablanca, première plateforme aéroportuaire du Royaume, entre dans une nouvelle ère avec le.', 'size': 2}, {'id': '153', 'title': 'Aéroport Mohammed V : Lancement des travaux de terrassement du\xa0futur\xa0terminal', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/aeroport-mohammed-v-lancement-des-travaux-de-terrassement-du-futur-terminal/', 'summary': 'Aéroport Mohammed V : Lancement des travaux de terrassement du futur terminal. Le chantier du futur terminal de l’aéroport Mohammed V a franchi une étape décisive. Les travaux de terrassement ont officiellement démarré, déclenchant la première étape de terrain d’un projet stratégique qui transformera Casablanca en hub aérien de référence à l’échelle mondiale. Le projet devient réalité. L’aéroport Mohammed V de Casablanca, première plateforme aéroportuaire du Royaume, .', 'size': 4}, {'id': '178', 'title': 'Les travaux de terrassement du nouveau terminal de l’aéroport Mohammed V officiellement lancés', 'source': 'lnt.ma', 'link': 'https://lnt.ma/les-travaux-de-terrassement-du-nouveau-terminal-de-laeroport-mohammed-v-officiellement-lances/', 'summary': 'Les travaux de terrassement du nouveau terminal de l’aéroport Mohammed V officiellement lancés. Les travaux de terrassement du futur terminal de l’aéroport international Mohammed V de Casablanca ont été lancés, marquant le début de la phase opérationnelle d’un projet d’infrastructure d’envergure inscrit dans le cadre de la stratégie nationale « Aéroports 2030 ». Porté par l’Office National des Aéroports (ONDA), ce projet vise à accompagner l’évolution du trafic . ', 'size': 4}], 'main_title': 'Aéroport Mohammed V-Casablanca : début des travaux de terrassements pour le nouveau terminal'}, {'community_id': '1', 'articles': [{'id': '91', 'title': 'Attijariwafa Bank lance son activité d’acquisition commerçants', 'source': 'lematin.ma', 'link': 'https://lematin.ma/economie/attijariwafa-bank-lance-son-activite-dacquisition-commercants/289656', 'summary': 'Attijariwafa Bank lance son activité d’acquisition commerçants. Ce développement fait suite à l’obtention de l’agrément d’Établissement de Paiement délivré par Bank Al-Maghrib en date du 13 mars 2025, renforçant la position d’Attijari Payment e.', 'size': 2}, {'id': '151', 'title': 'Attijari Payment lance officiellement son activité d’acquisition commerçants', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/attijari-payment-lance-officiellement-son-activite-dacquisition-commercants/', 'summary': 'Attijari Payment lance officiellement son activité d’acquisition commerçants. Attijari Payment annonce le lancement officiel de son activité d’acquisition commerçants, effective depuis le 1ᵉʳ mai 2025. Cette initiative s’inscrit dans le cadre de l’évolution de l’écosystème des paiements au Maroc, en réponse aux réformes réglementaires du secteur et aux besoins des commerçants et des entreprises de toutes tailles. Ce développement fait suite à l’obtention .', 'size': 2}], 'main_title': 'Attijariwafa Bank lance son activité d’acquisition commerçants'}, {'community_id': '0', 'articles': [{'id': '96', 'title': 'La Banque Populaire accélère la digitalisation des paiements avec « Chaabi Payment »', 'source': 'lematin.ma', 'link': 'https://lematin.ma/economie/la-banque-populaire-accelere-la-digitalisation-des-paiements/289627', 'summary': 'La Banque Populaire accélère la digitalisation des paiements avec « Chaabi Payment ». Destinée aux professionnels de tous horizons (commerçants de proximité, artisans, professions libérales, TPE, PME et grandes entreprises), l’offre « Chaabi Payment » permet l’accep.', 'size': 2}, {'id': '145', 'title': 'Paiement multicanal : M2T lance son offre «Chaabi Payment»', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/argent/paiement-multicanal-m2t-lance-son-offre-chaabi-payment/', 'summary': 'Paiement multicanal : M2T lance son offre «Chaabi Payment». Destinée aux professionnels (commerçants de proximité, artisans, professions libérales, TPE, PME et grandes entreprises), l’offre permet l’acceptation des paiements par carte ou via mobile, que ce soit sur un terminal de paiement électronique (TPE) ou en ligne.', 'size': 2}], 'main_title': 'La Banque Populaire accélère la digitalisation des paiements avec « Chaabi Payment »'}, {'community_id': '4', 'articles': [{'id': '99', 'title': 'Etats-Unis : Entrée en vigueur le 1er août des nouveaux tarifs douaniers', 'source': 'lematin.ma', 'link': 'https://lematin.ma/monde/etats-unis-entree-en-vigueur-le-1er-aout-des-nouveaux-tarifs-douaniers/289598', 'summary': 'Etats-Unis : Entrée en vigueur le 1er août des nouveaux tarifs douaniers. Le président Trump va envoyer des lettres à certains de nos partenaires commerciaux pour leur dire que si vous ne faites pas avancer les choses alors ils retourneront, le 1er.', 'size': 2}, {'id': '120', 'title': 'États-Unis : entrée en vigueur des nouveaux tarifs douaniers le 1er août', 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/07/07/etats-unis-entree-en-vigueur-des-nouveaux-tarifs-douaniers-le-1er-aout_1941175/', 'summary': 'États-Unis : entrée en vigueur des nouveaux tarifs douaniers le 1er août. Annoncés en avril dernier avant d’être suspendus, le secrétaire américain au Trésor a annoncé que les nouveaux tarifs douaniers — pouvant atteindre 50 % — entreront finalement en vigueur le 1er août. Les droits de douane annoncés en avril avant d’être suspendus entreront en vigueur le 1er août en l’absence d’accords commerciaux avec les Etats-Unis, a.', 'size': 2}], 'main_title': 'Etats-Unis : Entrée en vigueur le 1er août des nouveaux tarifs douaniers'}, {'community_id': '6', 'articles': [{'id': '133', 'title': 'Renforcement des relations sino-arabes : L’ Université Tsinghua en Chine lance sa première bourse aux étudiants arabes', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/societe/renforcement-des-relations-sino-arabes-l-universite-tsinghua-en-chine-lance-sa-premiere-bourse-aux-etudiants-arabes', 'summary': 'Renforcement des relations sino-arabes : L’ Université Tsinghua en Chine lance sa première bourse aux étudiants arabes. Ce programme financera chaque année, pendant : cinq ans, jusqu’à 15 étudiants suivant un cursus de premier ou deuxième cycle à l’Université Tsinghua en Chine. Programme : Le programme de bourses Hazem Ben-Gacem destiné aux étudiants arabes débutera lors de l’année universitaire 2025-2026 . Cette bourse renforce les liens entre les États arabes et la .', 'size': 2}, {'id': '175', 'title': 'Une première bourse destinée aux étudiants arabes de l’université Tsinghua en Chine', 'source': 'lnt.ma', 'link': 'https://lnt.ma/une-premiere-bourse-destinee-aux-etudiants-arabes-de-luniversite-tsinghua-en-chine/', 'summary': 'Une première bourse destinée aux étudiants arabes de l’université Tsinghua en Chine. D’éminents ambassadeurs, dignitaires et responsables universitaires se sont réunis le jeudi 26 juin dernier, à l’université Tsinghua en Chine pour marquer le lancement officiel du programme de bourses Hazem Ben-Gacem destiné aux étudiants arabes, une initiative historique visant à faire bénéficier à des étudiants des pays de la Ligue Arabe d’un enseignement mondialement reconnu, tout . ', 'size': 2}], 'main_title': 'Renforcement des relations sino-arabes : L’ Université Tsinghua en Chine lance sa première bourse aux étudiants arabes'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
                        
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ? d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        // Fonction pour cacher le tooltip
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = '';
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
    
    
</body>




</html>
    