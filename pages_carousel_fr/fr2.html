<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); 
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title"> Les principales actualités des dernières 24 heures

</div>    
        <div class="header-subtitle"> Dernière mise à jour : 15/09/2025 - 06h14</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '4', 'title': "Fès: Arrestation de 4 membres présumés d'un réseau d'escroquerie", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/441194-fes-arrestation-de-4-membres-presumes-dun-reseau-descroquerie.html', 'summary': "Fès: Arrestation de 4 membres présumés d'un réseau d'escroquerie. Les éléments de la Brigade régionale de la police judiciaire de Fès, en étroite coordination avec les services de la Direction générale de la surveillance du territoire (DGST), ont procédé, samedi, à l’arrestation de quatre personnes soupçonnées de faire partie d’un réseau criminel d’escroquerie sur des candidats à l’immigration. Selon les premiers éléments de l’enquête, . ", 'size': 3}, {'id': '30', 'title': "Fès: Démantèlement d'un réseau d'escroquerie ciblant des candidats à l'immigration", 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Fes-Demantelement-d-un-reseau-d-escroquerie-ciblant-des-candidats-a-l-immigration_a71730.html', 'summary': "Fès: Démantèlement d'un réseau d'escroquerie ciblant des candidats à l'immigration. Les éléments de la Brigade régionale de la police judiciaire de Fès, en étroite coordination avec les services de la Direction générale de la surveillance du territoire (DGST), ont procédé, samedi, à l’arrestation de quatre personnes soupçonnées de faire partie d'un réseau criminel d’escroquerie sur des candidats à l'immigration.", 'size': 3}, {'id': '45', 'title': "Fès : 4 arrestations\xa0liées pour escroquerie visant des candidats à l'immigration", 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/176319/arrestations-liees-pour-escroquerie-visant.html', 'summary': "Fès : 4 arrestations liées pour escroquerie visant des candidats à l'immigration. Les éléments de la Brigade régionale de la police judiciaire de Fès, en étroite coordination avec les services de la Direction générale de la surveillance du territoire (DGST), ont procédé, samedi, à l’arrestation de quatre personnes soupçonnées de faire partie dun réseau criminel d’escroquerie sur des candidats à limmigration.", 'size': 3}], 'main_title': "Fès: Arrestation de 4 membres présumés d'un réseau d'escroquerie"}, {'community_id': '1', 'articles': [{'id': '5', 'title': "Bourita à Doha pour la réunion préparatoire du Sommet arabo-islamique d'urgence", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/441214-bourita-a-doha-pour-la-reunion-preparatoire-du-sommet-arabo-islamique-durgence.html', 'summary': "Bourita à Doha pour la réunion préparatoire du Sommet arabo-islamique d'urgence. Les travaux de la réunion préparatoire des ministres des Affaires étrangères en prélude du Sommet arabo-islamique d’urgence consacré à l’examen de l’attaque israélienne contre l’État du Qatar ont débuté dimanche à Doha, avec la participation du Maroc Le Maroc est représenté à cette réunion par le ministre des Affaires étrangères, de la Coopération africaine et . ", 'size': 4}, {'id': '14', 'title': "Doha : Réunion préparatoire du Sommet arabo-islamique d'urgence avec la participation du Maroc", 'source': 'lematin.ma', 'link': 'https://lematin.ma/nation/doha-reunion-preparatoire-du-sommet-arabo-islamique/301475', 'summary': "Doha : Réunion préparatoire du Sommet arabo-islamique d'urgence avec la participation du Maroc. Le Maroc est représenté à cette réunion par le ministre des Affaires étrangères, de la coopération africaine et des Marocains résidant à l’étranger, Nasser Bourita. La délégation m.", 'size': 4}, {'id': '31', 'title': "Le Maroc prend part au préparatifs du Sommet arabo-islamique d'urgence à Doha", 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Le-Maroc-prend-part-au-preparatifs-du-Sommet-arabo-islamique-d-urgence-a-Doha_a71728.html', 'summary': "Le Maroc prend part au préparatifs du Sommet arabo-islamique d'urgence à Doha. Les travaux de la réunion préparatoire des ministres des Affaires étrangères en prélude du Sommet arabo-islamique d’urgence consacré à l’examen de l’attaque israélienne contre l’État du Qatar ont débuté dimanche à Doha, avec la participation du Maroc", 'size': 4}, {'id': '44', 'title': "Doha : Le Maroc participe à la réunion préparatoire du Sommet arabo-islamique d'urgence", 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/176321/doha-maroc-participe-reunion-preparatoire.html', 'summary': "Doha : Le Maroc participe à la réunion préparatoire du Sommet arabo-islamique d'urgence. Les travaux de la réunion préparatoire des ministres des Affaires étrangères en prélude du Sommet arabo-islamique d’urgence consacré à l’examen de l’attaque israélienne contre l’État du Qatar ont débuté dimanche à Doha, avec la participation du Maroc", 'size': 4}], 'main_title': "Bourita à Doha pour la réunion préparatoire du Sommet arabo-islamique d'urgence"}, {'community_id': '2', 'articles': [{'id': '6', 'title': 'Mondiaux d’athlétisme à Tokyo : les Marocains déçoivent', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/441186-mondiaux-dathletisme-a-tokyo-les-marocains-decoivent.html', 'summary': 'Mondiaux d’athlétisme à Tokyo : les Marocains déçoivent. Les athlètes marocains n’ont pas réussi à se qualifier pour les demi-finales du 1 500 mètres lors des championnats du monde d’athlétisme à Tokyo, qui se poursuivent jusqu’au 21 septembre. Fouad El Massoudi a terminé 10ᵉ de sa série avec un chrono de 3:43.37, tandis que Hafid Rezki s’est classé 7ᵉ de la deuxième série . ', 'size': 3}, {'id': '21', 'title': 'Mondiaux de Tokyo : les athlètes Marocains Fouad Messaoudi, Hafid Rizqy et Anas Essayi éliminés', 'source': 'lematin.ma', 'link': 'https://lematin.ma/sports/mondiaux-de-tokyo-fouad-messaoudi-hafid-rizqy-et-anas-essayi-elimines/301423', 'summary': 'Mondiaux de Tokyo : les athlètes Marocains Fouad Messaoudi, Hafid Rizqy et Anas Essayi éliminés. Fouad Messaoudi a occupé la 10e place de la première série avec un chrono de 3min 37sec 83/100è. Hafid Rizqy a occupé la 7e place (3:41.55) de la 2e série alors que Anas Essayi a t.', 'size': 3}, {'id': '47', 'title': 'Mondiaux de Tokyo : Fouad Messaoudi, Hafid Rizqy et Anas Essayi éliminés du\xa01500 m', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/176311/mondiaux-tokyo-fouad-messaoudi-hafid.html', 'summary': 'Mondiaux de Tokyo : Fouad Messaoudi, Hafid Rizqy et Anas Essayi éliminés du 1500 m. Les athlètes marocains Fouad Messaoudi, Hafid Rizqy et Anas Essayi ont été éliminés, dimanche, en qualifications du concours du 1500 m hommes comptant pour les 20ès championnats du monde dathlétisme, qui se tiennent jusquau 21 septembre à Tokyo.', 'size': 3}], 'main_title': 'Mondiaux d’athlétisme à Tokyo : les Marocains déçoivent'}, {'community_id': '6', 'articles': [{'id': '8', 'title': 'Le porte-hélicoptères français Tonnerre en escale à Casablanca', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/441185-le-porte-helicopteres-francais-tonnerre-en-escale-a-casablanca.html', 'summary': 'Le porte-hélicoptères français Tonnerre en escale à Casablanca. Le porte-hélicoptères amphibie (PHA) Tonnerre a accosté, samedi au port de Casablanca, où il fait escale jusqu’au 16 septembre date de son départ vers le Golfe de Guinée. Cette escale constitue, selon l’ambassade de France au Maroc, « une occasion pour les Marines française et marocaine de renforcer leurs liens, notamment à travers des activités conjointes, . ', 'size': 2}, {'id': '48', 'title': 'Casablanca\xa0: Le PHA français Tonnerre fait escale du 13 au 16 septembre 2025', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/176306/casablanca-francais-tonnerre-fait-escale.html', 'summary': 'Casablanca : Le PHA français Tonnerre fait escale du 13 au 16 septembre 2025. Le porte-hélicoptères amphibie (PHA) Tonnerre est en escale, du 13 au 16 septembre 2025 dans le port de Casablanca. A cette occasion, une réception y a été organisée, samedi, par l’ambassadeur de France Christophe Lecourtier et le capitaine de vaisseau Arnaud Bolelli, commandant du PHA. Ce dernier reprend le large, le 16 septembre vers le Golfe de Guinée, pour la mission «Corymbe» de soutien à la sécurité régionale, sur trois mois.', 'size': 3}, {'id': '67', 'title': 'Diapo: Le porte-hélicoptères français Tonnerre en escale stratégique à Casablanca', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/diapo-le-porte-helicopteres-francais-tonnerre-en-escale-strategique-a-casablanca/', 'summary': 'Diapo: Le porte-hélicoptères français Tonnerre en escale stratégique à Casablanca. Le porte-hélicoptères amphibie (PHA) Tonnerre a effectué une escale dans le port de Casablanca ce 13 septembre 2025. Il repartira le 16 septembre vers le Golfe de Guinée. Ce navire polyvalent, qui peut accueillir à son bord plusieurs hélicoptères et engins de débarquement amphibie (pour le changement de milieu mer – terre), 650 militaires, une .', 'size': 2}, {'id': '97', 'title': 'Maroc | Le porte-hélicoptères amphibie français Tonnerre en escale à Casablanca', 'source': 'www.lereporter.ma', 'link': 'https://www.lereporter.ma/maroc-le-porte-helicopteres-amphibie-francais-tonnerre-en-escale-a-casablanca/', 'summary': 'Maroc | Le porte-hélicoptères amphibie français Tonnerre en escale à Casablanca. Le porte-hélicoptères amphibie (PHA) Tonnerre a accosté, samedi au port de Casablanca, où il fait escale jusqu’au 16 septembre date de son départ vers le Golfe de Guinée. Cette escale constitue, selon l’ambassade de France au Maroc, “une occasion pour les Marines française et marocaine de renforcer leurs liens, notamment à travers des activités conjointes, ', 'size': 3}], 'main_title': 'Casablanca\xa0: Le PHA français Tonnerre fait escale du 13 au 16 septembre 2025'}, {'community_id': '4', 'articles': [{'id': '15', 'title': 'Sport équestre : la 4e édition du Grand Prix d’Afrique rend son verdict à l’hippodrome Casa-Anfa', 'source': 'lematin.ma', 'link': 'https://lematin.ma/sports/grand-prix-dafrique-la-4e-edition-rend-son-verdict/301472', 'summary': 'Sport équestre : la 4e édition du Grand Prix d’Afrique rend son verdict à l’hippodrome Casa-Anfa. Huit courses haletantes, des stands technologiques innovants et un séminaire stratégique : la 4e édition du Grand Prix d’Afrique s’est clôturée, ce samedi, à l’hippodrome de Casa-A.', 'size': 2}, {'id': '50', 'title': "Huit courses palpitantes ont marqué le Grand Prix d'Afrique à Casablanca", 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/176291/huit-courses-palpitantes-marque-grand.html', 'summary': "Huit courses palpitantes ont marqué le Grand Prix d'Afrique à Casablanca. Lhippodrome de Casa-Anfa a accueilli la journée de clôture du Grand Prix dAfrique, avec huit courses, dont le Grand Prix d’Afrique, remporté par Zouhair Madihi. Les deux premiers jours de lévénement étaient consacrés à des expositions pour les professionnels et à des séminaires sur le développement des loteries africaines.", 'size': 2}], 'main_title': 'Sport équestre : la 4e édition du Grand Prix d’Afrique rend son verdict à l’hippodrome Casa-Anfa'}, {'community_id': '5', 'articles': [{'id': '16', 'title': 'Fouzi Lekjaâ : le Maroc aspire à organiser la meilleure CAN de tous les temps', 'source': 'lematin.ma', 'link': 'https://lematin.ma/sports/lekjaa-le-maroc-aspire-a-organiser-la-meilleure-can-de-tous-les-temps/301470', 'summary': 'Fouzi Lekjaâ : le Maroc aspire à organiser la meilleure CAN de tous les temps. Fouzi Lekjaâ, président de la Fédération Royale marocaine de football, a réaffirmé avec force l’ambition du Maroc : offrir au continent une compétition «inoubliable», qui marquera.', 'size': 2}, {'id': '79', 'title': 'Fouzi Lekjaa promet une CAN 2025 historique au Maroc', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/441201-fouzi-lekjaa-promet-une-can-2025-historique-au-maroc.html', 'summary': 'Fouzi Lekjaa promet une CAN 2025 historique au Maroc. À moins de 100 jours du début de la Coupe d’Afrique des Nations, le Maroc affiche ses ambitions avec détermination. Le président de la Fédération royale marocaine de football (FRMF), Fouzi Lekjaa, a affirmé que le Royaume entend offrir « l’édition la plus mémorable de l’histoire de la CAN ». Dans une interview accordée à . ', 'size': 2}], 'main_title': 'Fouzi Lekjaâ : le Maroc aspire à organiser la meilleure CAN de tous les temps'}, {'community_id': '3', 'articles': [{'id': '56', 'title': 'Le Maroc, sous la conduite de SM le Roi, est engagé en faveur de la coopération Sud-Sud et du co-développement en Afrique, souligne Mme Nadia Fettah', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/actualite/le-maroc-sous-la-conduite-de-sm-le-roi-est-engage-en-faveur-de-la-cooperation-sud-sud-et-du-co-developpement-en-afrique-souligne-mme-nadia-fettah', 'summary': 'Le Maroc, sous la conduite de SM le Roi, est engagé en faveur de la coopération Sud-Sud et du co-développement en Afrique, souligne Mme Nadia Fettah. Le Maroc, sous la conduite éclairée de Sa Majesté le Roi Mohammed VI, que Dieu L’assiste, est constamment engagé en faveur de la promotion de la coopération Sud-Sud et du co-développement en Afrique, a souligné, dimanche à Casablanca, la ministre de l’Économie et des Finances, Nadia Fettah. S’exprimant à l’ouverture de la Table Ronde d’Investissement .', 'size': 4}, {'id': '60', 'title': 'Le président Faustin-Archange Touadéra salue le leadership africain «\xa0éclairé et exemplaire\xa0» de SM le Roi', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/le-president-faustin-archange-touadera-salue-le-leadership-africain-eclaire-et-exemplaire-de-sm-le-roi/', 'summary': 'Le président Faustin-Archange Touadéra salue le leadership africain « éclairé et exemplaire » de SM le Roi. Le Président de la République centrafricaine, Professeur Faustin-Archange Touadéra, a salué, dimanche à Casablanca, « la conduite éclairée et le leadership exemplaire » de Sa Majesté le Roi Mohammed VI en faveur d’une Afrique solidaire et prospère. Dans une allocution prononcée à l’occasion de l’ouverture de la Table Ronde d’Investissement consacrée au financement du Plan National de .', 'size': 2}, {'id': '72', 'title': 'Nadia Fettah : Le Maroc, sous la conduite du Roi, est engagé en faveur de la coopération Sud-Sud', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/441223-nadia-fettah-le-maroc-sous-la-conduite-du-roi-est-engage-en-faveur-de-la-cooperation-sud-sud.html', 'summary': 'Nadia Fettah : Le Maroc, sous la conduite du Roi, est engagé en faveur de la coopération Sud-Sud. Le Maroc, sous la conduite du Roi Mohammed VI, est constamment engagé en faveur de la promotion de la coopération Sud-Sud et du co-développement en Afrique, a souligné, dimanche à Casablanca, la ministre de l’Économie et des Finances, Nadia Fettah. S’exprimant à l’ouverture de la Table Ronde d’Investissement consacrée au financement du Plan National de . ', 'size': 3}, {'id': '95', 'title': 'Nadia Fettah: Le Maroc, engagé pour la coopération Sud-Sud et le co-développement en Afrique', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/affaires/nadia-fettah-le-maroc-engage-pour-la-cooperation-sud-sud-et-le-co-developpement-en-afrique/', 'summary': 'Nadia Fettah: Le Maroc, engagé pour la coopération Sud-Sud et le co-développement en Afrique. À Casablanca, la Table Ronde d’Investissement dédiée au financement du Plan National de Développement 2024-2028 de la République centrafricaine met en lumière l’engagement du Maroc en faveur de la coopération Sud-Sud et de l’accompagnement du développement africain.', 'size': 3}], 'main_title': 'Le Maroc, sous la conduite de SM le Roi, est engagé en faveur de la coopération Sud-Sud et du co-développement en Afrique, souligne Mme Nadia Fettah'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
                        
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ? d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        // Fonction pour cacher le tooltip
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = '';
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
    
    
</body>




</html>
    