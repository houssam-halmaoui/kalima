<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); 
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title"> Les principales actualités des dernières 24 heures

</div>    
        <div class="header-subtitle"> Dernière mise à jour : 03/08/2025 - 06h33</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '1', 'articles': [{'id': '4', 'title': 'FT : Donald Trump réaffirme la reconnaissance par les USA de la souveraineté marocaine sur le Sahara', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/436245-ft-donald-trump-reaffirme-la-reconnaissance-par-les-usa-de-la-souverainete-marocaine-sur-le-sahara.html', 'summary': 'FT : Donald Trump réaffirme la reconnaissance par les USA de la souveraineté marocaine sur le Sahara. Dans un message adressé au Roi Mohammed VI à l’occasion de la Fête du Trône, le Président des Etats-Unis d’Amérique, Donald J. Trump, a réaffirmé la reconnaissance par les États-Unis d’Amérique de la souveraineté marocaine sur le Sahara et leur soutien à la proposition d’autonomie marocaine « comme seule base pour un règlement juste et durable . ', 'size': 5}, {'id': '10', 'title': 'Le Président Trump réaffirme à S.M. le Roi la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara', 'source': 'lematin.ma', 'link': 'https://lematin.ma/nation/sahara-trump-reitere-a-sm-le-roi-le-soutien-us-a-la-souverainete-du-maroc/294553', 'summary': 'Le Président Trump réaffirme à S.M. le Roi la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara. Je tiens également à réaffirmer que les États-Unis d’Amérique reconnaissent la souveraineté marocaine sur le Sahara occidental, et qu’ils soutiennent la Proposition d’Autonom.', 'size': 5}, {'id': '28', 'title': 'Donald Trump réaffirme la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Donald-Trump-reaffirme-la-reconnaissance-par-les-Etats-Unis-de-la-souverainete-marocaine-sur-le-Sahara_a70478.html', 'summary': 'Donald Trump réaffirme la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara. \u200bDans un message adressé à SM le Roi Mohammed VI à l’occasion de la Fête du Trône, le Président des Etats-Unis d’Amérique Donald J. Trump a réaffirmé la reconnaissance par les États-Unis d’Amérique de la souveraineté marocaine sur le Sahara et leur soutien à la Proposition d’Autonomie marocaine “comme seule base pour un règlement juste et durable de ce différend”.', 'size': 5}, {'id': '50', 'title': 'Trump réaffirme la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/trump-reaffirme-la-reconnaissance-par-les-etats-unis-de-la-souverainete-marocaine-sur-le-sahara-308028/', 'summary': 'Trump réaffirme la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara. Dans un message adressé à Sa Majesté le Roi Mohammed VI à l’occasion de la Fête du Trône, le président Donald J. Trump a réaffirmé la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara et leur soutien à la proposition d’autonomie marocaine « comme seule base pour un', 'size': 5}, {'id': '64', 'title': 'Le Président Trump réaffirme la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara et leur soutien à la Proposition d’Autonomie', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/actualite/le-president-trump-reaffirme-la-reconnaissance-par-les-etats-unis-de-la-souverainete-marocaine-sur-le-sahara-et-leur-soutien-a-la-proposition-dautonomie', 'summary': 'Le Président Trump réaffirme la reconnaissance par les États-Unis de la souveraineté marocaine sur le Sahara et leur soutien à la Proposition d’Autonomie. Dans un message adressé à SM le Roi Mohammed VI à l’occasion de la Fête du Trône, le Président des Etats-Unis d’Amérique Donald J. Trump a réaffirmé la reconnaissance par les États-Unis d’Amérique de la souveraineté marocaine sur le Sahara et leur soutien à la Proposition d’Autonomie marocaine « comme seule base pour un règlement juste .', 'size': 5}], 'main_title': 'FT : Donald Trump réaffirme la reconnaissance par les USA de la souveraineté marocaine sur le Sahara'}, {'community_id': '0', 'articles': [{'id': '8', 'title': 'CHAN 2024 : une victoire face à l’Angola « essentielle pour la suite », affirme Tarik Sektioui', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/436230-chan-2024-une-victoire-face-a-langola-essentielle-pour-la-suite-affirme-tarik-sektioui.html', 'summary': 'CHAN 2024 : une victoire face à l’Angola « essentielle pour la suite », affirme Tarik Sektioui. À la veille du match d’ouverture du Championnat d’Afrique des nations (CHAN 2024) contre l’Angola, le sélectionneur marocain Tarik Sektioui a insisté samedi à Nairobi sur l’importance cruciale d’un succès pour lancer la compétition sur de bonnes bases. « Gagner ce premier match est primordial pour donner confiance à nos joueurs et installer un état . ', 'size': 2}, {'id': '61', 'title': "CHAN 2024 : Une victoire face à l'Angola, «cruciale pour la suite de la compétition» (Tarik Sektioui)", 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/173355/chan-2024-victoire-face-l-angola.html', 'summary': "CHAN 2024 : Une victoire face à l'Angola, «cruciale pour la suite de la compétition» (Tarik Sektioui). Le sélectionneur national, Tarik Sektioui, a affirmé, samedi à Nairobi, quune victoire de la sélection marocaine des joueurs locaux face à l’Angola, dimanche pour le compte du groupe A du Championnat d’Afrique des nations (CHAN 2024) est «cruciale pour la suite de la compétition».", 'size': 2}], 'main_title': 'CHAN 2024 : une victoire face à l’Angola « essentielle pour la suite », affirme Tarik Sektioui'}, {'community_id': '3', 'articles': [{'id': '19', 'title': 'Tétouan : Réunion sur les futurs programmes de développement territorial', 'source': 'lematin.ma', 'link': 'https://lematin.ma/regions/tetouan-reunion-sur-les-futurs-programmes-de-developpement-territorial/294529', 'summary': "Tétouan : Réunion sur les futurs programmes de développement territorial. Organisée en marge de la rencontre de travail annuelle du ministre de l'Intérieur avec les walis et les gouverneurs, responsables à l’Administration territoriale et aux service.", 'size': 2}, {'id': '70', 'title': 'Tétouan : Rencontre ministérielle pour la mise en œuvre d’une nouvelle génération de programmes de développement territorial', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/au-royaume/tetouan-rencontre-ministerielle-pour-la-mise-en-oeuvre-dune-nouvelle-generation-de-programmes-de-developpement-territorial/', 'summary': "Tétouan : Rencontre ministérielle pour la mise en œuvre d’une nouvelle génération de programmes de développement territorial. Organisée en marge de la rencontre de travail annuelle du ministre de l'Intérieur avec les walis et les gouverneurs, responsables à l’Administration territoriale et aux services centraux du ministère, cette réunion a connu la participation de plusieurs ministres.", 'size': 2}], 'main_title': 'Tétouan : Réunion sur les futurs programmes de développement territorial'}, {'community_id': '4', 'articles': [{'id': '43', 'title': 'COP15 Ramsar : Le consensus international déjoue une énième attaque algérienne contre l’intégrité territoriale du Maroc', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/COP15-Ramsar-Le-consensus-international-dejoue-une-enieme-attaque-algerienne-contre-l-integrite-territoriale-du-Maroc_a70463.html', 'summary': 'COP15 Ramsar : Le consensus international déjoue une énième attaque algérienne contre l’intégrité territoriale du Maroc. La 15ᵉ session de la Conférence des Parties (COP15) à la Convention sur les zones humides (Ramsar) s’est tenue à Victoria Falls (Zimbabwe) du 23 au 31 juillet 2025. Lors de cet événement international majeur, le Maroc s’est illustré par son engagement pour les zones humides, et a déjoué une tentative de politisation de la Convention par l’Algérie.', 'size': 3}, {'id': '66', 'title': 'COP15 Ramsar : Le Maroc réaffirme son engagement pour les zones humides et déjoue une tentative de politisation de la Convention', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/actualite/cop15-ramsar-le-maroc-reaffirme-son-engagement-pour-les-zones-humides-et-dejoue-une-tentative-de-politisation-de-la-convention', 'summary': 'COP15 Ramsar : Le Maroc réaffirme son engagement pour les zones humides et déjoue une tentative de politisation de la Convention. La 15ᵉ session de la Conférence des Parties (COP15) à la Convention sur les zones humides (Ramsar) s’est tenue à Victoria Falls, au Zimbabwe, du 23 au 31 juillet 2025, avec la participation de représentants de plus de 170 Parties contractantes en vue de renforcer la gouvernance et la protection des zones humides à l’échelle .', 'size': 3}, {'id': '98', 'title': 'COP15 Ramsar : le Maroc réaffirme son engagement pour les zones humides et déjoue une tentative de politisation de la Convention', 'source': 'atlasinfo.fr', 'link': 'https://atlasinfo.fr/cop15-ramsar-le-maroc-reaffirme-son-engagement-pour-les-zones-humides-et-dejoue-une-tentative-de-politisation-de-la-convention.html', 'summary': 'COP15 Ramsar : le Maroc réaffirme son engagement pour les zones humides et déjoue une tentative de politisation de la Convention. La 15ᵉ session de la Conférence des Parties (COP15) à la Convention sur les zones humides (Ramsar) s’est tenue à Victoria Falls au Zimbabwe du 23 au 31 juillet 2025 avec la participation de représentants de plus de 170 Parties contractantes en vue de renforcer la gouvernance et la protection des zones humides à l’échelle . L’article est apparu en premier sur .', 'size': 3}], 'main_title': 'COP15 Ramsar : Le consensus international déjoue une énième attaque algérienne contre l’intégrité territoriale du Maroc'}, {'community_id': '5', 'articles': [{'id': '54', 'title': 'Les prévisions du samedi 2 août', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/les-previsions-du-samedi-2-aout-308003/', 'summary': 'Les prévisions du samedi 2 août. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le samedi 2 août 2025. -Temps assez chaud à chaud sur les plaines intérieures, le Sud-Est et sur l’Est des provinces sahariennes. -Nuages faiblement instables avec ondées et orages sur les Haut et Moyen Atlas, les Hauts', 'size': 2}, {'id': '100', 'title': "Le temps qu'il fera ce dimanche 3 août 2025", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/436184-le-temps-quil-fera-ce-dimanche-3-aout-2025.html', 'summary': "Le temps qu'il fera ce dimanche 3 août 2025. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le dimanche 3 août 2025 – Temps chaud sur le Sud-Est, l’Oriental, les plaines intérieures et l’Est des provinces sahariennes. – Nuages bas avec formations brumeuses ou bruines locales sur le Nord de l’Oriental, la rive méditerranéenne, les plaines Atlantiques Nord et . ", 'size': 2}], 'main_title': 'Les prévisions du samedi 2 août'}, {'community_id': '2', 'articles': [{'id': '69', 'title': 'Marché des changes : Le dirham s’apprécie face à l’euro', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/argent/marche-des-changes-le-dirham-sapprecie-face-a-leuro-2/', 'summary': 'Marché des changes : Le dirham s’apprécie face à l’euro. Le dirham s’est apprécié de 0,6% face à l’euro et s’est déprécié de 1% vis-à-vis du dollar américain, durant la période du 24 au 29 juillet, selon Bank Al-Maghrib (BAM).', 'size': 3}, {'id': '82', 'title': 'Le dirham s’apprécie de 0,6% face à l’euro du 24 au 29 juillet (BAM)', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/le-dirham-sapprecie-de-06-face-a-leuro-du-24-au-29-juillet-bam/', 'summary': 'Le dirham s’apprécie de 0,6% face à l’euro du 24 au 29 juillet (BAM). Le dirham s’est apprécié de 0,6% face à l’euro et s’est déprécié de 1% vis-à-vis du dollar américain, durant la période du 24 au 29 juillet, selon Bank Al-Maghrib (BAM). Au cours de cette période, aucune opération d’adjudication n’a été réalisée sur le marché des changes, précise BAM dans son bulletin des indicateurs hebdomadaires. Les .', 'size': 3}, {'id': '97', 'title': 'Le dirham s’apprécie de 0,6% face à l’euro', 'source': 'atlasinfo.fr', 'link': 'https://atlasinfo.fr/le-dirham-sapprecie-de-06-face-a-leuro.html', 'summary': 'Le dirham s’apprécie de 0,6% face à l’euro. Le dirham s’est apprécié de 0,6% face à l’euro et s’est déprécié de 1% vis-à-vis du dollar américain, durant la période du 24 au 29 juillet, selon Bank Al-Maghrib (BAM). Au cours de cette période, aucune opération d’adjudication n’a été réalisée sur le marché des changes, précise BAM dans son bulletin des indicateurs hebdomadaires. Les . L’article est apparu en premier sur .', 'size': 3}], 'main_title': 'Marché des changes : Le dirham s’apprécie face à l’euro'}, {'community_id': '6', 'articles': [{'id': '105', 'title': 'FT : le Roi félicité par le SG de l’ONU', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/436271-ft-le-roi-felicite-par-le-sg-de-lonu.html', 'summary': 'FT : le Roi félicité par le SG de l’ONU. Le Roi Mohammed VI a reçu un message de félicitations du Secrétaire général des Nations Unies, Antonio Guterres, à l’occasion de la Fête du Trône. Dans ce message, Guterres exprime toutes ses félicitations et ses meilleurs vœux au Souverain et au peuple marocain à l’occasion de cette fête nationale. ', 'size': 2}, {'id': '119', 'title': 'SM le Roi reçoit un message de félicitations du SG de l’ONU à l’occasion de la Fête du Trône', 'source': 'www.lereporter.ma', 'link': 'https://www.lereporter.ma/sm-le-roi-recoit-un-message-de-felicitations-du-sg-de-lonu-a-loccasion-de-la-fete-du-trone/', 'summary': 'SM le Roi reçoit un message de félicitations du SG de l’ONU à l’occasion de la Fête du Trône. Sa Majesté le Roi Mohammed VI a reçu un message de félicitations du Secrétaire général des Nations Unies, Antonio Guterres, à l’occasion de la glorieuse Fête du Trône. Dans ce message, M. Guterres exprime toutes ses félicitations et ses meilleurs vœux à SM le Roi et au peuple marocain à l’occasion de cette fête nationale. ', 'size': 2}], 'main_title': 'FT : le Roi félicité par le SG de l’ONU'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
                        
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ? d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        // Fonction pour cacher le tooltip
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = '';
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
    
    
</body>




</html>
    