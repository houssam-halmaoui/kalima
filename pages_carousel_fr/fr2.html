<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); 
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title"> Les principales actualités des dernières 24 heures

</div>    
        <div class="header-subtitle"> Dernière mise à jour : 17/08/2025 - 18h28</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '6', 'title': "Le temps qu'il fera ce dimanche 17 août 2025", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/437859-le-temps-quil-fera-ce-dimanche-17-aout-2025-2.html', 'summary': "Le temps qu'il fera ce dimanche 17 août 2025. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le dimanche 17 août 2025: – Temps chaud à localement très chaud sur les plaines intérieures Nord et Centres, la vallée de Moulouya, le Sud-Est et l’intérieur des provinces sahariennes et chaud sur l’Oriental. – Nuages bas matinaux et nocturnes avec formations . ", 'size': 2}, {'id': '57', 'title': 'Prévisions météorologiques pour le dimanche 17 août 2025', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/previsions-meteorologiques-pour-le-dimanche-17-aout-2025/', 'summary': 'Prévisions météorologiques pour le dimanche 17 août 2025. Voici les prévisions météorologiques établies par la Direction générale de la météorologie pour le dimanche 17 août 2025: – Temps chaud à localement très chaud sur les plaines intérieures Nord et Centres, la vallée de Moulouya, le Sud-Est et l’intérieur des provinces sahariennes et chaud sur l’Oriental. – Nuages bas matinaux et nocturnes avec formations .', 'size': 2}], 'main_title': "Le temps qu'il fera ce dimanche 17 août 2025"}, {'community_id': '1', 'articles': [{'id': '8', 'title': 'Franc succès du Moussem Moulay Abdellah Amghar', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/437854-franc-succes-du-moussem-moulay-abdellah-amghar.html', 'summary': 'Franc succès du Moussem Moulay Abdellah Amghar. Les festivités du Moussem Moulay Abdellah Amghar, l’une des plus importantes manifestations religieuses et culturelles du Royaume, ont pris fin samedi soir. La cérémonie de clôture de ce festival placé sous le Haut Patronage de Sa Majesté le Roi Mohammed VI a été marquée par l’organisation de prestations artistiques variées, dans une ambiance festive mêlant . ', 'size': 2}, {'id': '89', 'title': "\u200bSous les feux d'artifice: Clôture triomphale du Moussem Moulay Abdallah Amghar", 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/\u200bSous-les-feux-d-artifice-Cloture-triomphale-du-Moussem-Moulay-Abdallah-Amghar_a70884.html', 'summary': "\u200bSous les feux d'artifice: Clôture triomphale du Moussem Moulay Abdallah Amghar. L’édition 2025 du Moussem Moulay Abdellah Amghar s’est achevée ce samedi 16 août par un feu d’artifice monumental, illuminant le ciel de Moulay Abdellah sous les yeux subjugués de milliers de spectateurs. Cet épilogue féerique a couronné huit jours de festivités, confirmant le statut de l’événement comme le plus grand rassemblement culturel et religieux du Maroc, placé sous le Haut Patronage de Sa Majesté le Roi Mohammed VI .", 'size': 2}], 'main_title': 'Franc succès du Moussem Moulay Abdellah Amghar'}, {'community_id': '2', 'articles': [{'id': '10', 'title': 'Hassan Baraka devient le premier athlète marocain à boucler le tour de Manhattan à la nage', 'source': 'lematin.ma', 'link': 'https://lematin.ma/sports/hassan-baraka-premier-marocain-a-reussir-le-tour-de-manhattan-a-la-nage/296858', 'summary': 'Hassan Baraka devient le premier athlète marocain à boucler le tour de Manhattan à la nage. L’aventure s’est déroulée vendredi 15 août à New York. Parti en fin de matinée du sud de Manhattan, Hassan Baraka a parcouru les 48,5 km dans le sens inverse des aiguilles d’une mo.', 'size': 3}, {'id': '49', 'title': 'USA : L’athlète marocain Hassan Baraka réussit l’exploit du tour de Manhattan à la nage', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/influences/usa-lathlete-marocain-hassan-baraka-reussit-lexploit-du-tour-de-manhattan-a-la-nage/', 'summary': "USA : L’athlète marocain Hassan Baraka réussit l’exploit du tour de Manhattan à la nage. Baraka a entamé ce challenge vendredi en fin de matinée (heure locale) au sud de l'île de Manhattan, avant de faire le tour complet de l'île dans le sens inverse des aiguilles d’une montre, bouclant le parcours en 9 heures 53 minutes.", 'size': 3}, {'id': '105', 'title': 'L’athlète marocain Hassan Baraka réussit l’exploit du tour de Manhattan à la nage', 'source': 'atlasinfo.fr', 'link': 'https://atlasinfo.fr/usa-lathlete-marocain-hassan-baraka-reussit-lexploit-du-tour-de-manhattan-a-la-nage.html', 'summary': 'L’athlète marocain Hassan Baraka réussit l’exploit du tour de Manhattan à la nage. L’athlète Hassan Baraka a accompli vendredi l’exploit du tour à la nage de l’île de Manhattan à New York sur une distance de 48,5 km devenant le premier Marocain à réussir cette performance. Baraka a entamé ce challenge vendredi en fin de matinée (heure locale) au sud de l’île de Manhattan, avant de faire le . L’article est apparu en premier sur .', 'size': 3}], 'main_title': 'Hassan Baraka devient le premier athlète marocain à boucler le tour de Manhattan à la nage'}, {'community_id': '3', 'articles': [{'id': '23', 'title': 'Une première usine pilote de graphite hors de Chine opérationnelle à Jorf Lasfar fin 2025', 'source': 'lematin.ma', 'link': 'https://lematin.ma/economie/premiere-usine-pilote-de-graphite-hors-chine-a-jorf-lasfar-fin-2025/296781', 'summary': 'Une première usine pilote de graphite hors de Chine opérationnelle à Jorf Lasfar fin 2025. Basée à Abu Dhabi et spécialisée dans les matériaux pour batteries, la société émiratie Falcon Energy Materials a confirmé que la construction de son usine pilote de graphite à Jor.', 'size': 2}, {'id': '72', 'title': 'Jorf Lasfar s’impose comme nouveau pôle mondial du graphite pour batteries', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/437566-jorf-lasfar-simpose-comme-nouveau-pole-mondial-du-graphite-pour-batteries.html', 'summary': 'Jorf Lasfar s’impose comme nouveau pôle mondial du graphite pour batteries. Le complexe marocain se prépare à accueillir la première unité hors Chine de production industrielle d’anodes en graphite sphérique purifié, avec des premiers échantillons attendus dès septembre 2025. La société Falcon Energy Materials plc a fait part d’avancée importante dans la construction de son usine pilote à Jorf Lasfar. Cette installation, dédiée à la production . ', 'size': 2}], 'main_title': 'Une première usine pilote de graphite hors de Chine opérationnelle à Jorf Lasfar fin 2025'}, {'community_id': '4', 'articles': [{'id': '25', 'title': 'Israël : Netanyahu sous pression des familles des otages à Gaza', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Israel-Netanyahu-sous-pression-des-familles-des-otages-a-Gaza_a70875.html', 'summary': "Israël : Netanyahu sous pression des familles des otages à Gaza. Des manifestations ont débuté dimanche dans plusieurs villes d'Israël pour demander au Premier ministre Benjamin Netanyahu de mettre fin à la guerre dans la bande de Gaza et obtenir un accord pour la libération des otages qui y sont retenus.", 'size': 2}, {'id': '66', 'title': "Nouvelle manifestation de milliers d'Israéliens réclamant la fin de la guerre contre Gaza", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/437915-nouvelle-manifestation-de-milliers-disraeliens-reclamant-la-fin-de-la-guerre-contre-gaza.html', 'summary': "Nouvelle manifestation de milliers d'Israéliens réclamant la fin de la guerre contre Gaza. Des milliers d’Israéliens sont descendus dimanche dans la rue pour réclamer de leur gouvernement un accord de cessez-le-feu à Gaza qui garantirait la libération des otages, des demandes rejetées par le Premier ministre Benjamin Netanyahu. Blocage de routes dans plusieurs villes du pays, pneus en feu et quelques échauffourées avec les forces de l’ordre déployées . ", 'size': 2}], 'main_title': 'Israël : Netanyahu sous pression des familles des otages à Gaza'}, {'community_id': '5', 'articles': [{'id': '27', 'title': 'SM le Roi félicite le Président de la République gabonaise à l’occasion de la fête nationale de son pays', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/SM-le-Roi-felicite-le-President-de-la-Republique-gabonaise-a-l-occasion-de-la-fete-nationale-de-son-pays_a70874.html', 'summary': "SM le Roi félicite le Président de la République gabonaise à l’occasion de la fête nationale de son pays. Sa Majesté le Roi Mohammed VI a adressé un message de félicitations au Président de la République gabonaise, Chef de l’État et Chef du Gouvernement, Son Excellence Monsieur Brice Clotaire Oligui Nguema, à l'occasion de la fête nationale de son pays.", 'size': 2}, {'id': '73', 'title': 'Le Roi Mohammed VI félicite le président gabonais', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/437912-le-roi-mohammed-vi-felicite-le-president-gabonais.html', 'summary': 'Le Roi Mohammed VI félicite le président gabonais. Le Roi Mohammed VI a adressé un message de félicitations au Président de la République gabonaise, Chef de l’État et Chef du Gouvernement, Son Excellence Monsieur Brice Clotaire Oligui Nguema, à l’occasion de la fête nationale de son pays. Dans ce message, le Roi adresse à M. Oligui Nguema Ses vœux les plus chaleureux pour . ', 'size': 2}], 'main_title': 'SM le Roi félicite le Président de la République gabonaise à l’occasion de la fête nationale de son pays'}, {'community_id': '7', 'articles': [{'id': '34', 'title': "Feux de forêts : le Nord du Royaume sous la menace d'un risque extrême", 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Feux-de-forets-le-Nord-du-Royaume-sous-la-menace-d-un-risque-extreme_a70866.html', 'summary': "Feux de forêts : le Nord du Royaume sous la menace d'un risque extrême. L'Agence nationale des Eaux et Forêts (ANEF) vient d'annoncer la publication de son Bulletin de risque des incendies de forêts (BRIF) couvrant la période allant du 17 au 20 août, sur la base de modèles scientifiques de prédiction et d’analyse des données liées à la nature des forêts, leur combustibilité et inflammabilité, ainsi qu’aux paramètres topoclimatiques.", 'size': 2}, {'id': '40', 'title': 'Incendies de forêts : l’ANEF identifie des niveaux de risque extrême dans plusieurs provinces', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/incendies-de-forets-lanef-identifie-des-niveaux-de-risque-extreme-dans-plusieurs-provinces-308654/', 'summary': 'Incendies de forêts : l’ANEF identifie des niveaux de risque extrême dans plusieurs provinces. L’Agence nationale des Eaux et Forêts (ANEF) vient fraîchement de dévoiler son Bulletin de Risque des Incendies de Forêts (BRIF), couvrant la période du 17 au 20 août courant. Une publication qui repose sur des modèles scientifiques de prévision et sur l’analyse de données relatives à la nature des massifs', 'size': 2}], 'main_title': "Feux de forêts : le Nord du Royaume sous la menace d'un risque extrême"}, {'community_id': '8', 'articles': [{'id': '64', 'title': 'CHAN-2024 : Le match contre la RD Congo, un duel à gagner (Youness El Kaabi)', 'source': 'atlasinfo.fr', 'link': 'https://atlasinfo.fr/chan-2024-le-match-contre-la-rd-congo-un-duel-a-gagner-youness-el-kaabi.html', 'summary': 'CHAN-2024 : Le match contre la RD Congo, un duel à gagner (Youness El Kaabi). Le joueur de l’équipe nationale du Maroc des joueurs locaux, Youness El Kaabi a affirmé, samedi à Nairobi, que le match contre la RD Congo, prévu dimanche au stade Nyayo pour le compte de la 5e et dernière journée du groupe A du Championnat d’Afrique des nations de football (CHAN), est un duel à gagner. . L’article est apparu en premier sur .', 'size': 5}, {'id': '68', 'title': 'Tarik Sektioui: la confiance des joueurs a été décisive pour remporter le match contre la RDC', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/437911-tarik-sektioui-la-confiance-des-joueurs-a-ete-decisive-pour-remporter-le-match-contre-la-rdc.html', 'summary': 'Tarik Sektioui: la confiance des joueurs a été décisive pour remporter le match contre la RDC. Le sélectionneur national, Tarik Sektioui a affirmé, dimanche à Nairobi, que la forte personnalité et la confiance en soi des joueurs ont été décisives dans la victoire de l’équipe du Maroc des joueurs locaux sur la RD Congo, pour le compte de la 5e et dernière journée du groupe A du Championnat d’Afrique des nations . ', 'size': 5}, {'id': '96', 'title': 'Championnat d’Afrique des nations\xa0de football: le Maroc file en quarts', 'source': 'www.challenge.ma', 'link': 'https://www.challenge.ma/championnat-dafrique-des-nations-de-football-le-maroc-file-en-quarts-308671/', 'summary': 'Championnat d’Afrique des nations de football: le Maroc file en quarts. La sélection marocaine des joueurs locaux s’est qualifiée pour les quarts de finale du Championnat d’Afrique des nations de football (CHAN), en battant la RD Congo par 3 buts à 1, en match comptant pour la 5e et dernière journée du groupe A, dimanche au stade Nyayo à Nairobi. Les', 'size': 5}, {'id': '97', 'title': 'CHAN 2024 : Le Maroc bat la RDC et se qualifie pour les quarts de finale', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/174408/chan-2024-maroc-qualifie-pour.html', 'summary': 'CHAN 2024 : Le Maroc bat la RDC et se qualifie pour les quarts de finale. La sélection marocaine des joueurs locaux s’est qualifiée pour les quarts de finale du Championnat d’Afrique des nations de football (CHAN), en battant son homologue de la RD Congo par 3 buts à 1, en match de la cinquième et dernière journée du groupe A, disputé dimanche au stade Nyayo à Nairobi.', 'size': 5}, {'id': '99', 'title': 'CHAN-2024 : Le Maroc bat la RD Congo 3-1, se qualifie pour les quarts de finale', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/une/chan-2024-le-maroc-bat-la-rd-congo-3-1-se-qualifie-pour-les-quarts-de-finale', 'summary': 'CHAN-2024 : Le Maroc bat la RD Congo 3-1, se qualifie pour les quarts de finale. La sélection marocaine des joueurs locaux s’est qualifiée pour les quarts de finale du Championnat d’Afrique des nations de football (CHAN), en battant son homologue de la RD Congo par 3 buts à 1, en match de la 5e et dernière journée du groupe A, disputé dimanche au stade Nyayo à Nairobi. Les Lions de .', 'size': 5}], 'main_title': 'CHAN-2024 : Le match contre la RD Congo, un duel à gagner (Youness El Kaabi)'}, {'community_id': '6', 'articles': [{'id': '69', 'title': "Incendies en Espagne: Pedro Sanchez annonce un pacte national pour l'urgence climatique", 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/437887-incendies-en-espagne-pedro-sanchez-annonce-un-pacte-national-pour-lurgence-climatique.html', 'summary': "Incendies en Espagne: Pedro Sanchez annonce un pacte national pour l'urgence climatique. Le Premier ministre espagnol a annoncé un « pacte national pour l’urgence climatique » qui mette de côté « luttes partisanes et questions idéologiques » lors d’une visite à Ourense en Galice, une région du nord-ouest parmi les plus touchées par les incendies. « Le gouvernement espagnol va travailler dès à présent pour qu’en septembre nous puissions disposer des bases . ", 'size': 2}, {'id': '102', 'title': 'Incendies en Espagne: le gouvernement annonce un «\xa0pacte national pour l’urgence climatique\xa0»', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/incendies-en-espagne-le-gouvernement-annonce-un-pacte-national-pour-lurgence-climatique/', 'summary': 'Incendies en Espagne: le gouvernement annonce un « pacte national pour l’urgence climatique ». Le chef du gouvernement espagnol, Pedro Sánchez, a annoncé, dimanche, la mise en place d’un « pacte national pour l’urgence climatique », destiné à dépasser « les luttes partisanes et les clivages idéologiques ». « Le gouvernement d’Espagne va travailler dès à présent pour que, d’ici septembre, nous disposions des bases de ce pacte national permettant d’atténuer et de mieux .', 'size': 2}], 'main_title': "Incendies en Espagne: Pedro Sanchez annonce un pacte national pour l'urgence climatique"}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
                        
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ? d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        // Fonction pour cacher le tooltip
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = '';
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
    
    
</body>




</html>
    