<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); 
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title"> Les principales actualités des dernières 24 heures

</div>    
        <div class="header-subtitle"> Dernière mise à jour : 13/10/2025 - 12h25</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '5', 'articles': [{'id': '6', 'title': 'Mondial U20 : les Lionceaux de l’Atlas continuent d’écrire l’histoire et accèdent au carré d’As', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/445104-mondial-u20-les-lionceaux-de-latlas-continuent-decrire-lhistoire-et-accedent-au-carre-das.html', 'summary': 'Mondial U20 : les Lionceaux de l’Atlas continuent d’écrire l’histoire et accèdent au carré d’As. La sélection marocaine des moins de 20 ans monte en puissance au Chili. Les lionceaux ont validé leur ticket pour le carré d’as de la Coupe du monde de la catégorie, en battant une solide équipe des USA (3-1) ce dimanche au stade El Teniente, à Rancagua. Les buts de la rencontre ont été inscrits . ', 'size': 2}, {'id': '28', 'title': '(Images) Coupe du monde U20 : le Maroc domine les États-Unis (3-1) et file en demi-finales !', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Images-Coupe-du-monde-U20-le-Maroc-domine-les-Etats-Unis-3-1-et-file-en-demi-finales-_a72765.html', 'summary': '(Images) Coupe du monde U20 : le Maroc domine les États-Unis (3-1) et file en demi-finales !. La sélection marocaine des moins de 20 ans de football s’est qualifiée pour les demi-finales de la Coupe du Monde U-20, qui se déroule actuellement au Chili, après avoir battu son homologue américaine (3-1) en quart de finale, disputé dimanche soir au stade El Teniente de Rancagua (87 km au sud de Santiago).', 'size': 5}, {'id': '50', 'title': 'Coupe du Monde U-20 au Chili : le Maroc s’impose face aux États-Unis et se qualifie pour les demi-finales', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/une/coupe-du-monde-u-20-au-chili-le-maroc-simpose-face-aux-etats-unis-et-se-qualifie-pour-les-demi-finales', 'summary': 'Coupe du Monde U-20 au Chili : le Maroc s’impose face aux États-Unis et se qualifie pour les demi-finales. La sélection marocaine des moins de 20 ans de football s’est qualifiée pour les demi-finales de la Coupe du Monde U-20, qui se déroule actuellement au Chili, après avoir battu son homologue américaine (3-1) en quart de finale, disputé dimanche soir au stade El Teniente de Rancagua (87 km au sud de Santiago). L’équipe marocaine .', 'size': 4}, {'id': '111', 'title': 'Mondial U20 : le Maroc s’impose 3-1 face aux États-Unis et file en demi-finales', 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/10/13/mondial-u20-le-maroc-simpose-3-1-face-aux-etats-unis-et-file-en-demi-finales_1955514/', 'summary': 'Mondial U20 : le Maroc s’impose 3-1 face aux États-Unis et file en demi-finales. La sélection marocaine des moins de 20 ans de football s’est qualifiée pour les demi-finales de la Coupe du Monde U-20, qui se déroule actuellement au Chili, après avoir battu son homologue américaine (3-1) en quart de finale, disputé dimanche soir au stade El Teniente de Rancagua (87 km au sud de Santiago). L’équipe marocaine.', 'size': 4}, {'id': '163', 'title': 'Coupe du Monde U-20 au Chili : le Maroc s’impose face aux États-Unis (3-1) et se qualifie pour les demi-finales', 'source': 'atlasinfo.fr', 'link': 'https://atlasinfo.fr/coupe-du-monde-u-20.html', 'summary': 'Coupe du Monde U-20 au Chili : le Maroc s’impose face aux États-Unis (3-1) et se qualifie pour les demi-finales. La sélection marocaine des moins de 20 ans de football s’est qualifiée pour les demi-finales de la Coupe du Monde U-20, qui se déroule actuellement au Chili, après avoir battu son homologue américaine (3-1) en quart de finale, disputé dimanche soir au stade El Teniente de Rancagua (87 km au sud de Santiago). L’équipe marocaine . L’article est apparu en premier sur .', 'size': 4}], 'main_title': '(Images) Coupe du monde U20 : le Maroc domine les États-Unis (3-1) et file en demi-finales !'}, {'community_id': '6', 'articles': [{'id': '37', 'title': 'Visas : L’Égypte assouplit les conditions d’entrée pour les Marocains', 'source': 'www.lopinion.ma', 'link': 'https://www.lopinion.ma/Visas-L-Egypte-assouplit-les-conditions-d-entree-pour-les-Marocains_a72755.html', 'summary': 'Visas : L’Égypte assouplit les conditions d’entrée pour les Marocains. De nouvelles mesures d’entrée en Égypte sont entrées en vigueur afin de permettre aux citoyens marocains, notamment ceux détenteurs d’un titre de séjour ou d’un visa préalablement délivré par certains pays, d’obtenir un visa à leur arrivée en Egypte.', 'size': 2}, {'id': '76', 'title': 'L’Égypte facilite l’accès pour les Marocains à son territoire', 'source': 'fr.hespress.com', 'link': 'https://fr.hespress.com/445128-legypte-facilite-lacces-pour-les-marocains-a-son-territoire.html', 'summary': 'L’Égypte facilite l’accès pour les Marocains à son territoire. L’ambassade d’Égypte annonce de nouvelles mesures conçues pour faciliter l’entrée des citoyens marocains en Égypte, et ce dans le cadre du renforcement des liens entre les deux pays. Dans le but de renforcer les relations bilatérales entre le Maroc et l’Égypte, cette dernière va simplifier les procédures d’accès pour les citoyens marocains sur son territoire. . ', 'size': 2}], 'main_title': 'Visas : L’Égypte assouplit les conditions d’entrée pour les Marocains'}, {'community_id': '1', 'articles': [{'id': '71', 'title': 'Lancement lundi prochain de l’opération de vente des billets pour la CAN Maroc-2025', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/lancement-lundi-prochain-de-loperation-de-vente-des-billets-pour-la-can-maroc-2025/', 'summary': 'Lancement lundi prochain de l’opération de vente des billets pour la CAN Maroc-2025. La vente des billets pour la Coupe d’Afrique des Nations (CAN) Maroc-2025, plus grand événement sportif du continent, débutera lundi 13 octobre 2025, a annoncé samedi la Confédération Africaine de Football (CAF). Selon un communiqué de la CAF, l’opération de vente des billets pour CAN Maroc-2025 sera lancée à partir de 09h00 (08h00 GMT), avec .', 'size': 3}, {'id': '109', 'title': 'La vente des billets pour la CAN 2025 est ouverte', 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/10/13/la-vente-des-billets-pour-la-can-2025-est-ouverte_1955520/', 'summary': 'La vente des billets pour la CAN 2025 est ouverte. La vente des billets pour la Coupe d’Afrique des Nations (CAN) Maroc-2025, plus grand événement sportif du continent, a débuté ce lundi 13 octobre 2025. Selon un communiqué de la CAF, l’opération de vente des billets pour CAN Maroc-2025 a été lancée à partir de 09h00 (08h00 GMT), avec une fenêtre exclusive de 48 heures.', 'size': 3}, {'id': '174', 'title': 'CAN Maroc-2025 : ouverture de la billetterie ce lundi 13 octobre', 'source': 'lnt.ma', 'link': 'https://lnt.ma/can-maroc-2025-ouverture-de-la-billetterie-ce-lundi-13-octobre/', 'summary': 'CAN Maroc-2025 : ouverture de la billetterie ce lundi 13 octobre. La Confédération africaine de football (CAF) a annoncé samedi que la vente des billets pour la Coupe d’Afrique des Nations (CAN) Maroc-2025 débutera lundi 13 octobre à 09h00 (08h00 GMT). Une fenêtre de prévente de 48 heures sera d’abord réservée aux détenteurs de cartes VISA, avant l’ouverture de la vente grand public. Selon la CAF, . ', 'size': 3}], 'main_title': 'Lancement lundi prochain de l’opération de vente des billets pour la CAN Maroc-2025'}, {'community_id': '4', 'articles': [{'id': '72', 'title': 'La composition du Gouvernement Lecornu II', 'source': 'atlasinfo.fr', 'link': 'https://atlasinfo.fr/la-composition-du-gouvernement-lecornu-ii.html', 'summary': "La composition du Gouvernement Lecornu II. Le 12 octobre 2025, à Paris, le Premier ministre Sébastien Lecornu s'est rendu à l'Élysée dans l'après-midi pour arrêter avec le président Emmanuel Macron la composition du nouveau gouvernement Lecornu II, annoncé dans la soirée avec des nominations mêlant reconductions et profils techniques. L’article est apparu en premier sur .", 'size': 2}, {'id': '136', 'title': 'Gouvernement Lecornu II : Voici les nouveaux ministres annoncés par l’Élysée', 'source': 'maroc-diplomatique.net', 'link': 'https://maroc-diplomatique.net/gouvernement-lecornu-ii-voici-les-nouveaux-ministres-annonces-par-lelysee/', 'summary': 'Gouvernement Lecornu II : Voici les nouveaux ministres annoncés par l’Élysée. Voici la liste du nouveau gouvernement français dirigé par le premier ministre Sébastien Lecornu, annoncée dimanche soir par l’Elysée : – Sébastien Lecornu, Premier ministre, chargé de la planification écologique et énergétique Les ministres : -Laurent Nunez, ministre de l’intérieur ; -Catherine Vautrin, ministre des Armées et des Anciens combattants ; -Jean-Pierre Farandou, ministre du .', 'size': 2}], 'main_title': 'La composition du Gouvernement Lecornu II'}, {'community_id': '3', 'articles': [{'id': '93', 'title': 'Mondial U20 : le Maroc vise la finale et le titre (Ouahbi)', 'source': 'lematin.ma', 'link': 'https://lematin.ma/sports/mondial-u20-le-maroc-vise-la-finale-et-le-titre-ouahbi/307193', 'summary': 'Mondial U20 : le Maroc vise la finale et le titre (Ouahbi). Dans une déclaration à la presse après la victoire 3-1 de l’équipe nationale face aux États-Unis en quart de finale, Mohamed Ouahbi a ajouté que les membres de l’équipe nationale s.', 'size': 2}, {'id': '135', 'title': 'Mohammed Ouahbi : «\xa0Notre objectif est d’atteindre la finale et de remporter le titre\xa0»', 'source': 'www.lavieeco.com', 'link': 'https://www.lavieeco.com/sport/mohammed-ouahbi-notre-objectif-est-datteindre-la-finale-et-de-remporter-le-titre/', 'summary': 'Mohammed Ouahbi : « Notre objectif est d’atteindre la finale et de remporter le titre ». Dans une déclaration à la presse après la victoire 3-1 de l’équipe nationale face aux États-Unis en quart de finale, Ouahbi a indiqué que le Maroc va se préparer à la demi-finale de la même manière que pour les matchs précédents. Le Maroc défiera la France mercredi à 21h (GMT+1) pour une place en finale.', 'size': 2}], 'main_title': 'Mondial U20 : le Maroc vise la finale et le titre (Ouahbi)'}, {'community_id': '8', 'articles': [{'id': '94', 'title': 'Golden Trail World Series : le Marocain Elhousine Elazzaoui sacré champion du monde', 'source': 'lematin.ma', 'link': 'https://lematin.ma/sports/golden-trail-world-series-elhousine-elazzaoui-sacre-champion-du-monde/307195', 'summary': 'Golden Trail World Series : le Marocain Elhousine Elazzaoui sacré champion du monde. Après sa victoire vendredi lors du prologue, le traileur marocain s’est de nouveau illustré dimanche en remportant la grande finale du circuit des Golden Trail World Series à Garda.', 'size': 3}, {'id': '110', 'title': 'Golden Trail World Series : Elhousine Elazzaoui sacré champion du monde', 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/10/13/golden-trail-world-series-elhousine-elazzaoui-sacre-champion-du-monde_1955511/', 'summary': 'Golden Trail World Series : Elhousine Elazzaoui sacré champion du monde. L’athlète marocain Elhousine Elazzaoui a remporté le titre de champion du monde, dimanche en Italie, lors de la grande finale du circuit Golden Trail World Series. Après sa victoire vendredi lors du prologue, le traileur marocain s’est de nouveau illustré dimanche en remportant la grande finale du circuit des Golden Trail World Series à Garda.', 'size': 3}, {'id': '120', 'title': 'Golden Trail World Series : Le Marocain Elhousine Elazzaoui sacré champion du monde', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/178620/golden-trail-world-series-marocain.html', 'summary': 'Golden Trail World Series : Le Marocain Elhousine Elazzaoui sacré champion du monde. Lathlète marocain Elhousine Elazzaoui a remporté le titre de champion du monde, dimanche en Italie, lors de la grande finale du circuit Golden Trail World Series.', 'size': 3}], 'main_title': 'Golden Trail World Series : le Marocain Elhousine Elazzaoui sacré champion du monde'}, {'community_id': '0', 'articles': [{'id': '108', 'title': 'Fès : près de 250 participants au départ du Rallye du Maroc 2025', 'source': 'telquel.ma', 'link': 'https://telquel.ma/instant-t/2025/10/13/fes-pres-de-250-participants-au-depart-du-rallye-du-maroc-2025_1955516/', 'summary': 'Fès : près de 250 participants au départ du Rallye du Maroc 2025. Le coup d’envoi du Rallye du Maroc 2025 a été donné, dimanche à Fès, avec la participation de près de 250 concurrents représentant les cinq continents. La première journée de cet événement sportif, placé sous le patronage du roi Mohammed VI, a vu l’organisation du prologue de la cinquième et dernière manche du Championnat du.', 'size': 2}, {'id': '118', 'title': 'Fès : Près de 250 participants au départ du Rallye du Maroc 2025', 'source': 'www.yabiladi.com', 'link': 'https://www.yabiladi.com/articles/details/178631/pres-participants-depart-rallye-maroc.html', 'summary': 'Fès : Près de 250 participants au départ du Rallye du Maroc 2025. Le coup d’envoi du Rallye du Maroc 2025 a été donné, dimanche à Fès, avec la participation de près de 250 concurrents représentant les cinq continents. La première journée a vu l’organisation du prologue de la cinquième et dernière manche du Championnat du monde des rallyes tout-terrain 2025, catégorie Ultimate T1+.', 'size': 2}], 'main_title': 'Fès : près de 250 participants au départ du Rallye du Maroc 2025'}, {'community_id': '2', 'articles': [{'id': '128', 'title': 'Pêche : Près de 8,2 milliards DH de produits commercialisés à fin septembre', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/economie/peche-pres-de-82-milliards-dh-de-produits-commercialises-a-fin-septembre', 'summary': 'Pêche : Près de 8,2 milliards DH de produits commercialisés à fin septembre. Les produits commercialisés de la pêche côtière et artisanale ont atteint, en valeur, près de 8,2 milliards de dirhams (MMDH) à fin septembre 2025, en recul de 3% par rapport à fin septembre 2024, selon l’Office national des pêches (ONP). Le poids global de ces produits s’est établi à 814.742 tonnes (T), en baisse de .', 'size': 2}, {'id': '150', 'title': 'Pêche : près de 8,2 MMDH de produits commercialisés à fin septembre', 'source': 'leseco.ma', 'link': 'https://leseco.ma/maroc/peche-pres-de-82-mmdh-de-produits-commercialises-a-fin-septembre.html', 'summary': 'Pêche : près de 8,2 MMDH de produits commercialisés à fin septembre. La valeur des produits issus de la pêche côtière et artisanale a atteint près de 8,2 milliards de dirhams (MMDH) à fin septembre , enregistrant un repli de 3% par rapport à la même période de l’année précédente, selon les données de l’Office national des pêches (ONP). ', 'size': 2}], 'main_title': 'Pêche : Près de 8,2 milliards DH de produits commercialisés à fin septembre'}, {'community_id': '7', 'articles': [{'id': '129', 'title': 'Destinée aux conducteurs des trottinettes électriques : AtlantaSanad lance une nouvelle offre assurantielle', 'source': 'aujourdhui.ma', 'link': 'https://aujourdhui.ma/economie/destinee-aux-conducteurs-des-trottinettes-electriques-atlantasanad-lance-une-nouvelle-offre-assurantielle', 'summary': 'Destinée aux conducteurs des trottinettes électriques : AtlantaSanad lance une nouvelle offre assurantielle. Mobilité douce : AtlantaSanad lance une offre inédite au niveau national. Il s’agit de l’assurance destinée aux conducteurs de trottinettes électriques ou une draisienne électrique ne dépassant pas 25 km/h. Un nouveau produit qui reflète l’engagement de la compagnie d’accompagner l’évolution des mobilités urbaines et de renforcer la sécurité des usagers. «Avec l’essor de la .', 'size': 2}, {'id': '173', 'title': 'AtlantaSanad lance une assurance dédiée aux conducteurs de trottinettes électriques', 'source': 'lnt.ma', 'link': 'https://lnt.ma/atlantasanad-lance-une-assurance-dediee-aux-conducteurs-de-trottinettes-electriques/', 'summary': 'AtlantaSanad lance une assurance dédiée aux conducteurs de trottinettes électriques. AtlantaSanad a annoncé le lancement d’une offre d’assurance destinée aux conducteurs de trottinettes électriques, présentée comme une première sur le marché marocain. L’initiative s’inscrit dans un contexte d’essor des mobilités dites « douces » dans les grandes villes et vise à renforcer la sécurité des usagers et des tiers. Selon l’assureur, le produit couvre la . ', 'size': 2}], 'main_title': 'Destinée aux conducteurs des trottinettes électriques : AtlantaSanad lance une nouvelle offre assurantielle'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
                        
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ? d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        // Fonction pour cacher le tooltip
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = '';
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
    
    
</body>




</html>
    