<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 31/08/2025 - 12h23</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '8', 'articles': [{'id': '7', 'title': 'إقبال على الثقافة المغربية بالأندلس', 'source': 'www.hespress.com', 'link': 'https://www.hespress.com/%d8%a5%d9%82%d8%a8%d8%a7%d9%84-%d8%b9%d9%84%d9%89-%d8%a7%d9%84%d8%ab%d9%82%d8%a7%d9%81%d8%a9-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8%d9%8a%d8%a9-%d8%a8%d8%a7%d9%84%d8%a3%d9%86%d8%af%d9%84%d8%b3-1616595.html', 'summary': 'إقبال على الثقافة المغربية بالأندلس. شارك أزيد من 1800 طالب وطالبة من 95 مؤسسة تعليمية في إقليم الأندلس الإسباني في برنامج تعليم اللغة العربية والثقافة المغربية (PLACM) خلال الموسم الدراسي 2024-2025، وهو برنامج تديره المملكة المغربية وتموله بشكل كامل في إطار اتفاقية التعاون الثقافي الموقعة مع الحكومة الإسبانية. وأكدت وزيرة التعليم والتدريب المهني في الأندلس، ماريا ديل كارمن كاستيلو، في  إقبال على الثقافة المغربية بالأندلس     - هسبريس جريدة إلكترونية مغربية .', 'size': 2}, {'id': '172', 'title': 'أزيد من 1800 تلميذ في الأندلس يستفيدون من برنامج تعليم اللغة العربية والثقافة المغربية بتمويل مغربي', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a3%d8%b2%d9%8a%d8%af-%d9%85%d9%86-1-800-%d8%aa%d9%84%d9%85%d9%8a%d8%b0-%d9%81%d9%8a-%d8%a7%d9%84%d8%a3%d9%86%d8%af%d9%84%d8%b3-%d9%8a%d8%b3%d8%aa%d9%81%d9%8a%d8%af%d9%88%d9%86-%d9%85%d9%86-%d8%a8/', 'summary': 'أزيد من 1800 تلميذ في الأندلس يستفيدون من برنامج تعليم اللغة العربية والثقافة المغربية بتمويل مغربي. كشفت السلطات التعليمية في إقليم الأندلس أن أزيد من 1.800 تلميذ استفادوا خلال الموسم الدراسي الماضي (2024-2025) من برنامج تعليم اللغة العربية والثقافة المغربية (PLACM)، الذي يتم تمويله وتدبيره بالكامل من طرف المملكة المغربية. 95 مؤسسة تعليمية مشاركة وبحسب معطيات رسمية أوردتها كونسخيرا التنمية التعليمية والتكوين المهني في الأندلس، ماريا ديل كارمن كاستيو، فإن  أزيد من 1800 تلميذ في الأندلس يستفيدون من برنامج تعليم اللغة العربية والثقافة المغربية بتمويل مغربي     .', 'size': 2}], 'main_title': 'إقبال على الثقافة المغربية بالأندلس'}, {'community_id': '12', 'articles': [{'id': '67', 'title': 'الملك يهنئ المنتخب المغربي على الفوز بـ”الشان”', 'source': 'www.alahdat.net', 'link': 'https://www.alahdat.net/archives/205525', 'summary': 'الملك يهنئ المنتخب المغربي على الفوز بـ”الشان”.  بعث الملك محمد السادس، برقية تهنئة إلى أعضاء المنتخب الوطني للاعبين المحليين لكرة القدم بمناسبة فوزه بكأس أمم إفريقيا للاعبين المحليين لكرة القدم “الشان”. وقال الملك، في هذه البرقية: “تتبعنا بكل فخر وابتهاج فوزكم عن جدارة واستحقاق بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024) في نسختها الثامنة، والتي احتضنت أطوارها بشكل مشترك', 'size': 5}, {'id': '138', 'title': 'بعد الإنجاز القاري.. الملك محمد السادس يبعث برقية تهنئة لأسود الأطلس المحليين', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/322045/', 'summary': 'بعد الإنجاز القاري.. الملك محمد السادس يبعث برقية تهنئة لأسود الأطلس المحليين. بعث صاحب الجلالة الملك محمد السادس، نصره الله، برقية تهنئة إلى أعضاء المنتخب الوطني للاعبين المحليين لكرة القدم بمناسبة فوزه بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024). وقال جلالة الملك، في هذه البرقية: “تتبعنا بكل فخر وابتهاج فوزكم عن جدارة واستحقاق بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024) في نسختها الثامنة،', 'size': 5}, {'id': '160', 'title': 'برقية ملكية إلى لاعبي المنتخب المحلي: فوزكم الثالث بـ”الشان” يزكي إنجازات الكرة المغربية', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1096170.html', 'summary': 'برقية ملكية إلى لاعبي المنتخب المحلي: فوزكم الثالث بـ”الشان” يزكي إنجازات الكرة المغربية. بعث الملك محمد السادس، برقية تهنئة إلى أعضاء المنتخب الوطني للاعبين المحليين لكرة القدم بمناسبة فوزه بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024). وقال الملك، في هذه البرقية: “تتبعنا بكل فخر وابتهاج فوزكم عن جدارة واستحقاق بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024) في نسختها الثامنة، والتي احتضنت أطوارها بشكل مشترك ظهرت المقالة برقية ملكية إلى لاعبي المنتخب المحلي: فوزكم الثالث بـ”الشان” يزكي إنجازات الكرة المغربية  .', 'size': 5}, {'id': '230', 'title': 'جلالة الملك يهنئ أعضاء المنتخب الوطني للاعبين المحليين بمناسبة فوزه بكأس أمم إفریقیا', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226493/', 'summary': 'جلالة الملك يهنئ أعضاء المنتخب الوطني للاعبين المحليين بمناسبة فوزه بكأس أمم إفریقیا. بعث صاحب الجلالة الملك محمد السادس، نصره الله، برقية تهنئة إلى أعضاء المنتخب الوطني للاعبين المحليين لكرة القدم بمناسبة فوزه بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024). وقال جلالة الملك، في هذه البرقية: “تتبعنا بكل فخر وابتهاج فوزكم عن جدارة واستحقاق بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024) في نسختها الثامنة،', 'size': 5}, {'id': '243', 'title': 'الملك محمد السادس يهنئ أعضاء منتخب المحليين بمناسبة فوزه بكأس أمم إفریقیا (الشان 2024)', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d9%84%d9%85%d9%84%d9%83-%d9%85%d8%ad%d9%85%d8%af-%d8%a7%d9%84%d8%b3%d8%a7%d8%af%d8%b3-%d9%8a%d9%87%d9%86%d8%a6-%d8%a3%d8%b9%d8%b6%d8%a7%d8%a1-%d9%85%d9%86%d8%aa%d8%ae%d8%a8-%d8%a7%d9%84%d9%85/', 'summary': 'الملك محمد السادس يهنئ أعضاء منتخب المحليين بمناسبة فوزه بكأس أمم إفریقیا (الشان 2024). بعث الملك محمد السادس، برقية تهنئة إلى أعضاء المنتخب الوطني للاعبين المحليين لكرة القدم بمناسبة فوزه بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024). وقال الملك محمد السادس، في هذه البرقية: “تتبعنا بكل فخر وابتهاج فوزكم عن جدارة واستحقاق بكأس أمم إفريقيا للاعبين المحليين لكرة القدم (الشان 2024) في نسختها الثامنة، والتي …  الملك محمد السادس يهنئ أعضاء منتخب المحليين بمناسبة فوزه بكأس أمم إفریقیا (الشان 2024)     .', 'size': 5}], 'main_title': 'الملك يهنئ المنتخب المغربي على الفوز بـ”الشان”'}, {'community_id': '11', 'articles': [{'id': '71', 'title': 'ولي العهد الأمير مولاي الحسن يواصل مساره الأكاديمي بخطوة جديدة في مجال العلاقات الدولية', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/national/411874.html', 'summary': 'ولي العهد الأمير مولاي الحسن يواصل مساره الأكاديمي بخطوة جديدة في مجال العلاقات الدولية. بعد نجاحه في نيل شهادة الماستر ببحث معمق حول المبادرة الأطلسية التي أطلقها والده الملك محمد السادس، أمير المؤمنين، لمساعدة دول الساحل الإفريقي غير الساحلية', 'size': 2}, {'id': '190', 'title': 'ولي العهد الأمير مولاي الحسن يواصل مساره الأكاديمي بإعداد أطروحة الدكتوراه في العلاقات الدولية', 'source': 'rue20.com', 'link': 'https://rue20.com/932476.html', 'summary': 'ولي العهد الأمير مولاي الحسن يواصل مساره الأكاديمي بإعداد أطروحة الدكتوراه في العلاقات الدولية.  الرباط يواصل ولي العهد الأمير مولاي الحسن مساره الأكاديمي بخطى ثابتة، حيث يستعد لإعداد أطروحة الدكتوراه في مجال العلاقات الدولية، وذلك بعد نيله شهادة الماستر في العلاقات الدولية والشؤون العامة بموضوع رفيع يهم المشروع الملكي الاستراتيجي المتعلق بـ”المشروع الأطلسي” الذي أطلقه جلالة الملك محمد السادس. ويشكل هذا التوجه الأكاديمي امتداداً لانخراط ولي العهد في الخبر ولي العهد الأمير مولاي الحسن يواصل مساره الأكاديمي بإعداد أطروحة الدكتوراه في العلاقات الدولية  .', 'size': 2}], 'main_title': 'ولي العهد الأمير مولاي الحسن يواصل مساره الأكاديمي بخطوة جديدة في مجال العلاقات الدولية'}, {'community_id': '3', 'articles': [{'id': '95', 'title': 'المغرب يمنع استخدام مادة مسرطنة في طلاء الأظافر', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411902.html', 'summary': 'المغرب يمنع استخدام مادة مسرطنة في طلاء الأظافر. أعلنت الوكالة المغربية للأدوية والمنتجات الصحية منع تسويق وتصنيع واستيراد وتوزيع واستعمال منتجات التجميل التي تحتوي على أكسيد ثنائي الفينيل ثلاثي ميثيل بنزويل الفوسفين، المعروف', 'size': 2}, {'id': '198', 'title': 'تستعمل في طلاء الأظافر.. الوكالة المغربية للأدوية والمنتجات الصحية تمنع تسويق مادة تجميلية', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/474138.html', 'summary': 'تستعمل في طلاء الأظافر.. الوكالة المغربية للأدوية والمنتجات الصحية تمنع تسويق مادة تجميلية. أعلنت الوكالة المغربية للأدوية والمنتجات الصحية، منع تسويق وتصنيع واستيراد وتوزيع واستعمال منتجات التجميل التي تحتوي على أكسيد ثنائي الفينيل ثلاثي ميثيل بنزويل الفوسفين، المعروف باسم (TPO).', 'size': 2}], 'main_title': 'المغرب يمنع استخدام مادة مسرطنة في طلاء الأظافر'}, {'community_id': '1', 'articles': [{'id': '101', 'title': 'فنانة مغربية مهددة بالترحيل من فرنسا', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/culture/411908.html', 'summary': 'فنانة مغربية مهددة بالترحيل من فرنسا. تعيش الفنانة المغربية مريم أبو الوفا أزمة غير مسبوقة بفرنسا، بعدما صدر في حقها قرار إداري يقضي بعدم تجديد إقامتها وإلزامها بمغادرة التراب الفرنسي في', 'size': 2}, {'id': '311', 'title': 'السلطات الفرنسية تهدد بترحيل فنانة مغربية من أراضيها', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/322059/', 'summary': 'السلطات الفرنسية تهدد بترحيل فنانة مغربية من أراضيها. تواجه الفنانة المغربية المقيمة في فرنسا، مريم أبو الوفا، أزمة كبيرة بعد صدور قرار إداري يقضي بعدم تجديد تصريح إقامتها، مع إلزامها بمغادرة الأراضي الفرنسية خلال مهلة لا تتجاوز 30 يوما. وتفاجأت الفنانة المغربية بقرار ترحيلها، خاصة وأنها استقرت في فرنسا منذ عدة سنوات، وأسست فيها حياتها المهنية والعائلية. وتجد مريم أبو الوفا، البالغة من', 'size': 2}], 'main_title': 'فنانة مغربية مهددة بالترحيل من فرنسا'}, {'community_id': '5', 'articles': [{'id': '102', 'title': 'كأس إفريقيا للمحليين.. اختيار حريمات أفضل لاعب، وأسامة لمليوي أفضل هداف', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/sport/footmarocain/411909.html', 'summary': 'كأس إفريقيا للمحليين.. اختيار حريمات أفضل لاعب، وأسامة لمليوي أفضل هداف. اختير لاعب وسط الميدان المغربي، محمد ربيع حريمات، أفضل لاعب في الدورة الثامنة لبطولة أمم إفريقيا للاعبين المحليين لكرة القدم 2024، التي ظفر المغرب بلقبها،', 'size': 3}, {'id': '136', 'title': 'المغرب يعتلي عرش “الشان”.. حريمات أفضل لاعب ولمليوي هداف البطولة', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/322039/', 'summary': 'المغرب يعتلي عرش “الشان”.. حريمات أفضل لاعب ولمليوي هداف البطولة. اختير لاعب وسط الميدان المغربي، محمد ربيع حريمات، أفضل لاعب في الدورة الثامنة لبطولة أمم إفريقيا للاعبين المحليين لكرة القدم 2024، التي ظفر المغرب بلقبها، اليوم السبت بنيروبي، على حساب مدغشقر (3-2). بدوره، أحرز أسامة لمليوي جائزة هداف البطولة، بتسجيله ستة أهداف، اثنان منها في النهائي. وكان عميد “أسود الأطلس”، حريمات، اختير أفضل لاعب في', 'size': 4}, {'id': '182', 'title': 'الأسود المحليون يسيطرون على جوائز أفضل لاعب وأفضل هداف', 'source': 'rue20.com', 'link': 'https://rue20.com/932541.html', 'summary': 'الأسود المحليون يسيطرون على جوائز أفضل لاعب وأفضل هداف. . الرباط اختير لاعب وسط الميدان المغربي، محمد ربيع حريمات، أفضل لاعب في الدورة الثامنة لبطولة أمم إفريقيا للاعبين المحليين لكرة القدم 2024، التي ظفر المغرب بلقبها، اليوم السبت بنيروبي، على حساب مدغشقر (3-2). بدوره، أحرز أسامة لمليوي جائزة هداف البطولة، بتسجيله ستة أهداف، اثنان منها في النهائي. وكان عميد “أسود الأطلس”، حريمات، اختير الخبر الأسود المحليون يسيطرون على جوائز أفضل لاعب وأفضل هداف  .', 'size': 3}, {'id': '194', 'title': '“الشان” 2024.. اختيار محمد ربيع حريمات أفضل لاعب وأسامة لمليوي أفضل هداف', 'source': 'machahid24.com', 'link': 'https://machahid24.com/sport/474144.html', 'summary': '“الشان” 2024.. اختيار محمد ربيع حريمات أفضل لاعب وأسامة لمليوي أفضل هداف. اختير لاعب وسط الميدان المغربي، محمد ربيع حريمات، أفضل لاعب في الدورة الثامنة لبطولة أمم إفريقيا للاعبين المحليين لكرة القدم 2024، التي ظفر المغرب بلقبها، اليوم السبت بنيروبي، على حساب مدغشقر (3-2).', 'size': 4}], 'main_title': 'المغرب يعتلي عرش “الشان”.. حريمات أفضل لاعب ولمليوي هداف البطولة'}, {'community_id': '6', 'articles': [{'id': '106', 'title': 'نبيل عيوش يصدم الجميع برسالة حول قطاع غزة رغم أن والدته يهودية', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/culture/411914.html', 'summary': 'نبيل عيوش يصدم الجميع برسالة حول قطاع غزة رغم أن والدته يهودية. فاجأ المخرج المغربي نبيل عيوش وزوجته المخرجة والممثلة مريم التوزاني، الجمهور والإعلام على حد سواء في مهرجان فينيسيا السينمائي الدولي الدورة 82، برسالة واضحة حول', 'size': 3}, {'id': '146', 'title': 'نبيل عيوش وزوجته يوجهان رسالة قوية من مهرجان فينيسيا', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-587190.html', 'summary': 'نبيل عيوش وزوجته يوجهان رسالة قوية من مهرجان فينيسيا. في مبادرة إنسانية لافتة، اختار المخرج المغربي نبيل عيوش وزوجته الممثلة والمخرجة مريم التوزاني، التضامن مع غزة الواقعة تحت الإبادة والتجويع الإسرائيليين، بطريقة خاصة. وظهر المخرجان المغربيان وهما يحملان حقيبة يد مستوحاة من الكوفية الفلسطينية، مزينة بعبارة “أوقفوا الإبادة الجماعية في غزة”، أمام عدسات الكاميرات الدولية على هامش الدورة الـ82 من مهرجان', 'size': 3}, {'id': '166', 'title': 'والدته يهودية.. عيوش يرفع شعار “أوقفوا الإبادة في غزة” بمهرجان فينيسيا', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1096091.html', 'summary': 'والدته يهودية.. عيوش يرفع شعار “أوقفوا الإبادة في غزة” بمهرجان فينيسيا. لفت المخرج المغربي نبيل عيوش وزوجته الممثلة والمخرجة مريم التوزاني الأنظار عندما رفعا حقيبة يد ظهرت المقالة والدته يهودية.. عيوش يرفع شعار “أوقفوا الإبادة في غزة” بمهرجان فينيسيا  .', 'size': 3}], 'main_title': 'نبيل عيوش يصدم الجميع برسالة حول قطاع غزة رغم أن والدته يهودية'}, {'community_id': '7', 'articles': [{'id': '108', 'title': 'أمن تطوان يوقف متورطين في شجار عنيف بالشارع العام', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411916.html', 'summary': 'أمن تطوان يوقف متورطين في شجار عنيف بالشارع العام. تفاعلت ولاية أمن تطوان، بجدية كبيرة، مع شريط فيديو منشور على صفحات مواقع التواصل الاجتماعي، يظهر فيه أشخاص يتبادلون العنف بالشارع العام بمدينة تطوان. وقد أوضحت', 'size': 2}, {'id': '239', 'title': 'تطوان.. الشرطة توقف متورطين في شجار عنيف بالشارع العام', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d8%b7%d9%88%d8%a7%d9%86-%d8%a7%d9%84%d8%b4%d8%b1%d8%b7%d8%a9-%d8%aa%d9%88%d9%82%d9%81-%d9%85%d8%aa%d9%88%d8%b1%d8%b7%d9%8a%d9%86-%d9%81%d9%8a-%d8%b4%d8%ac%d8%a7%d8%b1-%d8%b9%d9%86%d9%8a%d9%81/', 'summary': 'تطوان.. الشرطة توقف متورطين في شجار عنيف بالشارع العام. أفاد مصدر أمني، اليوم السبت 30 غشت الجاري، أن ولاية أمن تطوان، تفاعلت بجدية كبيرة، مع شريط فيديو منشور على صفحات مواقع التواصل الاجتماعي، يظهر فيه أشخاص يتبادلون العنف بالشارع العام بمدينة تطوان. وقد أوضحت الأبحاث والتحريات المنجزة على ضوء هذا الشريط، أن الأمر يتعلق بقضية زجرية عالجتها مصالح الشرطة بمدينة تطوان، حيث …  تطوان.. الشرطة توقف متورطين في شجار عنيف بالشارع العام     .', 'size': 2}], 'main_title': 'أمن تطوان يوقف متورطين في شجار عنيف بالشارع العام'}, {'community_id': '0', 'articles': [{'id': '118', 'title': 'آيت ملول.. توقيف سبعة متورطين في قضية نصب وقرصنة معطيات بنكية', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a2%d9%8a%d8%aa-%d9%85%d9%84%d9%88%d9%84-%d8%aa%d9%88%d9%82%d9%8a%d9%81-%d8%b3%d8%a8%d8%b9%d8%a9-%d9%85%d8%aa%d9%88%d8%b1%d8%b7%d9%8a%d9%86-%d9%81%d9%8a-%d9%82%d8%b6%d9%8a%d8%a9-%d9%86%d8%b5/', 'summary': 'آيت ملول.. توقيف سبعة متورطين في قضية نصب وقرصنة معطيات بنكية. تمكّنت عناصر الشرطة القضائية بمدينة أيت ملول، بتنسيق وثيق مع مصالح المديرية العامة لمراقبة التراب الوطني، زوال اليوم السبت (30 غشت) الجاري، من توقيف سبعة أشخاص، من بينهم سيدتان، وذلك للاشتباه في تورطهم في قضية تتعلق بالنصب والاحتيال والمس بأنظمة المعالجة الآلية للمعطيات البنكية. وجاء توقيف المشتبه فيهم على خلفية شكاية تقدم بها أحد الضحايا،', 'size': 3}, {'id': '240', 'title': 'أمن أيت ملول يوقف شبكة من سبعة أشخاص متورطين في النصب وقرصنة معطيات بنكية', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a3%d9%85%d9%86-%d8%a3%d9%8a%d8%aa-%d9%85%d9%84%d9%88%d9%84-%d9%8a%d9%88%d9%82%d9%81-%d8%b4%d8%a8%d9%83%d8%a9-%d9%85%d9%86-%d8%b3%d8%a8%d8%b9%d8%a9-%d8%a3%d8%b4%d8%ae%d8%a7%d8%b5-%d9%85%d8%aa%d9%88/', 'summary': 'أمن أيت ملول يوقف شبكة من سبعة أشخاص متورطين في النصب وقرصنة معطيات بنكية. أفاد مصدر أمني، أن عناصر الشرطة القضائية بمدينة أيت ملول بتنسيق مع مصالح المديرية العامة لمراقبة التراب الوطني، تمكنت زوال يومه السبت 30 غشت الجاري، من توقيف سبعة أشخاص من بينهم سيدتان، وذلك للاشتباه في تورطهم في قضية تتعلق بالنصب والاحتيال والمس بأنظمة المعالجة الآلية للمعطيات البنكية. وحسب ذات المصدر، كانت مصالح الشرطة …  أمن أيت ملول يوقف شبكة من سبعة أشخاص متورطين في النصب وقرصنة معطيات بنكية     .', 'size': 2}, {'id': '285', 'title': 'بينهم سيدتان..تفكيك شبكة احتيال رقمي وتوقيف 7 متورطين بأيت ملول', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411925.html', 'summary': 'بينهم سيدتان..تفكيك شبكة احتيال رقمي وتوقيف 7 متورطين بأيت ملول. تمكنت عناصر الشرطة القضائية بمدينة أيت ملول بتنسيق مع مصالح المديرية العامة لمراقبة التراب الوطني، زوال يوم أمس السبت 30 غشت الجاري، من توقيف سبعة أشخاص', 'size': 2}], 'main_title': 'آيت ملول.. توقيف سبعة متورطين في قضية نصب وقرصنة معطيات بنكية'}, {'community_id': '9', 'articles': [{'id': '119', 'title': 'بعد انتشار فيديو شجار عنيف.. أمن تطوان يتدخل ويوقف المشتبه فيهم', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a8%d8%b9%d8%af-%d8%a7%d9%86%d8%aa%d8%b4%d8%a7%d8%b1-%d9%81%d9%8a%d8%af%d9%8a%d9%88-%d8%b4%d8%ac%d8%a7%d8%b1-%d8%b9%d9%86%d9%8a%d9%81-%d8%a3%d9%85%d9%86-%d8%aa%d8%b7%d9%88%d8%a7%d9%86-%d9%8a/', 'summary': 'بعد انتشار فيديو شجار عنيف.. أمن تطوان يتدخل ويوقف المشتبه فيهم. تفاعلت ولاية أمن تطوان بجدية كبيرة مع مقطع فيديو متداول عبر مواقع التواصل الاجتماعي، يُظهر مجموعة من الأشخاص وهم يتبادلون العنف في أحد شوارع المدينة. وكشفت التحريات والأبحاث المنجزة في ضوء هذا التسجيل، أن القضية سبق أن باشرت مصالح الشرطة بتطوان إجراءاتها بشأنها، حيث تم توقيف جميع المتورطين في هذه الأفعال الإجرامية. وقد وُضع المشتبه', 'size': 2}, {'id': '145', 'title': 'أمن تطوان يدخل على خط فيديو متداول على “فيسبوك”', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-587202.html', 'summary': 'أمن تطوان يدخل على خط فيديو متداول على “فيسبوك”. قالت ولاية أمن تطوان، إنها تفاعلت بجدية كبيرة، مع شريط فيديو منشور على صفحات مواقع التواصل الاجتماعي، يظهر فيه أشخاص يتبادلون العنف بالشارع العام بمدينة تطوان. وأوضحت الأبحاث والتحريات المنجزة على ضوء هذا الشريط، توضح ولاية أمن تطوان في بلاغ، أن الأمر يتعلق بقضية زجرية عالجتها مصالح الشرطة بمدينة تطوان، حيث أسفرت', 'size': 2}], 'main_title': 'بعد انتشار فيديو شجار عنيف.. أمن تطوان يتدخل ويوقف المشتبه فيهم'}, {'community_id': '10', 'articles': [{'id': '132', 'title': 'باب سبتة.. توقيف ثلاثيني متورط في تهريب 2400 قرص مهلوس', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/322055/', 'summary': 'باب سبتة.. توقيف ثلاثيني متورط في تهريب 2400 قرص مهلوس. تمكنت عناصر الأمن الوطني والجمارك بمركز باب سبتة، مساء اليوم السبت 30 غشت الجاري، من توقيف شخص يبلغ من العمر 39 سنة، وذلك للاشتباه في تورطه في قضية تتعلق بالتهريب الدولي للمخدرات والمؤثرات العقلية. وقد جرى توقيف المشتبه فيه وهو في حالة تلبس بمحاولة تهريب كمية من الأقراص المهلوسة، حيث أسفرت عملية التفتيش عن العثور', 'size': 3}, {'id': '171', 'title': 'إحباط تهريب كمية من أقراص الهلوسة عبر باب سبتة', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a5%d8%ad%d8%a8%d8%a7%d8%b7-%d8%aa%d9%87%d8%b1%d9%8a%d8%a8-%d9%83%d9%85%d9%8a%d8%a9-%d9%85%d9%86-%d8%a3%d9%82%d8%b1%d8%a7%d8%b5-%d8%a7%d9%84%d9%87%d9%84%d9%88%d8%b3%d8%a9-%d8%b9%d8%a8%d8%b1-%d8%a8/', 'summary': 'إحباط تهريب كمية من أقراص الهلوسة عبر باب سبتة. تمكنت عناصر الأمن الوطني والجمارك بمركز باب سبتة، مساء اليوم السبت، من توقيف شخص يبلغ من العمر 39 سنة، وذلك للاشتباه في تورطه في قضية تتعلق بالتهريب الدولي للمخدرات والمؤثرات العقلية. وقد جرى توقيف المشتبه فيه وهو في حالة تلبس بمحاولة تهريب كمية من الأقراص المهلوسة، حيث أسفرت عملية التفتيش عن العثور بحوزته على  إحباط تهريب كمية من أقراص الهلوسة عبر باب سبتة     .', 'size': 3}, {'id': '304', 'title': 'باب سبتة.. إحباط محاولة تهريب شحنة من القرقوبي', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a8%d8%a7%d8%a8-%d8%b3%d8%a8%d8%aa%d8%a9-%d8%a5%d8%ad%d8%a8%d8%a7%d8%b7-%d9%85%d8%ad%d8%a7%d9%88%d9%84%d8%a9-%d8%aa%d9%87%d8%b1%d9%8a%d8%a8-%d8%b4%d8%ad%d9%86%d8%a9-%d9%85%d9%86-%d8%a7%d9%84/', 'summary': 'باب سبتة.. إحباط محاولة تهريب شحنة من القرقوبي. تمكنت عناصر الأمن الوطني والجمارك بمركز باب سبتة، مساء اليوم السبت (30 غشت)، من توقيف شخص يبلغ من العمر 39 سنة، وذلك للاشتباه في تورطه في قضية تتعلق بالتهريب الدولي للمخدرات والمؤثرات العقلية. وحسب مصدر أمني فقد جرى توقيف المشتبه فيه وهو في حالة تلبس بمحاولة تهريب كمية من الأقراص المهلوسة، حيث أسفرت عملية التفتيش', 'size': 3}], 'main_title': 'باب سبتة.. توقيف ثلاثيني متورط في تهريب 2400 قرص مهلوس'}, {'community_id': '4', 'articles': [{'id': '140', 'title': 'المغرب يحظر مستحضرات تجميل تحتوي على مادة سامة مستخدمة في طلاء الأظافر', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/322026/', 'summary': 'المغرب يحظر مستحضرات تجميل تحتوي على مادة سامة مستخدمة في طلاء الأظافر. أعلنت الوكالة المغربية للأدوية والمنتجات الصحية منع تسويق وتصنيع واستيراد وتوزيع واستعمال منتجات التجميل التي تحتوي على أكسيد ثنائي الفينيل ثلاثي ميثيل بنزويل الفوسفين، المعروف باسم (TPO). وأنهت الوكالة، في بلاغ لها، إلى علم مهنيي الصحة والفاعلين في قطاع التجميل والمستهلكين أن استعمال طلاء الأظافر وأنواع “الجل”، التي تحتوي على مادة (TPO)، أصبح ممنوعا بشكل', 'size': 3}, {'id': '149', 'title': 'المغرب يمنع مادة سامة تستعمل في طلاء الأظافر', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-587173.html', 'summary': 'المغرب يمنع مادة سامة تستعمل في طلاء الأظافر. أعلنت الوكالة المغربية للأدوية والمنتجات الصحية منع تسويق وتصنيع واستيراد وتوزيع واستعمال منتجات التجميل التي تحتوي على أكسيد ثنائي الفينيل ثلاثي ميثيل بنزويل الفوسفين، المعروف باسم (TPO). وأنهت الوكالة، في بلاغ لها، إلى علم مهنيي الصحة والفاعلين في قطاع التجميل والمستهلكين أن استعمال طلاء الأظافر وأنواع “الجل”، التي تحتوي على مادة (TPO)، أصبح', 'size': 3}, {'id': '332', 'title': 'بسبب تأثيراتها الصحية.. المغرب يمنع منتجات التجميل المحتوية على أكسيد ثنائي الفينيل', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a8%d8%b3%d8%a8%d8%a8-%d8%aa%d8%a3%d8%ab%d9%8a%d8%b1%d8%a7%d8%aa%d9%87%d8%a7-%d8%a7%d9%84%d8%b5%d8%ad%d9%8a%d8%a9-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8-%d9%8a%d9%85%d9%86%d8%b9-%d9%85%d9%86%d8%aa/', 'summary': 'بسبب تأثيراتها الصحية.. المغرب يمنع منتجات التجميل المحتوية على أكسيد ثنائي الفينيل. أعلنت الوكالة المغربية للأدوية والمنتجات الصحية منع تسويق وتصنيع واستيراد وتوزيع واستعمال منتجات التجميل التي تحتوي على أكسيد ثنائي الفينيل ثلاثي ميثيل بنزويل الفوسفين، المعروف باسم (TPO). وأنهت الوكالة، في بلاغ لها، إلى علم مهنيي الصحة والفاعلين في قطاع التجميل والمستهلكين أن استعمال طلاء الأظافر وأنواع "الجل"، التي تحتوي على مادة (TPO)، أصبح ممنوعا بشكل  بسبب تأثيراتها الصحية.. المغرب يمنع منتجات التجميل المحتوية على أكسيد ثنائي الفينيل     .', 'size': 3}], 'main_title': 'المغرب يحظر مستحضرات تجميل تحتوي على مادة سامة مستخدمة في طلاء الأظافر'}, {'community_id': '14', 'articles': [{'id': '143', 'title': 'توقعات الأرصاد الجوية لطقس الأحد بالمدن المغربية', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-587194.html', 'summary': 'توقعات الأرصاد الجوية لطقس الأحد بالمدن المغربية. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليوم غد الأحد، أن يظل الطقس حارا نسبیا بكل من السھول الممتدة غرب الأطلس، وشرق البلاد، والجنوب الشرقي، وكذا أقصى جنوب المملكة. كما يرتقب تشكل سحب منخفضة كثیفة، مصحوبة بقطرات مطریة جد خفیفة أو بكتل ضبابیة جوار سواحل المحیط الأطلسي وبالشمال الغربي للأقاليم الجنوبیة، وذلك خلال الصباح واللیل.', 'size': 3}, {'id': '334', 'title': 'طقس حار مع قطرات مطرية متوقع اليوم الأحد', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%b7%d9%82%d8%b3-%d8%ad%d8%a7%d8%b1-%d9%85%d8%b9-%d9%82%d8%b7%d8%b1%d8%a7%d8%aa-%d9%85%d8%b7%d8%b1%d9%8a%d8%a9-%d9%85%d8%aa%d9%88%d9%82%d8%b9-%d8%a7%d9%84%d9%8a%d9%88%d9%85-%d8%a7%d9%84%d8%a3-3/', 'summary': 'طقس حار مع قطرات مطرية متوقع اليوم الأحد. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الأحد، أن يظل الطقس حارا نسبیا بكل من السھول الممتدة غرب الأطلس، وشرق البلاد، والجنوب الشرقي، وكذا أقصى جنوب المملكة. كما يرتقب تشكل سحب منخفضة كثیفة، مصحوبة بقطرات مطریة جد خفیفة أو بكتل ضبابیة جوار سواحل المحیط الأطلسي وبالشمال الغربي للأقاليم الجنوبیة، وذلك خلال الصباح واللیل. ومن المتوقع،  طقس حار مع قطرات مطرية متوقع اليوم الأحد     .', 'size': 3}, {'id': '355', 'title': 'توقعات أحوال الطقس اليوم الأحد', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d8%a7%d9%84%d9%8a%d9%88%d9%85-%d8%a7%d9%84%d8%a3%d8%ad%d8%af-46/', 'summary': 'توقعات أحوال الطقس اليوم الأحد. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليومه الأحد، أن يظل الطقس حارا نسبیا بكل من السھول الممتدة غرب الأطلس، وشرق البلاد، والجنوب الشرقي، وكذا أقصى جنوب المملكة. كما يرتقب تشكل سحب منخفضة كثیفة، مصحوبة بقطرات مطریة جد خفیفة أو بكتل ضبابیة جوار سواحل المحیط الأطلسي وبالشمال الغربي للأقاليم الجنوبیة، وذلك خلال الصباح واللیل. …  توقعات أحوال الطقس اليوم الأحد     .', 'size': 3}], 'main_title': 'توقعات الأرصاد الجوية لطقس الأحد بالمدن المغربية'}, {'community_id': '2', 'articles': [{'id': '183', 'title': 'عز الدين أوناحي يوقع لنادي خيرونا الإسباني حتى سنة 2030', 'source': 'rue20.com', 'link': 'https://rue20.com/932537.html', 'summary': 'عز الدين أوناحي يوقع لنادي خيرونا الإسباني حتى سنة 2030. . الرباط أعلن نادي جيرونا الإسباني، اليوم السبت، عن تعاقده مع الدولي المغربي عز الدين أوناحي، قادما من نادي أولمبيك مارسيليا الفرنسي. وأوضح النادي الكتالوني، في بلاغ له، أن لاعب خط الوسط، البالغ من العمر 25 سنة، وقع عقدا يمتد لخمس مواسم، أي إلى غاية سنة 2030. ووفقا للصحافة الإسبانية، فإن صفقة انتقال عز الخبر عز الدين أوناحي يوقع لنادي خيرونا الإسباني حتى سنة 2030  .', 'size': 2}, {'id': '333', 'title': 'الدولي المغربي عز الدين أوناحي يوقع لنادي جيرونا حتى سنة 2030', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d8%af%d9%88%d9%84%d9%8a-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8%d9%8a-%d8%b9%d8%b2-%d8%a7%d9%84%d8%af%d9%8a%d9%86-%d8%a3%d9%88%d9%86%d8%a7%d8%ad%d9%8a-%d9%8a%d9%88%d9%82%d8%b9-%d9%84%d9%86/', 'summary': 'الدولي المغربي عز الدين أوناحي يوقع لنادي جيرونا حتى سنة 2030. أعلن نادي جيرونا الإسباني، عن تعاقده مع الدولي المغربي عز الدين أوناحي، قادما من نادي أولمبيك مارسيليا الفرنسي. وأوضح النادي الكتالوني، في بلاغ له، أن لاعب خط الوسط، البالغ من العمر 25 سنة، وقع عقدا يمتد لخمسة مواسم، أي إلى غاية سنة 2030. ووفقا للصحافة الإسبانية، فإن صفقة انتقال عز الدين أوناحي، التي قدرت بحوالي  الدولي المغربي عز الدين أوناحي يوقع لنادي جيرونا حتى سنة 2030     .', 'size': 2}], 'main_title': 'عز الدين أوناحي يوقع لنادي خيرونا الإسباني حتى سنة 2030'}, {'community_id': '13', 'articles': [{'id': '192', 'title': '“الشان 2024”.. رئيس مفوضية الاتحاد الإفريقي يهنئ المغرب على تتويجه القاري', 'source': 'machahid24.com', 'link': 'https://machahid24.com/sport/474158.html', 'summary': '“الشان 2024”.. رئيس مفوضية الاتحاد الإفريقي يهنئ المغرب على تتويجه القاري. هنأ رئيس مفوضية الاتحاد الإفريقي، محمود علي يوسف، المملكة المغربية عقب تتويج المنتخب الوطني المغربي للاعبين المحليين ببطولة أمم إفريقيا للاعبين المحليين (الشان 2024)، بعد فوزه اليوم السبت بنيروبي بالبطولة القارية.', 'size': 2}, {'id': '348', 'title': 'رئيس مفوضية الاتحاد الإفريقي يهنئ المملكة المغربية على تتويج منتخبها بـ”الشان”', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%b1%d8%a6%d9%8a%d8%b3-%d9%85%d9%81%d9%88%d8%b6%d9%8a%d8%a9-%d8%a7%d9%84%d8%a7%d8%aa%d8%ad%d8%a7%d8%af-%d8%a7%d9%84%d8%a5%d9%81%d8%b1%d9%8a%d9%82%d9%8a-%d9%8a%d9%87%d9%86%d8%a6-%d8%a7%d9%84%d9%85-2/', 'summary': 'رئيس مفوضية الاتحاد الإفريقي يهنئ المملكة المغربية على تتويج منتخبها بـ”الشان”. هنأ رئيس مفوضية الاتحاد الإفريقي، محمود علي يوسف، المملكة المغربية عقب تتويج المنتخب الوطني المغربي للاعبين المحليين ببطولة أمم إفريقيا للاعبين المحليين (الشان 2024) بعد فوزه أمس السبت بنيروبي بالبطولة القارية. ووصف علي يوسف، في بلاغ صادر عن المنظمة القارية والذي نشر عبر حساباتها على مواقع التواصل الاجتماعي، هذا الفوز بأنه “لحظة فخر …  رئيس مفوضية الاتحاد الإفريقي يهنئ المملكة المغربية على تتويج منتخبها بـ”الشان”     .', 'size': 2}], 'main_title': '“الشان 2024”.. رئيس مفوضية الاتحاد الإفريقي يهنئ المغرب على تتويجه القاري'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    