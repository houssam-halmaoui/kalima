<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 07/09/2025 - 06h14</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '1', 'articles': [{'id': '112', 'title': 'في عملية نوعية.. الفرقة الوطنية المغربية تطيح بعصابة خطيرة ارتكبت عملية سطو مسلح بفرنسا', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/412282.html', 'summary': 'في عملية نوعية.. الفرقة الوطنية المغربية تطيح بعصابة خطيرة ارتكبت عملية سطو مسلح بفرنسا. أحالت الفرقة الوطنية للشرطة القضائية على النيابة العامة المختصة بمدينة الدار البيضاء، ستة أشخاص يشتبه في ارتباطهم بشبكة إجرامية متخصصة في السرقة وإخفاء عائدات', 'size': 3}, {'id': '179', 'title': 'الفرقة الوطنية تفكك شبكة إجرامية دولية متخصصة في السرقة والسطو بفرنسا', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/474686.html', 'summary': 'الفرقة الوطنية تفكك شبكة إجرامية دولية متخصصة في السرقة والسطو بفرنسا. أحالت الفرقة الوطنية للشرطة القضائية على النيابة العامة المختصة بمدينة الدار البيضاء، ستة أشخاص يشتبه في ارتباطهم بشبكة إجرامية متخصصة في السرقة وإخفاء عائدات إجرامية متحصلة من عملية سطو مسلح ارتكبت فوق الأراضي الفرنسية. وذكر مصدر أمني أنه حسب المعلومات الأولية للبحث، مكنت الأبحاث والتحريات التقنية التي باشرتها الفرقة الوطنية للشرطة القضائية من حجز 31 …', 'size': 3}], 'main_title': 'في عملية نوعية.. الفرقة الوطنية المغربية تطيح بعصابة خطيرة ارتكبت عملية سطو مسلح بفرنسا'}, {'community_id': '3', 'articles': [{'id': '129', 'title': 'حجز 31 هاتفا مسروقا من عملية سطو بفرنسا وتوقيف ستة أشخاص بالمغرب', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/322658/', 'summary': 'حجز 31 هاتفا مسروقا من عملية سطو بفرنسا وتوقيف ستة أشخاص بالمغرب. أحالت الفرقة الوطنية للشرطة القضائية على النيابة العامة المختصة بمدينة الدار البيضاء، ستة أشخاص يشتبه في ارتباطهم بشبكة إجرامية متخصصة في السرقة وإخفاء عائدات إجرامية متحصلة من عملية سطو مسلح ارتكبت فوق الأراضي الفرنسية. وحسب المعلومات الأولية للبحث، فقد مكنت الأبحاث والتحريات التقنية التي باشرتها الفرقة الوطنية للشرطة القضائية من حجز 31 هاتفا محمولا متحصلا', 'size': 5}, {'id': '162', 'title': 'الأمن يوقف شبكة متخصصة في سرقة الهواتف في فرنسا وإعادة بيعها بالمغرب', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d8%a3%d9%85%d9%86-%d9%8a%d9%88%d9%82%d9%81-%d8%b4%d8%a8%d9%83%d8%a9-%d9%85%d8%aa%d8%ae%d8%b5%d8%b5%d8%a9-%d9%81%d9%8a-%d8%b3%d8%b1%d9%82%d8%a9-%d8%a7%d9%84%d9%87%d9%88%d8%a7%d8%aa%d9%81/', 'summary': 'الأمن يوقف شبكة متخصصة في سرقة الهواتف في فرنسا وإعادة بيعها بالمغرب. أحالت الفرقة الوطنية للشرطة القضائية على النيابة العامة المختصة بمدينة الدار البيضاء، ستة أشخاص يشتبه في ارتباطهم بشبكة إجرامية متخصصة في السرقة وإخفاء عائدات إجرامية متحصلة من عملية سطو مسلح ارتكبت فوق الأراضي الفرنسية. وحسب المعلومات الأولية للبحث، فقد مكنت الأبحاث والتحريات التقنية التي باشرتها الفرقة الوطنية للشرطة القضائية من حجز 31 هاتفا محمولا  الأمن يوقف شبكة متخصصة في سرقة الهواتف في فرنسا وإعادة بيعها بالمغرب     .', 'size': 3}, {'id': '209', 'title': 'توقيف تجار هواتف بالرباط ومراكش متورطين في شراء وإخفاء 13 آيفون مسروق من فرنسا', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226756/', 'summary': 'توقيف تجار هواتف بالرباط ومراكش متورطين في شراء وإخفاء 13 آيفون مسروق من فرنسا. أحالت الفرقة الوطنية للشرطة القضائية على النيابة العامة المختصة بمدينة الدار البيضاء ستة أشخاص يشتبه في ارتباطهم بشبكة إجرامية متخصصة في السرقة وإخفاء عائدات إجرامية متحصلة من عملية سطو مسلح ارتكبت فوق الأراضي الفرنسية. وحسب المعلومات الأولية للبحث، فقد مكنت الأبحاث والتحريات التقنية التي باشرتها الفرقة الوطنية للشرطة القضائية من حجز 31 هاتفا محمولا متحصلا', 'size': 3}], 'main_title': 'حجز 31 هاتفا مسروقا من عملية سطو بفرنسا وتوقيف ستة أشخاص بالمغرب'}, {'community_id': '2', 'articles': [{'id': '153', 'title': 'الحكومة ترصد أكثر من نصف ميزانية الدولة للقطاعات الاجتماعية لمواجهة تنامي الفقر', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1097647.html', 'summary': 'الحكومة ترصد أكثر من نصف ميزانية الدولة للقطاعات الاجتماعية لمواجهة تنامي الفقر. الحكومة ترصد أكثر من نصف ميزانية الدولة للقطاعات الاجتماعية لمواجهة تنامي الفقر بالمغرب ظهرت المقالة الحكومة ترصد أكثر من نصف ميزانية الدولة للقطاعات الاجتماعية لمواجهة تنامي الفقر  .', 'size': 2}, {'id': '376', 'title': 'فيديو.. حياة تبدأ بالألم.. قصة الأطفال المتخلى عنهم بالمغرب – النقطة الأخيرة', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d9%81%d9%8a%d8%af%d9%8a%d9%88-%d8%ad%d9%8a%d8%a7%d8%a9-%d8%aa%d8%a8%d8%af%d8%a3-%d8%a8%d8%a7%d9%84%d8%a3%d9%84%d9%85-%d9%82%d8%b5%d8%a9-%d8%a7%d9%84%d8%a3%d8%b7%d9%81%d8%a7%d9%84-%d8%a7%d9%84/', 'summary': 'فيديو.. حياة تبدأ بالألم.. قصة الأطفال المتخلى عنهم بالمغرب – النقطة الأخيرة.  فيديو.. حياة تبدأ بالألم.. قصة الأطفال المتخلى عنهم بالمغرب – النقطة الأخيرة     .', 'size': 2}], 'main_title': 'الحكومة ترصد أكثر من نصف ميزانية الدولة للقطاعات الاجتماعية لمواجهة تنامي الفقر'}, {'community_id': '0', 'articles': [{'id': '173', 'title': 'إنفانتينو: تأهل المغرب لمونديال 2026 إنجاز إستثنائي ونتطلع لمسار رائع آخر لأسود الأطلس', 'source': 'rue20.com', 'link': 'https://rue20.com/934110.html', 'summary': 'إنفانتينو: تأهل المغرب لمونديال 2026 إنجاز إستثنائي ونتطلع لمسار رائع آخر لأسود الأطلس. . الرباط وصف رئيس الاتحاد الدولي لكرة القدم (فيفا)، جياني إنفانتينو، اليوم الجمعة، تأهل المنتخب المغربي إلى نهائيات كأس العالم 2026 بـ”الإنجاز الاستثنائي”. وقال إنفانتينو، في منشور له على حسابه بموقع التواصل الاجتماعي “إنستغرام”، “يا له من إنجاز استثنائي! ديما مغرب، تهانينا للمغرب الذي يستعد للمشاركة في كأس العالم للمرة السابعة في تاريخه”. وأضاف الخبر إنفانتينو: تأهل المغرب لمونديال 2026 إنجاز إستثنائي ونتطلع لمسار رائع آخر لأسود الأطلس  .', 'size': 2}, {'id': '210', 'title': 'إنفانتينو يصف تأهل المنتخب المغربي إلى نهائيات كأس العالم 2026 بـ”الإنجاز الاستثنائي”', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226754/', 'summary': 'إنفانتينو يصف تأهل المنتخب المغربي إلى نهائيات كأس العالم 2026 بـ”الإنجاز الاستثنائي”. وصف رئيس الاتحاد الدولي لكرة القدم (فيفا)، جياني إنفانتينو، اليوم الجمعة، تأهل المنتخب المغربي إلى نهائيات كأس العالم 2026 بـ”الإنجاز الاستثنائي”. وقال إنفانتينو، في منشور له على حسابه بموقع التواصل الاجتماعي “إنستغرام”، “يا له من إنجاز استثنائي! ديما مغرب، تهانينا للمغرب الذي يستعد للمشاركة في كأس العالم للمرة السابعة في تاريخه”. وأضاف رئيس الاتحاد الدولي', 'size': 2}], 'main_title': 'إنفانتينو: تأهل المغرب لمونديال 2026 إنجاز إستثنائي ونتطلع لمسار رائع آخر لأسود الأطلس'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    