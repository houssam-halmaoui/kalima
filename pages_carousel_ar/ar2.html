<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 12/08/2025 - 18h31</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '5', 'articles': [{'id': '122', 'title': 'يحيى عطية الله يوضح موقفه: لا عرض من الوداد ولا مفاوضات قائمة', 'source': 'kifache.com', 'link': 'https://kifache.com/%d9%8a%d8%ad%d9%8a%d9%89-%d8%b9%d8%b7%d9%8a%d8%a9-%d8%a7%d9%84%d9%84%d9%87-%d9%8a%d9%88%d8%b6%d8%ad-%d9%85%d9%88%d9%82%d9%81%d9%87-%d9%84%d8%a7-%d8%b9%d8%b1%d8%b6-%d9%85%d9%86-%d8%a7%d9%84%d9%88/', 'summary': 'يحيى عطية الله يوضح موقفه: لا عرض من الوداد ولا مفاوضات قائمة. خرج الدولي المغربي يحيى عطية الله، المحترف بصفوف نادي سوتشي الروسي، عن صمته ليرد على الأخبار التي راجت مؤخراً حول اقترابه من الوداد الرياضي. وأكد اللاعب أن ما يتم تداوله لا يعدو أن يكون إشاعات، نافياً توقيعه للنادي أو عقد أي لقاء مع رئيسه هشام آيت منا. وأشار عطية الله، في رسالة عبر “إنستغرام”، إلى', 'size': 2}, {'id': '388', 'title': 'يحيى عطية الله يكشف حقيقة انضمامه إلى الوداد', 'source': 'machahid24.com', 'link': 'https://machahid24.com/sport/472417.html', 'summary': 'يحيى عطية الله يكشف حقيقة انضمامه إلى الوداد. كشف الدولي المغربي يحيى عطية الله، المحترف بصفوف نادي سوتشي الروسي، حقيقة الأنباء الرائجة حول توصله لاتفاق مع نادي الوداد الرياضي لحمل قميصه خلال الموسم الكروي القادم. وأكد اللاعب، من خلال “ستوري” شاركه مع جمهوره عبر حسابه الخاص بموقع التواصل الاجتماعي “إنستغرام”، أن الأخبار التي تروج بخصوص هذا الموضوع لا أساس لها من الصحة ومجرد …', 'size': 2}], 'main_title': 'يحيى عطية الله يوضح موقفه: لا عرض من الوداد ولا مفاوضات قائمة'}, {'community_id': '1', 'articles': [{'id': '151', 'title': 'الزفزافي ورفاقه يضربون عن الطعام بسجن طنجة تضامنا مع ضحايا التجويع في غزة والسودان', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1092282.html', 'summary': 'الزفزافي ورفاقه يضربون عن الطعام بسجن طنجة تضامنا مع ضحايا التجويع في غزة والسودان. أعلن معتقلو حراك الريف الستة القابعون في سجن "طنجة 2"، ظهرت المقالة الزفزافي ورفاقه يضربون عن الطعام بسجن طنجة تضامنا مع ضحايا التجويع في غزة والسودان  .', 'size': 2}, {'id': '167', 'title': 'الزفزافي ورفاقه في إضراب عن الطعام والماء تضامنا مع غزة والسودان', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d8%b2%d9%81%d8%b2%d8%a7%d9%81%d9%8a-%d9%88%d8%b1%d9%81%d8%a7%d9%82%d9%87-%d9%81%d9%8a-%d8%a5%d8%b6%d8%b1%d8%a7%d8%a8-%d8%b9%d9%86-%d8%a7%d9%84%d8%b7%d8%b9%d8%a7%d9%85-%d9%88%d8%a7%d9%84/', 'summary': 'الزفزافي ورفاقه في إضراب عن الطعام والماء تضامنا مع غزة والسودان. أعلن ستة من معتقلي "احتجاجات الريف" بسجن طنجة 2 عن دخولهم في إضراب عن الطعام والماء لمدة 48 ساعة، وذلك تضامنا مع ضحايا سياسة التجويع في كل من غزة والسودان. وأوضح المعتقلون أن هذه الخطوة تأتي احتجاجا على ما وصفوه بتقاعس المنتظم الدولي في تحمل مسؤولياته تجاه ما يجري من جرائم الإبادة في المنطقتين. وجاء  الزفزافي ورفاقه في إضراب عن الطعام والماء تضامنا مع غزة والسودان     .', 'size': 2}], 'main_title': 'الزفزافي ورفاقه يضربون عن الطعام بسجن طنجة تضامنا مع ضحايا التجويع في غزة والسودان'}, {'community_id': '4', 'articles': [{'id': '216', 'title': 'بلاغ لوزارة التجهيز والماء', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d8%a8%d9%84%d8%a7%d8%ba-%d9%84%d9%88%d8%b2%d8%a7%d8%b1%d8%a9-%d8%a7%d9%84%d8%aa%d8%ac%d9%87%d9%8a%d8%b2-%d9%88%d8%a7%d9%84%d9%85%d8%a7%d8%a1-2/', 'summary': 'بلاغ لوزارة التجهيز والماء. أعلنت وزارة التجهيز والماء، اليوم الإثنين، أن حركة السير على الطريق الوطنية رقم 27 الرابطة بين سيدي قاسم ومكناس ستعرف انقطاعا مؤقتا، على مستوى  بلاغ لوزارة التجهيز والماء     .', 'size': 2}, {'id': '227', 'title': 'انقطاع حركة السير لمدة أسبوع على الطريق الوطنية بين سيدي قاسم ومكناس', 'source': 'almassaa.com', 'link': 'https://almassaa.com/%d8%a7%d9%86%d9%82%d8%b7%d8%a7%d8%b9-%d8%ad%d8%b1%d9%83%d8%a9-%d8%a7%d9%84%d8%b3%d9%8a%d8%b1-%d9%84%d9%85%d8%af%d8%a9-%d8%a3%d8%b3%d8%a8%d9%88%d8%b9-%d8%b9%d9%84%d9%89-%d8%a7%d9%84%d8%b7%d8%b1%d9%8a/', 'summary': 'انقطاع حركة السير لمدة أسبوع على الطريق الوطنية بين سيدي قاسم ومكناس. المساء اليوم: أعلنت وزارة التجهيز والماء، أن حركة السير على الطريق الوطنية رقم 27 الرابطة بين سيدي قاسم ومكناس ستعرف انقطاعا مؤقتا، على مستوى المقطع الرابط بين سيدي قاسم و باب تيسرا. ووفق بيان للوزارة', 'size': 2}], 'main_title': 'بلاغ لوزارة التجهيز والماء'}, {'community_id': '2', 'articles': [{'id': '243', 'title': 'طقس حار في العديد من مناطق المملكة اليوم الثلاثاء', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%b7%d9%82%d8%b3-%d8%ad%d8%a7%d8%b1-%d9%81%d9%8a-%d8%a7%d9%84%d8%b9%d8%af%d9%8a%d8%af-%d9%85%d9%86-%d9%85%d9%86%d8%a7%d8%b7%d9%82-%d8%a7%d9%84%d9%85%d9%85%d9%84%d9%83%d8%a9-%d8%a7%d9%84%d9%8a-94/', 'summary': 'طقس حار في العديد من مناطق المملكة اليوم الثلاثاء. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليومه الثلاثاء، أن يصبح الطقس حارا إلى جد حار مع وجود “الشركي” بكل من السهول الشمالية والوسطى، وهضاب الفوسفاط ووالماس، ومنطقة سوس، والجنوب الشرقي وداخل الأقاليم الجنوبية للمملكة. كما يرتقب تشكل سحب منخفضة، خلال الصباح والليل، حيث ستكون مرفوقة بكتل ضبابية أو قطرات مطرية جد خفيفة محليا …  طقس حار في العديد من مناطق المملكة اليوم الثلاثاء     .', 'size': 2}, {'id': '372', 'title': 'طقس اليوم: أجواء حارة مع “الشركي” بهذه المناطق', 'source': 'soltana.ma', 'link': 'https://soltana.ma/1357627.html', 'summary': 'طقس اليوم: أجواء حارة مع “الشركي” بهذه المناطق. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الثلاثاء، أن يصبح الطقس حارا إلى جد حار مع وجود «الشركي» بكل من السهول الشمالية والوسطى، وهضاب الفوسفاط ووالماس، ومنطقة سوس، والجنوب الشرقي وداخل الأقاليم الجنوبية للمملكة. كما يرتقب تشكل سحب منخفضة، خلال الصباح والليل، حيث ستكون مرفوقة بكتل ضبابية أو قطرات مطرية جد خفيفة محليا بالقرب من', 'size': 2}], 'main_title': 'طقس حار في العديد من مناطق المملكة اليوم الثلاثاء'}, {'community_id': '6', 'articles': [{'id': '271', 'title': 'صنصال يدعو من داخل السجن إلى النضال ضد ديكتاتورية النظام الجزائري', 'source': 'www.hespress.com', 'link': 'https://www.hespress.com/%d8%b5%d9%86%d8%b5%d8%a7%d9%84-%d9%8a%d8%af%d8%b9%d9%88-%d9%85%d9%86-%d8%af%d8%a7%d8%ae%d9%84-%d8%a7%d9%84%d8%b3%d8%ac%d9%86-%d8%a5%d9%84%d9%89-%d8%a7%d9%84%d9%86%d8%b6%d8%a7%d9%84-%d8%b6%d8%af-%d8%af-1608023.html', 'summary': 'صنصال يدعو من داخل السجن إلى النضال ضد ديكتاتورية النظام الجزائري. من داخل معتقله بسجن الحراش بالجزائر، وجّه الكاتب الجزائري-الفرنسي بوعلام صنصال رسالة مؤثرة إلى الشعب الجزائري، دعا فيها إلى مواصلة الصمود في وجه ديكتاتورية النظام الحاكم في الجزائر، مشددا على أن جريمته الوحيدة هي إيمانه بأن الكلمات قادرة على إنقاذ الوطن من الفساد والعنف. وأكد صنصال أنه لا يطلب حريته كمنّة، بل باسم العدالة، محذرا  صنصال يدعو من داخل السجن إلى النضال ضد ديكتاتورية النظام الجزائري     - هسبريس جريدة إلكترونية مغربية .', 'size': 2}, {'id': '413', 'title': 'بوعلام صنصال يوجه رسالة قوية من داخل السجن ويؤكد استمراره في رفض استبداد نظام العسكر الجزائري', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a8%d9%88%d8%b9%d9%84%d8%a7%d9%85-%d8%b5%d9%86%d8%b5%d8%a7%d9%84-%d9%8a%d9%88%d8%ac%d9%87-%d8%b1%d8%b3%d8%a7%d9%84%d8%a9-%d9%82%d9%88%d9%8a%d8%a9-%d9%85%d9%86-%d8%af%d8%a7%d8%ae%d9%84-%d8%a7%d9%84/', 'summary': 'بوعلام صنصال يوجه رسالة قوية من داخل السجن ويؤكد استمراره في رفض استبداد نظام العسكر الجزائري. وجّه الكاتب الجزائري بوعلام صنصال، اليوم الثلاثاء، رسالة قوية من سجنه في بالجزائر، حملت عنوان “لا تحولوا أنظاركم”، كشف فيها عن معاناته داخل الزنزانة وظروف اعتقاله التي وصفها بالقاسية، معتبرا أن السجن في الجزائر “لم يعد مكانا استثنائيا للمجرمين، بل أداة عادية من أدوات الحكم”. وصنصال، الذي لطالما عُرف بمواقفه النقدية تجاه النظام …  بوعلام صنصال يوجه رسالة قوية من داخل السجن ويؤكد استمراره في رفض استبداد نظام العسكر الجزائري     .', 'size': 2}], 'main_title': 'صنصال يدعو من داخل السجن إلى النضال ضد ديكتاتورية النظام الجزائري'}, {'community_id': '3', 'articles': [{'id': '326', 'title': 'وكالة الأدوية توضح حقيقة نقص أكثر من 600 دواء مخصص لعلاج الأمراض المزمنة', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/national/410942.html', 'summary': 'وكالة الأدوية توضح حقيقة نقص أكثر من 600 دواء مخصص لعلاج الأمراض المزمنة. نفت الوكالة المغربية للأدوية والمنتجات الصحية صحة ما نشرته بعض المنابر الإعلامية بخصوص ادعاء وجود ندرة تمس أزيد من 600 دواء موجها لعلاج أمراض مزمنة. وأوضحت', 'size': 2}, {'id': '386', 'title': 'هيئة تكشف مستجدات المنتجات الصحية وتغطية السوق الدوائي الوطني', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/472422.html', 'summary': 'هيئة تكشف مستجدات المنتجات الصحية وتغطية السوق الدوائي الوطني. ردت الوكالة المغربية للأدوية والمنتجات الصحية، عن ندرة أزيد من 600 دواء موجه لعلاج أمراض مزمنة. وأوضحت الوكالة المغربية للأدوية أنه بخصوص إدعاء وجود ندرة تمس أكثر من 600 دواء مستعمل في علاج أمراض مزمنة، فإنها باعتبارها السلطة الوطنية المختصة بتنظيم ومراقبة القطاع الدوائي، تعرب عن استغرابها من الأرقام المتداولة، والتي لو كانت صحيحة لكان …', 'size': 2}, {'id': '425', 'title': 'الوكالة المغربية للأدوية تخرج عن صمتها حول ندرة أزيد من 600 دواء موجه لعلاج أمراض مزمنة', 'source': 'www.alalam.ma', 'link': 'https://www.alalam.ma/الوكالة-المغربية-للأدوية-تخرج-عن-صمتها-حول-ندرة-أزيد-من-600-دواء_a29136.html', 'summary': 'الوكالة المغربية للأدوية تخرج عن صمتها حول ندرة أزيد من 600 دواء موجه لعلاج أمراض مزمنة. *العلم الإلكترونية* على إثر ما نشرته بعض المنابر الإعلامية بخصوص ادعاء وجود ندرة تمس أكثر من 60...', 'size': 3}], 'main_title': 'الوكالة المغربية للأدوية تخرج عن صمتها حول ندرة أزيد من 600 دواء موجه لعلاج أمراض مزمنة'}, {'community_id': '0', 'articles': [{'id': '363', 'title': 'تحذير من موجة حر بدءا من الأربعاء إلى السبت', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%aa%d8%ad%d8%b0%d9%8a%d8%b1-%d9%85%d9%86-%d9%85%d9%88%d8%ac%d8%a9-%d8%ad%d8%b1-%d8%a8%d8%af%d8%a1%d8%a7-%d9%85%d9%86-%d8%a7%d9%84%d8%a3%d8%b1%d8%a8%d8%b9%d8%a7%d8%a1-%d8%a5%d9%84%d9%89-%d8%a7%d9%84/', 'summary': 'تحذير من موجة حر بدءا من الأربعاء إلى السبت. تتوقع المديرية العامة للأرصاد الجوية تسجيل موجة حر مع الشركي، من يوم غد الأربعاء إلى يوم السبت المقبل، بدرجات حرارة تتراوح ما بين 38 و 47 درجة مئوية بعدد من مناطق المملكة. وأوضحت المديرية، في نشرة إنذارية من مستوى يقظة برتقالي، أنه يرتقب تسجيل درجات حرارة تتراوح ما بين 44 و47 درجة، من غد الأربعاء  تحذير من موجة حر بدءا من الأربعاء إلى السبت     .', 'size': 2}, {'id': '373', 'title': 'نشرة إنذارية/ موجة حر شديد من الأربعاء إلى السبت بعدد من مناطق المملكة', 'source': 'rue20.com', 'link': 'https://rue20.com/928160.html', 'summary': 'نشرة إنذارية/ موجة حر شديد من الأربعاء إلى السبت بعدد من مناطق المملكة.  | الرباط تتوقع المديرية العامة للأرصاد الجوية تسجيل موجة حر مع الشركي، من يوم غد الأربعاء إلى يوم السبت المقبل، بدرجات حرارة تتراوح ما بين 38 و 47 درجة مئوية بعدد من مناطق المملكة. وأوضحت المديرية، في نشرة إنذارية من مستوى يقظة برتقالي، أنه يرتقب تسجيل درجات حرارة تتراوح ما بين 44 و47 الخبر نشرة إنذارية/ موجة حر شديد من الأربعاء إلى السبت بعدد من مناطق المملكة  .', 'size': 2}], 'main_title': 'تحذير من موجة حر بدءا من الأربعاء إلى السبت'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    