<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 18/08/2025 - 18h29</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '2', 'title': 'مقتل عنصري إطفاء بإسبانيا والبرتغال', 'source': 'www.hespress.com', 'link': 'https://www.hespress.com/%d9%85%d9%82%d8%aa%d9%84-%d8%b9%d9%86%d8%b5%d8%b1%d9%8a-%d8%a5%d8%b7%d9%81%d8%a7%d8%a1-%d8%a8%d8%a5%d8%b3%d8%a8%d8%a7%d9%86%d9%8a%d8%a7-%d9%88%d8%a7%d9%84%d8%a8%d8%b1%d8%aa%d8%ba%d8%a7%d9%84-1610707.html', 'summary': 'مقتل عنصري إطفاء بإسبانيا والبرتغال. لقي عنصرا إطفاء حتفهما في إسبانيا والبرتغال، بحسب ما أعلنته سلطات البلدين الإثنين، في وقت تجتاح حرائق الغابات شبه الجزيرة الإيبيرية في ظل موجة حر خانقة. وتوفي العنصران لدى تعرضهما لحادثي سير “أثناء أدائهما الخدمة”، ما يرفع حصيلة القتلى إلى اثنين في البرتغال وأربعة في إسبانيا منذ اندلعت الحرائق في الأسابيع الأخيرة. وتشهد إسبانيا أسبوعا  مقتل عنصري إطفاء بإسبانيا والبرتغال     - هسبريس جريدة إلكترونية مغربية .', 'size': 2}, {'id': '409', 'title': 'مقتل عنصري إطفاء أثناء مكافحة الحرائق في إسبانيا والبرتغال', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d9%85%d9%82%d8%aa%d9%84-%d8%b9%d9%86%d8%b5%d8%b1%d9%8a-%d8%a5%d8%b7%d9%81%d8%a7%d8%a1-%d8%a3%d8%ab%d9%86%d8%a7%d8%a1-%d9%85%d9%83%d8%a7%d9%81%d8%ad%d8%a9-%d8%a7%d9%84%d8%ad%d8%b1%d8%a7%d8%a6%d9%82/', 'summary': 'مقتل عنصري إطفاء أثناء مكافحة الحرائق في إسبانيا والبرتغال. لقي عنصرا إطفاء حتفهما في إسبانيا والبرتغال، بحسب ما أعلنت سلطات البلدين يومه الاثنين، في وقت تجتاح حرائق الغابات شبه الجزيرة الإيبيرية في ظل موجة حر خانقة. وحسب ما نشره موقع “فرانس 24” فقد ووفي العنصران لدى تعرضهما لحادثي سير “أثناء أدائهما الخدمة”، ما يرفع حصيلة القتلى إلى اثنين في البرتغال وأربعة في …  مقتل عنصري إطفاء أثناء مكافحة الحرائق في إسبانيا والبرتغال     .', 'size': 2}], 'main_title': 'مقتل عنصري إطفاء بإسبانيا والبرتغال'}, {'community_id': '1', 'articles': [{'id': '120', 'title': 'إقليم الجديدة في صدمة.. ذئاب بشرية تغتصب طفلا قاصرا بشكل جماعي في موسم مولاي عبد الله أمغار', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411234.html', 'summary': 'إقليم الجديدة في صدمة.. ذئاب بشرية تغتصب طفلا قاصرا بشكل جماعي في موسم مولاي عبد الله أمغار. شهد إقليم الجديدة جريمة مروعة عقب اختتام موسم مولاي عبد الله أمغار، بعدما تعرض طفل يبلغ من العمر 13 سنة لاغتصاب جماعي نفذه أكثر من', 'size': 2}, {'id': '351', 'title': 'اغتصاب جماعي لطفل يثير صدمة ومطالب بتحقيق عاجل', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321276/', 'summary': 'اغتصاب جماعي لطفل يثير صدمة ومطالب بتحقيق عاجل. عاشت ساكنة إقليم الجديدة صدمة قوية عقب اختتام فعاليات موسم مولاي عبد الله أمغار، بعد انتشار خبر تعرض طفل يبلغ من العمر 13 سنة لاغتصاب جماعي وصف بـ”المروع”. وحسب إفادات عائلية، فإن الطفل، الذي فقد والده ولا تعيله سوى والدته من ذوي الاحتياجات الخاصة، صرح بتعرضه لاعتداء نفذته مجموعة تضم أكثر من عشرة أشخاص.', 'size': 2}, {'id': '365', 'title': 'جريمة تهز موسم مولاي عبد الله أمغار .. 14 شخصا يتناوبون على اغتصاب طفل يتيم (صورة)', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1093496.html', 'summary': 'جريمة تهز موسم مولاي عبد الله أمغار .. 14 شخصا يتناوبون على اغتصاب طفل يتيم (صورة). اهتزت مدينة الجديدة أول أمس السبت 16 غشت 2025 على ظهرت المقالة جريمة تهز موسم مولاي عبد الله أمغار .. 14 شخصا يتناوبون على اغتصاب طفل يتيم (صورة)  .', 'size': 3}], 'main_title': 'جريمة تهز موسم مولاي عبد الله أمغار .. 14 شخصا يتناوبون على اغتصاب طفل يتيم (صورة)'}, {'community_id': '2', 'articles': [{'id': '140', 'title': 'تنفيذا لتوجيهات خطاب العرش.. لفتيت يستنفر الولاة والعمال لإعداد جيل جديد من برامج التنمية الترابية', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%aa%d9%86%d9%81%d9%8a%d8%b0%d8%a7-%d9%84%d8%aa%d9%88%d8%ac%d9%8a%d9%87%d8%a7%d8%aa-%d8%ae%d8%b7%d8%a7%d8%a8-%d8%a7%d9%84%d8%b9%d8%b1%d8%b4-%d9%84%d9%81%d8%aa%d9%8a%d8%aa-%d9%8a%d8%b3%d8%aa%d9%86/', 'summary': 'تنفيذا لتوجيهات خطاب العرش.. لفتيت يستنفر الولاة والعمال لإعداد جيل جديد من برامج التنمية الترابية. دعا وزير الداخلية عبد الوافي لفتيت الولاة والعمال لإعداد جيل جديد من برامج التنمية المجالية المندمجة في أقرب الآجال. وفي مراسلة اطلع موقع “كيفاش” على نسخة منها، أبرز لفتيت، أن “هذا الجيل الجديد من برامج التنمية الترابية المندمجة، يجب أن يقوم على تثمين الخصوصيات المحلية، وترسيخ الجهوية المتقدمة، واعتماد مبادئ التكامل والتضامن بين الكيانات الترابية،', 'size': 3}, {'id': '159', 'title': 'لفتيت يحذر من تسييس برامج التنمية الترابية الجديدة', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321261/', 'summary': 'لفتيت يحذر من تسييس برامج التنمية الترابية الجديدة. نبه وزير الداخلية، عبد الوافي لفتيت، الولاة والعمال إلى ضرورة تجنب أي استغلال سياسي أو انتخابي خلال مرحلة الإعداد لجيل جديد من برامج التنمية الترابية المندمجة. وأكد لفتيت أن هذا الورش الملكي يستوجب تعبئة شاملة ومقاربة تشاركية قائمة على التكامل والتضامن. وجاء تحذير لفتيت من خلال دورية وزارية عممها على ممثلي السلطة الترابية، عقب', 'size': 3}, {'id': '193', 'title': 'لفتيت يحذر من توظيف برامج التنمية الترابية المندمجة لأغراض سياسية ضيقة', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d9%84%d9%81%d8%aa%d9%8a%d8%aa-%d9%8a%d8%ad%d8%b0%d8%b1-%d9%85%d9%86-%d8%aa%d9%88%d8%b8%d9%8a%d9%81-%d8%a8%d8%b1%d8%a7%d9%85%d8%ac-%d8%a7%d9%84%d8%aa%d9%86%d9%85%d9%8a%d8%a9-%d8%a7%d9%84%d8%aa%d8%b1/', 'summary': 'لفتيت يحذر من توظيف برامج التنمية الترابية المندمجة لأغراض سياسية ضيقة. حذر عبد الوافي لفتيت، وزير الداخلية، من أي استغلال محتمل خلال إعداد جيل جديد من برامج التنمية الترابية المندمجة لأغراض سياسية أو انتخابية ضيقة، وذلك تعبئة وانخراط لمجموع الفاعلين الترابيين المعنيين في إطار المقاربة التشاركية والمندمجة. ووجه لفتيت دورية إلى الولاة وعمال العمالات وعمالات المقاطعات، دعاهم فيها إلى الشروع في إعداد جيل جديد من برامج  لفتيت يحذر من توظيف برامج التنمية الترابية المندمجة لأغراض سياسية ضيقة     .', 'size': 3}], 'main_title': 'تنفيذا لتوجيهات خطاب العرش.. لفتيت يستنفر الولاة والعمال لإعداد جيل جديد من برامج التنمية الترابية'}, {'community_id': '3', 'articles': [{'id': '156', 'title': '20 في المائة من الأراضي الرطبة في العالم قد تختفي بحلول 2025', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321267/', 'summary': '20 في المائة من الأراضي الرطبة في العالم قد تختفي بحلول 2025. ذكر علماء من جامعة “تومسك” الروسية أنه بحلول سنة 2050 قد تختفي نحو 20 في المائة من الأراضي الرطبة في العالم، وهي من بين أكثر النظم البيئية قيمة، رغم كونها أكثر هشاشة على كوكب الأرض، مشيرين إلى أنهم بدأوا بدراستها لإيجاد سبل للحفاظ عليها واستعادتها. وأظهر أحدث تقرير صادر عن اتفاقية الأراضي الرطبة أن العالم', 'size': 2}, {'id': '411', 'title': 'تقرير: خطر اختفاء 20% من الأراضي الرطبة بحلول 2050', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d9%82%d8%b1%d9%8a%d8%b1-%d8%ae%d8%b7%d8%b1-%d8%a7%d8%ae%d8%aa%d9%81%d8%a7%d8%a1-20-%d9%85%d9%86-%d8%a7%d9%84%d8%a3%d8%b1%d8%a7%d8%b6%d9%8a-%d8%a7%d9%84%d8%b1%d8%b7%d8%a8%d8%a9-%d8%a8%d8%ad/', 'summary': 'تقرير: خطر اختفاء 20% من الأراضي الرطبة بحلول 2050. حذّر علماء من جامعة “تومسك” الروسية من أن نحو خمس الأراضي الرطبة في العالم قد يختفي مع حلول سنة 2050، رغم أهميتها البيئية والاقتصادية البالغة، باعتبارها من أكثر النظم الطبيعية هشاشة على الكوكب. ووفق أحدث تقرير لاتفاقية الأراضي الرطبة، فقد العالم منذ عام 1970 حوالي 22% من هذه المساحات، أي ما يعادل 411 …  تقرير: خطر اختفاء 20% من الأراضي الرطبة بحلول 2050     .', 'size': 2}], 'main_title': '20 في المائة من الأراضي الرطبة في العالم قد تختفي بحلول 2025'}, {'community_id': '4', 'articles': [{'id': '189', 'title': 'توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d9%87%d8%a8%d9%88%d8%a8-%d8%b4%d8%b1%d9%83%d9%8a-%d9%85%d8%ad%d9%84%d9%8a-%d8%a8%d8%a7%d9%84%d8%b3/', 'summary': 'توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الاثنين، أن تتميز الحالة الجوية عامة، بطقس حار إلى جد حار محليا مع هبوب شركي محلي بالسهول الداخلية الشمالية والوسطى، والساحل المتوسطي، وشمال المنطقة الشرقية والجنوب الشرقي، وداخل كل من منطقة سوس والأقاليم الصحراوية. كما يرتقب تشكل سحب منخفضة مرفوقة بكتل من الضباب المحلي بالواجهة المتوسطية وسواحل المحيط  توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية     .', 'size': 3}, {'id': '195', 'title': 'طقس الاثنين: أجواء جد حارة بعدد من المناطق', 'source': 'soltana.ma', 'link': 'https://soltana.ma/1357656.html', 'summary': 'طقس الاثنين: أجواء جد حارة بعدد من المناطق. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الاثنين، أن تتميز الحالة الجوية عامة بطقس حار إلى جد حار محليا مع هبوب شركي محلي بالسهول الداخلية الشمالية والوسطى، والساحل المتوسطي، وشمال المنطقة الشرقية والجنوب الشرقي، وداخل كل من منطقة سوس و الأقاليم الصحراوية. كما يرتقب تشكل سحب منخفضة مرفوقة بكتل من الضباب المحلي بالواجهة المتوسطية وسواحل', 'size': 3}, {'id': '262', 'title': 'توقعات أحوال الطقس اليوم الإثنين', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d8%a7%d9%84%d9%8a%d9%88%d9%85-%d8%a7%d9%84%d8%a5%d8%ab%d9%86%d9%8a%d9%86-8/', 'summary': 'توقعات أحوال الطقس اليوم الإثنين. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الإثنين، أن تتميز الحالة الجوية عامة، بطقس حار إلى جد حار محليا مع هبوب شركي محلي بالسهول الداخلية الشمالية و الوسطى، والساحل المتوسطي، وشمال المنطقة الشرقية والجنوب الشرقي، وداخل كل من منطقة سوس و الأقاليم الصحراوية. كما يرتقب تشكل سحب منخفضة مرفوقة بكتل من الضباب المحلي …  توقعات أحوال الطقس اليوم الإثنين     .', 'size': 3}], 'main_title': 'توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية'}, {'community_id': '5', 'articles': [{'id': '368', 'title': '“الشركي” يضرب المغرب وموجة حر قياسية تصل إلى 47 درجة', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1093534.html', 'summary': '“الشركي” يضرب المغرب وموجة حر قياسية تصل إلى 47 درجة. أفادت المديرية العامة للأرصاد الجوية بأنه يرتقب تسجيل موجة حر مع “الشركي” وزخات رعدية مصحوبة بتساقط للبرد وبهبات رياح من اليوم الاثنين إلى بعد غد الأربعاء، بعدد من مناطق المملكة. وأوضحت المديرية، في نشرة إنذارية من مستوى يقظة برتقالي، أنه من المرتقب تسجيل زخات رعدية مصحوبة بتساقط البرد وبهبات رياح اليوم الاثنين من الثالثة بعد ظهرت المقالة “الشركي” يضرب المغرب وموجة حر قياسية تصل إلى 47 درجة  .', 'size': 2}, {'id': '389', 'title': 'نشرة إنذارية.. موجة حر مع “الشركي” وزخات رعدية مصحوبة بالبرد مرتقبة بعدد من مناطق المملكة', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/473043.html', 'summary': 'نشرة إنذارية.. موجة حر مع “الشركي” وزخات رعدية مصحوبة بالبرد مرتقبة بعدد من مناطق المملكة. أفادت المديرية العامة للأرصاد الجوية بأنه يرتقب تسجيل موجة حر مع “الشركي” وزخات رعدية مصحوبة بتساقط للبرد وبهبات رياح من اليوم الاثنين إلى بعد غد الأربعاء، بعدد من مناطق المملكة. وأوضحت المديرية، في نشرة إنذارية من مستوى يقظة برتقالي، أنه من المرتقب تسجيل زخات رعدية مصحوبة بتساقط البرد وبهبات رياح اليوم الاثنين من الثالثة بعد …', 'size': 3}, {'id': '400', 'title': 'موجة حر مع “الشركي” وزخات رعدية مصحوبة بالبرد وبهبات رياح مرتقبة من الاثنين إلى الأربعاء', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d9%85%d9%88%d8%ac%d8%a9-%d8%ad%d8%b1-%d9%85%d8%b9-%d8%a7%d9%84%d8%b4%d8%b1%d9%83%d9%8a-%d9%88%d8%b2%d8%ae%d8%a7%d8%aa-%d8%b1%d8%b9%d8%af%d9%8a%d8%a9-%d9%85%d8%b5%d8%ad%d9%88%d8%a8%d8%a9-%d8%a8/', 'summary': 'موجة حر مع “الشركي” وزخات رعدية مصحوبة بالبرد وبهبات رياح مرتقبة من الاثنين إلى الأربعاء. أفادت المديرية العامة للأرصاد الجوية بأنه يرتقب تسجيل موجة حر مع “الشركي” وزخات رعدية مصحوبة بتساقط للبرد وبهبات رياح من اليوم الاثنين إلى بعد غد  موجة حر مع “الشركي” وزخات رعدية مصحوبة بالبرد وبهبات رياح مرتقبة من الاثنين إلى الأربعاء     .', 'size': 2}, {'id': '408', 'title': 'تمديد قابل للتجديد: الحر والشركي إلى غاية الأربعاء', 'source': 'almassaa.com', 'link': 'https://almassaa.com/%d8%aa%d9%85%d8%af%d9%8a%d8%af-%d9%82%d8%a7%d8%a8%d9%84-%d9%84%d9%84%d8%aa%d8%ac%d8%af%d9%8a%d8%af-%d8%a7%d9%84%d8%ad%d8%b1-%d9%88%d8%a7%d9%84%d8%b4%d8%b1%d9%83%d9%8a-%d8%a5%d9%84%d9%89-%d8%ba%d8%a7/', 'summary': 'تمديد قابل للتجديد: الحر والشركي إلى غاية الأربعاء. المساء اليوم: أفادت المديرية العامة للأرصاد الجوية بأنه يرتقب تسجيل موجة حر مع “الشركي” وزخات رعدية مصحوبة بتساقط للبرد وبهبات رياح من اليوم الاثنين إلى بعد غد الأربعاء، بعدد من مناطق المملكة. وأوضحت المديرية، في', 'size': 3}, {'id': '414', 'title': 'نشرة إنذارية: موجة حر مع الشركي وزخات رعدية مصحوبة بالبرد وبهبات رياح مرتقبة بعدد من مناطق المملكة', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d9%86%d8%b4%d8%b1%d8%a9-%d8%a5%d9%86%d8%b0%d8%a7%d8%b1%d9%8a%d8%a9-%d9%85%d9%88%d8%ac%d8%a9-%d8%ad%d8%b1-%d9%85%d8%b9-%d8%a7%d9%84%d8%b4%d8%b1%d9%83%d9%8a-%d9%88%d8%b2%d8%ae%d8%a7%d8%aa-%d8%b1%d8%b9/', 'summary': 'نشرة إنذارية: موجة حر مع الشركي وزخات رعدية مصحوبة بالبرد وبهبات رياح مرتقبة بعدد من مناطق المملكة. أفادت المديرية العامة للأرصاد الجوية بأنه يرتقب تسجيل موجة حر مع “الشركي” وزخات رعدية مصحوبة بتساقط للبرد وبهبات رياح من اليوم الاثنين إلى بعد غد الأربعاء، بعدد من مناطق المملكة. وأوضحت المديرية، في نشرة إنذارية من مستوى يقظة برتقالي، أنه من المرتقب تسجيل زخات رعدية مصحوبة بتساقط البرد وبهبات رياح اليوم الاثنين من …  نشرة إنذارية: موجة حر مع الشركي وزخات رعدية مصحوبة بالبرد وبهبات رياح مرتقبة بعدد من مناطق المملكة     .', 'size': 5}], 'main_title': 'نشرة إنذارية: موجة حر مع الشركي وزخات رعدية مصحوبة بالبرد وبهبات رياح مرتقبة بعدد من مناطق المملكة'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    