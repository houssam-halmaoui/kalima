<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 15/08/2025 - 06h25</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '1', 'articles': [{'id': '66', 'title': 'ولاية أمن أكادير توضح حقيقة فيديو التراشق بالحجارة بتارودانت', 'source': 'www.alahdat.net', 'link': 'https://www.alahdat.net/archives/204994', 'summary': 'ولاية أمن أكادير توضح حقيقة فيديو التراشق بالحجارة بتارودانت.  تفاعلت ولاية أمن أكادير،بسرعة وجدية كبيرة، مع مقطع فيديو متداول على صفحات مواقع التواصل الاجتماعي، اليوم الأربعاء 13 غشت الجاري، يظهر فيه مجموعة من الأشخاص و هم يتراشقون بالحجارة، وهو التسجيل الذي جاء مقرونا بتعليقات تدعي أن الأمر يتعلق باعتداء نفذته عصابة إجرامية بمدينة تارودانت. وقد أظهرت الأبحاث المنجزة أن هذه الواقعة', 'size': 2}, {'id': '79', 'title': 'تارودانت.. خلاف شخصي يتحول إلى مواجهة بالحجارة والأمن يوضح', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411014.html', 'summary': 'تارودانت.. خلاف شخصي يتحول إلى مواجهة بالحجارة والأمن يوضح. تفاعلت ولاية أمن أكادير، بسرعة وجدية كبيرة، مع مقطع فيديو متداول على صفحات مواقع التواصل الاجتماعي، اليوم الأربعاء 13 غشت الجاري، يظهر فيه مجموعة من', 'size': 2}], 'main_title': 'ولاية أمن أكادير توضح حقيقة فيديو التراشق بالحجارة بتارودانت'}, {'community_id': '2', 'articles': [{'id': '90', 'title': 'صيادلة المغرب يعلنون التعبئة الشاملة لمواجهة مرسوم تخفيض أسعار الأدوية ويصفونه ب"الكارثي"', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/economy/411025.html', 'summary': 'صيادلة المغرب يعلنون التعبئة الشاملة لمواجهة مرسوم تخفيض أسعار الأدوية ويصفونه ب"الكارثي". دخلت الكونفدرالية الوطنية لنقابات صيادلة المغرب، في حالة استنفار قصوى، داعية إلى عقد مجلس وطني استثنائي اليوم الخميس، سيخصص بالكامل لمواجهة مشروع مرسوم حكومي جديد', 'size': 2}, {'id': '190', 'title': 'مشروع حكومي جديد لتسعير الأدوية يستنفر الصيادلة', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d9%85%d8%b4%d8%b1%d9%88%d8%b9-%d8%ad%d9%83%d9%88%d9%85%d9%8a-%d8%ac%d8%af%d9%8a%d8%af-%d9%84%d8%aa%d8%b3%d8%b9%d9%8a%d8%b1-%d8%a7%d9%84%d8%a3%d8%af%d9%88%d9%8a%d8%a9-%d9%8a%d8%b3%d8%aa%d9%86%d9%81/', 'summary': 'مشروع حكومي جديد لتسعير الأدوية يستنفر الصيادلة. -متابعات دخلت الكونفدرالية الوطنية لنقابات صيادلة المغرب في حالة تعبئة قصوى، بعد إعلان الحكومة عن مشروع مرسوم جديد يهدف إلى مراجعة أسعار الأدوية. وقررت الهيئة عقد مجلس وطني استثنائي،...  مشروع حكومي جديد لتسعير الأدوية يستنفر الصيادلة     .', 'size': 2}], 'main_title': 'صيادلة المغرب يعلنون التعبئة الشاملة لمواجهة مرسوم تخفيض أسعار الأدوية ويصفونه ب"الكارثي"'}, {'community_id': '3', 'articles': [{'id': '112', 'title': 'اعتراض سفينة محملة بثلاثة أطنان من الكوكايين غرب جزر الكناري بتعاون مع المغرب', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411047.html', 'summary': 'اعتراض سفينة محملة بثلاثة أطنان من الكوكايين غرب جزر الكناري بتعاون مع المغرب. أعلن جهاز المراقبة الجمركية التابع لوكالة الضرائب والحرس المدني الإسباني، أنه تم، أمس الأربعاء، وبالتعاون مع المغرب، اعتراض سفينة من نوع قاطرة تحمل اسم “سكاي', 'size': 2}, {'id': '164', 'title': 'اعتراض سفينة محملة بثلاثة أطنان من الكوكايين في بحر جزر الكناري بتعاون مع المغرب', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d8%b9%d8%aa%d8%b1%d8%a7%d8%b6-%d8%b3%d9%81%d9%8a%d9%86%d8%a9-%d9%85%d8%ad%d9%85%d9%84%d8%a9-%d8%a8%d8%ab%d9%84%d8%a7%d8%ab%d8%a9-%d8%a3%d8%b7%d9%86%d8%a7%d9%86-%d9%85%d9%86-%d8%a7%d9%84%d9%83/', 'summary': 'اعتراض سفينة محملة بثلاثة أطنان من الكوكايين في بحر جزر الكناري بتعاون مع المغرب. أعلن جهاز المراقبة الجمركية التابع لوكالة الضرائب والحرس المدني الإسباني، أنه تم، أمس الأربعاء، وبالتعاون مع المغرب، اعتراض سفينة من نوع قاطرة تحمل اسم “سكاي وايت”، كانت تنقل على متنها حوالي ثلاثة آلاف كيلوغرام من الكوكايين، موزعة على 80 رزمة بأحجام مختلفة. وأوضح بلاغ لمديرية المراقبة الجمركية أن هذه العملية جرت في إطار تعاون دولي  اعتراض سفينة محملة بثلاثة أطنان من الكوكايين في بحر جزر الكناري بتعاون مع المغرب     .', 'size': 3}, {'id': '379', 'title': 'الأمن المغربي يشارك بشكل حاسم في اعتراض باخرة دولية تنقل شحنة كوكايين قياسية', 'source': 'rue20.com', 'link': 'https://rue20.com/928673.html', 'summary': 'الأمن المغربي يشارك بشكل حاسم في اعتراض باخرة دولية تنقل شحنة كوكايين قياسية.  | الرباط أعلن جهاز المراقبة الجمركية التابع لوكالة الضرائب والحرس المدني الإسباني، أنه تم أمس الأربعاء، وبالتعاون مع المغرب، اعتراض سفينة من نوع قاطرة تحمل اسم “سكاي وايت”، كانت تنقل على متنها حوالي ثلاثة آلاف كيلوغرام من الكوكايين، موزعة على 80 رزمة بأحجام مختلفة. وأوضح بلاغ لمديرية المراقبة الجمركية أن هذه العملية جرت الخبر الأمن المغربي يشارك بشكل حاسم في اعتراض باخرة دولية تنقل شحنة كوكايين قياسية  .', 'size': 2}], 'main_title': 'اعتراض سفينة محملة بثلاثة أطنان من الكوكايين في بحر جزر الكناري بتعاون مع المغرب'}, {'community_id': '5', 'articles': [{'id': '124', 'title': 'خبير إسباني: المغرب يضطلع بدور “محوري” و”استراتيجي” في مكافحة تهريب المخدرات على الطريق الأطلسية', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%ae%d8%a8%d9%8a%d8%b1-%d8%a5%d8%b3%d8%a8%d8%a7%d9%86%d9%8a-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8-%d9%8a%d8%b6%d8%b7%d9%84%d8%b9-%d8%a8%d8%af%d9%88%d8%b1-%d9%85%d8%ad%d9%88%d8%b1%d9%8a-%d9%88/', 'summary': 'خبير إسباني: المغرب يضطلع بدور “محوري” و”استراتيجي” في مكافحة تهريب المخدرات على الطريق الأطلسية. أكد الخبير الإسباني، رافاييل إسبارزا ماتشين، أن المملكة المغربية تضطلع بدور “محوري” و”استراتيجي” في مكافحة تهريب المخدرات على “الطريق الأطلسية”، مشيدا بالتعاون “الخاص والنموذجي” القائم بين أجهزة الأمن المغربية ونظيرتها الإسبانية في هذا المجال. وأوضح إسبارزا ماتشين، في تصريح لوكالة المغرب العربي للأنباء، أن اعتراض سفينة هذا الأسبوع غرب جزر الكناري، كانت تنقل حوالي ثلاثة', 'size': 3}, {'id': '180', 'title': 'خبير إسباني: المغرب يضطلع بدور محوري واستراتيجي في مكافحة تهريب المخدرات على الطريق الأطلسية', 'source': 'machahid24.com', 'link': 'https://machahid24.com/politique/472672.html', 'summary': 'خبير إسباني: المغرب يضطلع بدور محوري واستراتيجي في مكافحة تهريب المخدرات على الطريق الأطلسية. و.م.ع أكد الخبير الإسباني، رافاييل إسبارزا ماتشين، أن المملكة المغربية تضطلع بدور “محوري” و”استراتيجي” في مكافحة تهريب المخدرات على “الطريق الأطلسية”، مشيدا بالتعاون “الخاص والنموذجي” القائم بين أجهزة الأمن المغربية ونظيرتها الإسبانية في هذا المجال. وأوضح إسبارزا ماتشين، في تصريح لوكالة المغرب العربي للأنباء، أن اعتراض سفينة هذا الأسبوع غرب جزر الكناري، كانت تنقل حوالي …', 'size': 3}, {'id': '411', 'title': 'خبير إسباني: المغرب يضطلع بدور محوري واستراتيجي في مكافحة تهريب المخدرات', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%ae%d8%a8%d9%8a%d8%b1-%d8%a5%d8%b3%d8%a8%d8%a7%d9%86%d9%8a-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8-%d9%8a%d8%b6%d8%b7%d9%84%d8%b9-%d8%a8%d8%af%d9%88%d8%b1-%d9%85%d8%ad%d9%88%d8%b1%d9%8a-%d9%88%d8%a7/', 'summary': 'خبير إسباني: المغرب يضطلع بدور محوري واستراتيجي في مكافحة تهريب المخدرات. أكد الخبير الإسباني، رافاييل إسبارزا ماتشين، أن المملكة المغربية تضطلع بدور “محوري” و”استراتيجي” في مكافحة تهريب المخدرات على “الطريق الأطلسية”. وأشاد الخبير في تصريح لوكالة المغرب العربي للأنباء، بالتعاون “الخاص والنموذجي” القائم بين أجهزة الأمن المغربية ونظيرتها الإسبانية في هذا المجال. وأوضح إسبارزا ماتشين، أن اعتراض سفينة هذا الأسبوع غرب جزر الكناري، كانت …  خبير إسباني: المغرب يضطلع بدور محوري واستراتيجي في مكافحة تهريب المخدرات     .', 'size': 3}], 'main_title': 'خبير إسباني: المغرب يضطلع بدور “محوري” و”استراتيجي” في مكافحة تهريب المخدرات على الطريق الأطلسية'}, {'community_id': '4', 'articles': [{'id': '233', 'title': 'درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%af%d8%b1%d8%ac%d8%a7%d8%aa-%d8%a7%d9%84%d8%ad%d8%b1%d8%a7%d8%b1%d8%a9-%d8%a7%d9%84%d8%af%d9%86%d9%8a%d8%a7-%d9%88%d8%a7%d9%84%d8%b9%d9%84%d9%8a%d8%a7-%d8%a7%d9%84%d9%85%d8%b1%d8%aa%d9%82%d8%a8-17/', 'summary': 'درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة. في ما يلي درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة، حسب المديرية العامة للأرصاد الجوية: المدينة – الحرارة الدنيا – الحرارة العليا وجدة 22……………. 39 بوعرفة 23………….. 40 الحسيمة 22………..30 تطوان 22…………… 30 سبتة المحتلة 23……27 مليلية المحتلة 23…….27 طنجة 25…………….35 القنيطرة 23……….30 الرباط 22…………..28 الدار البيضاء 22………26 الجديدة 22…………27 سطات 20………….40 آسفي …  درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة     .', 'size': 2}, {'id': '345', 'title': 'درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة بالمدن المغربية', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-585050.html', 'summary': 'درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة بالمدن المغربية. في ما يلي درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة، حسب المديرية العامة للأرصاد الجوية: المدينة – الحرارة الدنيا – الحرارة العليا —————————————– – وجدة 22……………. 39 – بوعرفة 23………….. 40 – الحسيمة 22………..30 – تطوان 22…………… 30 – سبتة المحتلة 23……27 – مليلية المحتلة 23…….27 – طنجة 25…………….35 – القنيطرة 23……….30 – الرباط', 'size': 2}], 'main_title': 'درجات الحرارة الدنيا والعليا المرتقبة غدا الجمعة'}, {'community_id': '0', 'articles': [{'id': '308', 'title': 'السكتيوي يكشف أسباب فوز “الأسود” على المنتخب الزامبي', 'source': 'www.alahdat.net', 'link': 'https://www.alahdat.net/archives/205032', 'summary': 'السكتيوي يكشف أسباب فوز “الأسود” على المنتخب الزامبي.  علّق الناخب الوطني طارق السكتيوي، على أداء “أسود الأطلس” في المباراة أمام المنتخب الزامبي والتي جرت أطوراها اليوم عن الجولة الرابعة للمجموعة الأولى ضمن كأس أمم إفريقيا للاعبين المحليين (شان 2024). وأبرز السكتيوي، في ندوة صحفية أعقبت المباراة، أن “اللاعبين كانوا أقوى ذهنيا وأداروا المباراة بشكل جيد، ما جعلهم يحققون هذا الفوز المستحق”، مضيفا', 'size': 2}, {'id': '328', 'title': 'السكتيوي: العامل الذهني وراء فوز الأسود على زامبيا', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d8%b3%d9%83%d8%aa%d9%8a%d9%88%d9%8a-%d8%a7%d9%84%d8%b9%d8%a7%d9%85%d9%84-%d8%a7%d9%84%d8%b0%d9%87%d9%86%d9%8a-%d9%88%d8%b1%d8%a7%d8%a1-%d9%81%d9%88%d8%b2-%d8%a7%d9%84%d8%a3%d8%b3%d9%88/', 'summary': 'السكتيوي: العامل الذهني وراء فوز الأسود على زامبيا. في أعقاب الانتصار المستحق الذي حققه المنتخب الوطني للمحليين على نظيره الزامبي بثلاثة أهداف مقابل هدف، ضمن الجولة الرابعة من منافسات المجموعة الأولى في كأس أمم إفريقيا للاعبين المحليين (شان 2024) المقامة بنيروبي، شدد الناخب الوطني طارق السكتيوي على أن العامل الذهني كان كلمة السر في هذا التألق. وأوضح السكتيوي، خلال الندوة الصحفية التي تلت', 'size': 2}, {'id': '346', 'title': 'ماذا قال السكتيوي بعد الفوز الثمين للمنتخب المغربي؟', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-585044.html', 'summary': 'ماذا قال السكتيوي بعد الفوز الثمين للمنتخب المغربي؟. أكد الناخب الوطني طارق السكتيوي، اليوم الخميس بنيروبي، أن العامل الذهني لدى لاعبي المنتخب كان حاسما في تحقيق الفوز على المنتخب الزامبي (3-1)، في المباراة التي جرت أطوراها اليوم عن الجولة الرابعة للمجموعة الأولى ضمن كأس أمم إفريقيا للاعبين المحليين (شان 2024). وأبرز السكتيوي، في ندوة صحفية أعقبت المباراة، أن “اللاعبين كانوا أقوى ذهنيا', 'size': 3}], 'main_title': 'ماذا قال السكتيوي بعد الفوز الثمين للمنتخب المغربي؟'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    