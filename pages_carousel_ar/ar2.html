<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 18/08/2025 - 12h27</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '4', 'articles': [{'id': '56', 'title': 'الملك محمد السادس يبعث برقية تهنئة لرئيس الغابون بمناسبة العيد الوطني لبلاده', 'source': 'ar.hibapress.com', 'link': 'https://ar.hibapress.com/details-650158.html', 'summary': 'الملك محمد السادس يبعث برقية تهنئة لرئيس الغابون بمناسبة العيد الوطني لبلاده. هبة بريس بعث الملك محمد السادس برقية تهنئة إلى رئيس جمهورية الغابون، رئيس الدولة، رئيس الحكومة، بريس كلوتير أوليغي نغيما، وذلك بمناسبة العيد الوطني لبلاده. وأعرب الملك، في هذه البرقية، عن أحر تهانئه وأصدق متمنياته لبريس كلوتير أوليغي نغيما، وللشعب الغابوني بمزيد الرخاء والرفاه. ومما جاء في برقية الملك، “كما هي مناسبة لأؤكد لكم العناية الخاصة التي توليها المملكة المغربية لتعزيز أواصر الصداقة الأخوية التي تربطها بجمهورية الغابون، مجددا لفخامتكم، في هذا الصدد، حرصي الوطيد على العمل سويا معكم، من أجل مواصلة ترسيخ علاقات التعاون الوثيق بين بلدينا الشقيقين”.', 'size': 3}, {'id': '222', 'title': 'جلالة الملك يهنئ رئيس الغابون في العيد الوطني لبلاده', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226013/', 'summary': 'جلالة الملك يهنئ رئيس الغابون في العيد الوطني لبلاده. بعث صاحب الجلالة الملك محمد السادس برقية تهنئة إلى رئيس جمهورية الغابون، رئيس الدولة، رئيس الحكومة، فخامة السيد بريس كلوتير أوليغي نغيما، وذلك بمناسبة العيد الوطني لبلاده. وأعرب جلالة الملك، في هذه البرقية، عن أحر تهانئه وأصدق متمنياته للسيد بريس كلوتير أوليغي نغيما، وللشعب الغابوني بمزيد الرخاء والرفاه. ومما جاء في برقية جلالة الملك، “كما', 'size': 3}, {'id': '240', 'title': 'الملك محمد السادس يهنئ رئيس جمهورية الغابون بمناسبة العيد الوطني لبلاده', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d9%84%d9%85%d9%84%d9%83-%d9%85%d8%ad%d9%85%d8%af-%d8%a7%d9%84%d8%b3%d8%a7%d8%af%d8%b3-%d9%8a%d9%87%d9%86%d8%a6-%d8%b1%d8%a6%d9%8a%d8%b3-%d8%ac%d9%85%d9%87%d9%88%d8%b1%d9%8a%d8%a9-%d8%a7-26/', 'summary': 'الملك محمد السادس يهنئ رئيس جمهورية الغابون بمناسبة العيد الوطني لبلاده. بعث الملك محمد السادس برقية تهنئة إلى رئيس جمهورية الغابون، رئيس الدولة، رئيس الحكومة، بريس كلوتير أوليغي نغيما، وذلك بمناسبة العيد الوطني لبلاده. وأعرب الملك محمد السادس، في هذه البرقية، عن أحر تهانئه وأصدق متمنياته لبريس كلوتير أوليغي نغيما، وللشعب الغابوني بمزيد الرخاء والرفاه. ومما جاء في برقية الملك محمد السادس، “كما هي …  الملك محمد السادس يهنئ رئيس جمهورية الغابون بمناسبة العيد الوطني لبلاده     .', 'size': 3}], 'main_title': 'الملك محمد السادس يبعث برقية تهنئة لرئيس الغابون بمناسبة العيد الوطني لبلاده'}, {'community_id': '1', 'articles': [{'id': '152', 'title': 'زلزال بقوة 5.8 يضرب شرق الجزائر', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1093436.html', 'summary': 'زلزال بقوة 5.8 يضرب شرق الجزائر. ضرب زلزال بقوة 5.8 درجات على مقياس ريختر، مساء الأحد، ولاية تبسة شرقي الجزائر المتاخمة للحدود مع تونس، بحسب ما أفادت وسائل إعلام جزائرية. وأوضح مركز البحث الجزائري في علم الفلك والفيزياء الفلكية والفيزياء الأرضية، أن مركز الهزة حدد على بعد 10 كيلومترات جنوب شرق بلدة نڨرين، وامتد إلى الحدود الغربية لتونس. كما أشار المركز ظهرت المقالة زلزال بقوة 5.8 يضرب شرق الجزائر  .', 'size': 2}, {'id': '235', 'title': 'زلزال بقوة 5.8 درجات يهز تبسة شرق الجزائر', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%b2%d9%84%d8%b2%d8%a7%d9%84-%d8%a8%d9%82%d9%88%d8%a9-5-8-%d8%af%d8%b1%d8%ac%d8%a7%d8%aa-%d9%8a%d9%87%d8%b2-%d8%aa%d8%a8%d8%b3%d8%a9-%d8%b4%d8%b1%d9%82-%d8%a7%d9%84%d8%ac%d8%b2%d8%a7%d8%a6%d8%b1/', 'summary': 'زلزال بقوة 5.8 درجات يهز تبسة شرق الجزائر. أعلن مركز البحث في علم الفلك والفيزياء الفلكية والجيوفيزياء بالجزائر، مساء اليوم الأحد، عن تسجيل هزة أرضية بلغت قوتها 5.8 درجات على مقياس ريختر. وأوضح المركز أن الزلزال وقع في محافظة تبسة أقصى شرق البلاد، حيث حُدد مركزه على بعد 10 كيلومترات جنوب شرق مدينة نڨرين، بالقرب من الحدود الجزائرية التونسية. ولم تُسجَّل …  زلزال بقوة 5.8 درجات يهز تبسة شرق الجزائر     .', 'size': 2}], 'main_title': 'زلزال بقوة 5.8 يضرب شرق الجزائر'}, {'community_id': '0', 'articles': [{'id': '172', 'title': 'لفتيت يحذر من توظيف برامج التنمية الترابية المندمجة لأغراض سياسية ضيقة', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d9%84%d9%81%d8%aa%d9%8a%d8%aa-%d9%8a%d8%ad%d8%b0%d8%b1-%d9%85%d9%86-%d8%aa%d9%88%d8%b8%d9%8a%d9%81-%d8%a8%d8%b1%d8%a7%d9%85%d8%ac-%d8%a7%d9%84%d8%aa%d9%86%d9%85%d9%8a%d8%a9-%d8%a7%d9%84%d8%aa%d8%b1/', 'summary': 'لفتيت يحذر من توظيف برامج التنمية الترابية المندمجة لأغراض سياسية ضيقة. حذر عبد الوافي لفتيت، وزير الداخلية، من أي استغلال محتمل خلال إعداد جيل جديد من برامج التنمية الترابية المندمجة لأغراض سياسية أو انتخابية ضيقة، وذلك تعبئة وانخراط لمجموع الفاعلين الترابيين المعنيين في إطار المقاربة التشاركية والمندمجة. ووجه لفتيت دورية إلى الولاة وعمال العمالات وعمالات المقاطعات، دعاهم فيها إلى الشروع في إعداد جيل جديد من برامج  لفتيت يحذر من توظيف برامج التنمية الترابية المندمجة لأغراض سياسية ضيقة     .', 'size': 3}, {'id': '299', 'title': 'تنفيذا لتوجيهات خطاب العرش.. لفتيت يستنفر الولاة والعمال لإعداد جيل جديد من برامج التنمية الترابية', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%aa%d9%86%d9%81%d9%8a%d8%b0%d8%a7-%d9%84%d8%aa%d9%88%d8%ac%d9%8a%d9%87%d8%a7%d8%aa-%d8%ae%d8%b7%d8%a7%d8%a8-%d8%a7%d9%84%d8%b9%d8%b1%d8%b4-%d9%84%d9%81%d8%aa%d9%8a%d8%aa-%d9%8a%d8%b3%d8%aa%d9%86/', 'summary': 'تنفيذا لتوجيهات خطاب العرش.. لفتيت يستنفر الولاة والعمال لإعداد جيل جديد من برامج التنمية الترابية. دعا وزير الداخلية عبد الوافي لفتيت الولاة والعمال لإعداد جيل جديد من برامج التنمية المجالية المندمجة في أقرب الآجال. وفي مراسلة اطلع موقع “كيفاش” على نسخة منها، أبرز لفتيت، أن “هذا الجيل الجديد من برامج التنمية الترابية المندمجة، يجب أن يقوم على تثمين الخصوصيات المحلية، وترسيخ الجهوية المتقدمة، واعتماد مبادئ التكامل والتضامن بين الكيانات الترابية،', 'size': 3}, {'id': '317', 'title': 'لفتيت يحذر من تسييس برامج التنمية الترابية الجديدة', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321261/', 'summary': 'لفتيت يحذر من تسييس برامج التنمية الترابية الجديدة. نبه وزير الداخلية، عبد الوافي لفتيت، الولاة والعمال إلى ضرورة تجنب أي استغلال سياسي أو انتخابي خلال مرحلة الإعداد لجيل جديد من برامج التنمية الترابية المندمجة. وأكد لفتيت أن هذا الورش الملكي يستوجب تعبئة شاملة ومقاربة تشاركية قائمة على التكامل والتضامن. وجاء تحذير لفتيت من خلال دورية وزارية عممها على ممثلي السلطة الترابية، عقب', 'size': 3}], 'main_title': 'لفتيت يحذر من توظيف برامج التنمية الترابية المندمجة لأغراض سياسية ضيقة'}, {'community_id': '3', 'articles': [{'id': '189', 'title': 'السكتيوي: نسعى للذهاب لأبعد نقطة ممكنة بكأس إفريقيا للمحليين', 'source': 'machahid24.com', 'link': 'https://machahid24.com/sport/472914.html', 'summary': 'السكتيوي: نسعى للذهاب لأبعد نقطة ممكنة بكأس إفريقيا للمحليين. أكد مدرب المنتخب الوطني لكرة القدم للاعبين المحليين، طارق السكيتيوي، أن قوة شخصية اللاعبين وثقتهم بأنفسهم كانتا حاسمتين في فوزهم في المباراة التي جمعتهم مع منتخب الكونغو الديمقراطية (3-1)، اليوم الأحد بنيروبي، لحساب الجولة الخامسة والأخيرة للمجموعة الأولى ضمن بطولة كأس أمم إفريقيا للعبة، وبالتالي عبورهم إلى دور ربع النهائي. وقال السكتيوي في مؤتمر صحفي …', 'size': 2}, {'id': '234', 'title': 'السكتيوي: قوة شخصية اللاعبين وثقتهم بأنفسهم كانت حاسمة في المباراة ضد الكونغو الديمقراطية', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d9%84%d8%b3%d9%83%d8%aa%d9%8a%d9%88%d9%8a-%d9%82%d9%88%d8%a9-%d8%b4%d8%ae%d8%b5%d9%8a%d8%a9-%d8%a7%d9%84%d9%84%d8%a7%d8%b9%d8%a8%d9%8a%d9%86-%d9%88%d8%ab%d9%82%d8%aa%d9%87%d9%85-%d8%a8%d8%a3/', 'summary': 'السكتيوي: قوة شخصية اللاعبين وثقتهم بأنفسهم كانت حاسمة في المباراة ضد الكونغو الديمقراطية. أكد مدرب المنتخب الوطني لكرة القدم للاعبين المحليين، طارق السكيتيوي، أن قوة شخصية اللاعبين وثقتهم بأنفسهم كانتا حاسمتين في فوزهم في المباراة التي جمعتهم مع منتخب الكونغو الديمقراطية (3-1)، اليوم الأحد بنيروبي، لحساب الجولة الخامسة والأخيرة للمجموعة الأولى ضمن بطولة كأس أمم إفريقيا للعبة، وبالتالي عبورهم إلى دور ربع النهائي. وقال السكتيوي في …  السكتيوي: قوة شخصية اللاعبين وثقتهم بأنفسهم كانت حاسمة في المباراة ضد الكونغو الديمقراطية     .', 'size': 2}], 'main_title': 'السكتيوي: نسعى للذهاب لأبعد نقطة ممكنة بكأس إفريقيا للمحليين'}, {'community_id': '2', 'articles': [{'id': '337', 'title': 'توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d9%87%d8%a8%d9%88%d8%a8-%d8%b4%d8%b1%d9%83%d9%8a-%d9%85%d8%ad%d9%84%d9%8a-%d8%a8%d8%a7%d9%84%d8%b3/', 'summary': 'توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الاثنين، أن تتميز الحالة الجوية عامة، بطقس حار إلى جد حار محليا مع هبوب شركي محلي بالسهول الداخلية الشمالية والوسطى، والساحل المتوسطي، وشمال المنطقة الشرقية والجنوب الشرقي، وداخل كل من منطقة سوس والأقاليم الصحراوية. كما يرتقب تشكل سحب منخفضة مرفوقة بكتل من الضباب المحلي بالواجهة المتوسطية وسواحل المحيط  توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية     .', 'size': 3}, {'id': '338', 'title': 'طقس الاثنين: أجواء جد حارة بعدد من المناطق', 'source': 'soltana.ma', 'link': 'https://soltana.ma/1357656.html', 'summary': 'طقس الاثنين: أجواء جد حارة بعدد من المناطق. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الاثنين، أن تتميز الحالة الجوية عامة بطقس حار إلى جد حار محليا مع هبوب شركي محلي بالسهول الداخلية الشمالية والوسطى، والساحل المتوسطي، وشمال المنطقة الشرقية والجنوب الشرقي، وداخل كل من منطقة سوس و الأقاليم الصحراوية. كما يرتقب تشكل سحب منخفضة مرفوقة بكتل من الضباب المحلي بالواجهة المتوسطية وسواحل', 'size': 3}, {'id': '379', 'title': 'توقعات أحوال الطقس اليوم الإثنين', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d8%a7%d9%84%d9%8a%d9%88%d9%85-%d8%a7%d9%84%d8%a5%d8%ab%d9%86%d9%8a%d9%86-8/', 'summary': 'توقعات أحوال الطقس اليوم الإثنين. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الإثنين، أن تتميز الحالة الجوية عامة، بطقس حار إلى جد حار محليا مع هبوب شركي محلي بالسهول الداخلية الشمالية و الوسطى، والساحل المتوسطي، وشمال المنطقة الشرقية والجنوب الشرقي، وداخل كل من منطقة سوس و الأقاليم الصحراوية. كما يرتقب تشكل سحب منخفضة مرفوقة بكتل من الضباب المحلي …  توقعات أحوال الطقس اليوم الإثنين     .', 'size': 3}], 'main_title': 'توقعات أحوال الطقس.. هبوب شركي محلي بالسهول الداخلية'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    