<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 30/08/2025 - 12h23</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '68', 'title': 'السكر والسياقة المتهورة ينتهيان بتوقيف شخصين في سلا', 'source': 'www.alahdat.net', 'link': 'https://www.alahdat.net/archives/205484', 'summary': 'السكر والسياقة المتهورة ينتهيان بتوقيف شخصين في سلا.  تمكنت عناصر الشرطة بالأمن الإقليمي بمدينة سلا، مساء أمس الخميس 28 غشت الجاري، من توقيف شخص يبلغ من العمر 32 سنة، وذلك للاشتباه في تورطه في السكر العلني البين والسياقة بطريقة استعراضية بالشارع العام وتعريض أمن المواطنين وسلامة مستعملي الطريق للخطر. وكان المشتبه فيه قد أقدم على سياقة سيارة نفعية بطريقة استعراضية وخطيرة بالشارع', 'size': 2}, {'id': '218', 'title': 'السكر العلني والسياقة الاستعراضية تقود شخصا إلى الكوميسارية بسلا', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226460/', 'summary': 'السكر العلني والسياقة الاستعراضية تقود شخصا إلى الكوميسارية بسلا. تمكنت عناصر الشرطة بالأمن الإقليمي بمدينة سلا، مساء أمس الخميس 28 غشت الجاري، من توقيف شخص يبلغ من العمر 32 سنة، وذلك للاشتباه في تورطه في السكر العلني البين والسياقة بطريقة استعراضية بالشارع العام وتعريض أمن المواطنين وسلامة مستعملي الطريق للخطر. وكان المشتبه فيه قد أقدم على سياقة سيارة نفعية بطريقة استعراضية وخطيرة بالشارع العام', 'size': 2}], 'main_title': 'السكر والسياقة المتهورة ينتهيان بتوقيف شخصين في سلا'}, {'community_id': '1', 'articles': [{'id': '105', 'title': 'أعضاء بالكونغرس الأمريكي يجددون تأكيد اعتراف واشنطن بسيادة المغرب على صحرائه', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/politic/411857.html', 'summary': 'أعضاء بالكونغرس الأمريكي يجددون تأكيد اعتراف واشنطن بسيادة المغرب على صحرائه. جدد أعضاء بالكونغرس الأمريكي، اليوم الجمعة بالرباط، تأكيد اعتراف الولايات المتحدة بسيادة المغرب على صحرائه. وأبرز الأعضاء عقب محادثات مع وزير الشؤون الخارجية والتعاون الإفريقي والمغاربة المقيمين', 'size': 2}, {'id': '120', 'title': 'الرباط.. أعضاء بالكونغرس الأمريكي يجددون تأكيد اعتراف بلادهم بسيادة المغرب على صحرائه', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d8%b1%d8%a8%d8%a7%d8%b7-%d8%a3%d8%b9%d8%b6%d8%a7%d8%a1-%d8%a8%d8%a7%d9%84%d9%83%d9%88%d9%86%d8%ba%d8%b1%d8%b3-%d8%a7%d9%84%d8%a3%d9%85%d8%b1%d9%8a%d9%83%d9%8a-%d9%8a%d8%ac%d8%af%d8%af/', 'summary': 'الرباط.. أعضاء بالكونغرس الأمريكي يجددون تأكيد اعتراف بلادهم بسيادة المغرب على صحرائه. جدد أعضاء بالكونغرس الأمريكي، اليوم الجمعة (29 غشت 2025) بالرباط، تأكيد اعتراف الولايات المتحدة بسيادة المغرب على صحرائه. وأبرزوا عقب محادثات مع وزير الشؤون الخارجية والتعاون الإفريقي والمغاربة المقيمين بالخارج، ناصر بوريطة، آفاق التعاون بين المغرب والولايات المتحدة. وقال عضو الكونغرس مايك لولر في هذا الصدد، “نحن سعداء بآفاق التعاون بين المغرب والولايات المتحدة، لا', 'size': 2}, {'id': '141', 'title': 'أعضاء بالكونغرس الأمريكي يجددون تأكيد اعتراف بلادهم بسيادة المغرب على صحرائه', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321947/', 'summary': 'أعضاء بالكونغرس الأمريكي يجددون تأكيد اعتراف بلادهم بسيادة المغرب على صحرائه. جدد أعضاء بالكونغرس الأمريكي، اليوم الجمعة بالرباط، تأكيد اعتراف الولايات المتحدة بسيادة المغرب على صحرائه. وأبرزوا عقب محادثات مع وزير الشؤون الخارجية والتعاون الإفريقي والمغاربة المقيمين بالخارج، ناصر بوريطة، آفاق التعاون بين المغرب والولايات المتحدة. وقال عضو الكونغرس مايك لولر في هذا الصدد، “نحسن سعداء بآفاق التعاون بين المغرب والولايات المتحدة، لا سيما في الصحراء”،', 'size': 4}, {'id': '323', 'title': 'أعضاء بالكونغرس الأمريكي يجددون تشبثهم باعتراف واشنطن بمغربية الصحراء', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1096005.html', 'summary': 'أعضاء بالكونغرس الأمريكي يجددون تشبثهم باعتراف واشنطن بمغربية الصحراء. جدد أعضاء بالكونغرس الأمريكي، اليوم الجمعة بالرباط، تأكيد اعتراف الولايات المتحدة بسيادة المغرب على صحرائه، وأبرزوا عقب محادثات مع وزير الشؤون الخارجية والتعاون الإفريقي والمغاربة المقيمين بالخارج، ناصر بوريطة، آفاق التعاون بين المغرب والولايات المتحدة. وقال عضو الكونغرس مايك لولر في هذا الصدد، “نحن سعداء بآفاق التعاون بين المغرب والولايات المتحدة، لا سيما في الصحراء”، ظهرت المقالة أعضاء بالكونغرس الأمريكي يجددون تشبثهم باعتراف واشنطن بمغربية الصحراء  .', 'size': 3}, {'id': '344', 'title': 'أعضاء بالكونغرس يؤكدون اعتراف واشنطن بسيادة المغرب على الصحراء', 'source': 'almassaa.com', 'link': 'https://almassaa.com/%d8%a3%d8%b9%d8%b6%d8%a7%d8%a1-%d8%a8%d8%a7%d9%84%d9%83%d9%88%d9%86%d8%ba%d8%b1%d8%b3-%d9%8a%d8%a4%d9%83%d8%af%d9%88%d9%86-%d8%a7%d8%b9%d8%aa%d8%b1%d8%a7%d9%81-%d9%88%d8%a7%d8%b4%d9%86%d8%b7%d9%86/', 'summary': 'أعضاء بالكونغرس يؤكدون اعتراف واشنطن بسيادة المغرب على الصحراء. المساء اليوم: جدد أعضاء بالكونغرس الأمريكي تأكيد اعتراف الولايات المتحدة بسيادة المغرب على الصحراء. وأبرزوا عقب محادثات، أمس الجمعة بالرباط، مع وزير الشؤون الخارجية والتعاون الإفريقي والمغاربة المقيمين بالخارج، ناصر بوريطة، آفاق التعاون بين المغرب', 'size': 4}], 'main_title': 'أعضاء بالكونغرس الأمريكي يجددون تأكيد اعتراف بلادهم بسيادة المغرب على صحرائه'}, {'community_id': '2', 'articles': [{'id': '123', 'title': 'الميركاتو الصيفي. حكيم زياش على بعد خطوة من اللعب في إلتشي', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d9%85%d9%8a%d8%b1%d9%83%d8%a7%d8%aa%d9%88-%d8%a7%d9%84%d8%b5%d9%8a%d9%81%d9%8a-%d8%ad%d9%83%d9%8a%d9%85-%d8%b2%d9%8a%d8%a7%d8%b4-%d8%b9%d9%84%d9%89-%d8%a8%d8%b9%d8%af-%d8%ae%d8%b7%d9%88/', 'summary': 'الميركاتو الصيفي. حكيم زياش على بعد خطوة من اللعب في إلتشي. أفادت تقارير صحفية إسبانية أن الدولي المغربي حكيم زياش بات قريبًا جدًا من الانضمام إلى صفوف نادي إلتشي، بعد أن أصبح لاعبًا حرًا منذ رحيله عن الدحيل القطري، عقب تجربة قصيرة لم تتجاوز ستة أشهر. وذكرت شبكة “copeelche” أن المفاوضات بين الطرفين وصلت لمراحلها الأخيرة، ولم يتبق سوى بعض التفاصيل البسيطة قبل توقيع العقد', 'size': 2}, {'id': '239', 'title': 'حكيم زياش يقترب من الدوري الإسباني', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%ad%d9%83%d9%8a%d9%85-%d8%b2%d9%8a%d8%a7%d8%b4-%d9%8a%d9%82%d8%aa%d8%b1%d8%a8-%d9%85%d9%86-%d8%a7%d9%84%d8%af%d9%88%d8%b1%d9%8a-%d8%a7%d9%84%d8%a5%d8%b3%d8%a8%d8%a7%d9%86%d9%8a/', 'summary': 'حكيم زياش يقترب من الدوري الإسباني. تقدم نادي إلتشي الإسباني لكرة القدم بشكل كبير في مفاوضاته مع الدولي المغربي حكيم زياش، من أجل ضمه خلال فترة الانتقالات الصيفية الحالية، في صفقة انتقال حر، بعد أن ظل اللاعب بدون فريق منذ نهاية تجربته القصيرة مع نادي الدحيل القطري. وكشفت صحيفة “آس” الإسبانية أن إلتشي بات قريبًا من حسم الصفقة، متفوقًا …  حكيم زياش يقترب من الدوري الإسباني     .', 'size': 2}], 'main_title': 'الميركاتو الصيفي. حكيم زياش على بعد خطوة من اللعب في إلتشي'}, {'community_id': '5', 'articles': [{'id': '139', 'title': 'قطاع السياحة.. عائدات قياسية بـ67 مليار درهم', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321975/', 'summary': 'قطاع السياحة.. عائدات قياسية بـ67 مليار درهم. أفادت وزارة السياحة والصناعة التقليدية والاقتصاد الاجتماعي والتضامني بأن قطاع السياحة سجل عائدات قياسية بـ67 مليار درهم خلال الأشهر السبعة الأولى لسنة 2025، بارتفاع بنسبة 13 في المائة مقارنة بالفترة ذاتها من السنة الماضية. وذكرت الوزارة، في بلاغ لها، أن “قطاع السياحة يواصل ديناميته التصاعدية خلال سنة 2025. فإلى غاية نهاية يوليوز، ومع استقبال المغرب', 'size': 3}, {'id': '171', 'title': 'السياحة تحقق عائدات غير مسبوقة قدرها 67 مليار درهم في سبعة أشهر فقط', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d8%b3%d9%8a%d8%a7%d8%ad%d8%a9-%d8%aa%d8%ad%d9%82%d9%82-%d8%b9%d8%a7%d8%a6%d8%af%d8%a7%d8%aa-%d8%ba%d9%8a%d8%b1-%d9%85%d8%b3%d8%a8%d9%88%d9%82%d8%a9-%d9%82%d8%af%d8%b1%d9%87%d8%a7-67/', 'summary': 'السياحة تحقق عائدات غير مسبوقة قدرها 67 مليار درهم في سبعة أشهر فقط. أفادت وزارة السياحة والصناعة التقليدية والاقتصاد الاجتماعي والتضامني بأن قطاع السياحة حقق عائدات قياسية بلغت 67 مليار درهم خلال الأشهر السبعة الأولى من سنة 2025، مسجلا ارتفاعا بنسبة 13 في المائة مقارنة بالفترة نفسها من السنة الماضية. وأوضحت الوزارة، في بلاغ لها، أن "قطاع السياحة يواصل ديناميته التصاعدية خلال سنة 2025. فإلى غاية نهاية  السياحة تحقق عائدات غير مسبوقة قدرها 67 مليار درهم في سبعة أشهر فقط     .', 'size': 2}, {'id': '189', 'title': 'السياحة.. عائدات قياسية ب 67 مليار درهم  حتى نهاية يوليوز 2025', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/474080.html', 'summary': 'السياحة.. عائدات قياسية ب 67 مليار درهم حتى نهاية يوليوز 2025. يواصل قطاع السياحة ديناميته التصاعدية خلال عام 202، فحتى نهاية يوليوز، استقبل المغرب 11,6 مليون سائح، بزيادة قدرها 16% مقارنة بسنة 2024. وحسب بلاغ لوزارة السياحة فقد بلغت العائدات السياحية من العملة الصعبة 67 مليار درهم، أي نمواً يقارب 13% مقارنة بالفترة نفسها من 2024، وهو ما يعادل 7,5 مليار درهم إضافية. وشهد شهر يوليوز …', 'size': 2}, {'id': '320', 'title': '67 مليار درهم.. السياحة تنعش الاقتصاد الوطني بعائدات قياسية في سبعة أشهر', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1096054.html', 'summary': '67 مليار درهم.. السياحة تنعش الاقتصاد الوطني بعائدات قياسية في سبعة أشهر. واصل قطاع السياحة المغربي تسجيل أداء قوي خلال سنة 2025، محققا عائدات قياسية بلغت 67 مليار درهم خلال الأشهر السبعة الأولى من السنة الجارية، بزيادة نسبتها 13 في المائة مقارنة مع الفترة نفسها من سنة 2024، وفق ما كشفته وزارة السياحة والصناعة التقليدية والاقتصاد الاجتماعي والتضامني. وحسب معطيات الوزارة، فقد استقبل المغرب ما مجموعه 11.6 ظهرت المقالة 67 مليار درهم.. السياحة تنعش الاقتصاد الوطني بعائدات قياسية في سبعة أشهر  .', 'size': 3}], 'main_title': 'قطاع السياحة.. عائدات قياسية بـ67 مليار درهم'}, {'community_id': '4', 'articles': [{'id': '161', 'title': 'مجلس المنافسة: التضخم يتراجع بحذر ومكافحة المضاربة والاحتكار شرطان لحماية القدرة الشرائية', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1095868.html', 'summary': 'مجلس المنافسة: التضخم يتراجع بحذر ومكافحة المضاربة والاحتكار شرطان لحماية القدرة الشرائية. قدم مجلس المنافسة، في تقريره السنوي الشامل لعام 2024، قراءة دقيقة للوضع الاقتصادي الوطني، حيث دق ناقوس الخطر مؤكدا أن معركة كبح جماح التضخم لم تضع أوزارها بعد، على الرغم من التباطؤ الملحوظ في وتيرة ارتفاع الأسعار الذي شهدته البلاد خلال السنة المنصرمة، مشيرا إلى أن التهديدات التضخمية ما تزال كامنة، وقد تعود للظهور إذا ظهرت المقالة مجلس المنافسة: التضخم يتراجع بحذر ومكافحة المضاربة والاحتكار شرطان لحماية القدرة الشرائية  .', 'size': 2}, {'id': '168', 'title': 'مجلس المنافسة: ثماني شركات تستحوذ على 75% من سوق الأعلاف المركبة', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d9%85%d8%ac%d9%84%d8%b3-%d8%a7%d9%84%d9%85%d9%86%d8%a7%d9%81%d8%b3%d8%a9-%d8%ab%d9%85%d8%a7%d9%86%d9%8a-%d8%b4%d8%b1%d9%83%d8%a7%d8%aa-%d8%aa%d8%b3%d8%aa%d8%ad%d9%88%d8%b0-%d8%b9%d9%84%d9%89-75/', 'summary': 'مجلس المنافسة: ثماني شركات تستحوذ على 75% من سوق الأعلاف المركبة. كشف مجلس المنافسة أن ثماني شركات فقط تستحوذ على 75 في المائة من حصص سوق الأعلاف المركبة ويصاحب هذه الوضعية بروز متزايد للاندماج العمودي، الذي يضعف المنافسة، خاصة بالنسبة إلى الفاعلين الصغار. وأوضح المجلس، في تقريره السنوي برسم 2024، أن ضعف تنوع المنتجات، الذي كرسه إطار تنظيمي متقادم يعود إلى سنة 1948، يكبح من وتيرة  مجلس المنافسة: ثماني شركات تستحوذ على 75% من سوق الأعلاف المركبة     .', 'size': 2}], 'main_title': 'مجلس المنافسة: التضخم يتراجع بحذر ومكافحة المضاربة والاحتكار شرطان لحماية القدرة الشرائية'}, {'community_id': '6', 'articles': [{'id': '174', 'title': 'طقس اليوم: قطرات مطرية خفيفة بهذه المناطق', 'source': 'soltana.ma', 'link': 'https://soltana.ma/1357717.html', 'summary': 'طقس اليوم: قطرات مطرية خفيفة بهذه المناطق. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليومه الجمعة، أن يبقى الطقس حارا نسبيا بكل من الجنوب الشرقي وأقصى جنوب المملكة، مع تشكل سحب منخفضة كثيفة مصحوبة بقطرات مطرية جد خفيفة أو بكتل ضبابية قرب سواحل المحيط الأطلسي وبالشمال الغربي للأقاليم الجنوبية، وذلك خلال الصباح والليل. كما يرتقب أن تكون الأجواء غائمة جزئيا بأقصى جنوب البلاد', 'size': 2}, {'id': '352', 'title': 'توقعات أحوال الطقس اليوم السبت', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d8%a7%d9%84%d9%8a%d9%88%d9%85-%d8%a7%d9%84%d8%b3%d8%a8%d8%aa-28/', 'summary': 'توقعات أحوال الطقس اليوم السبت. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليومه السبت، أن يبقى الطقس حارا نسبيا بكل من السهول الداخلية الشمالية والوسطى، والسايس، وملوية، والجنوب الشرقي وبأقصى جنوب المملكة. كما يرتقب تشكل سحب منخفضة كثيفة، مصحوبة بقطرات مطرية جد خفيفة أو بكتل ضبابية قرب سواحل المحيط الأطلسي وبالشمال الغربي للأقاليم الجنوبية، وذلك خلال الصباح والليل. ومن …  توقعات أحوال الطقس اليوم السبت     .', 'size': 2}], 'main_title': 'طقس اليوم: قطرات مطرية خفيفة بهذه المناطق'}, {'community_id': '3', 'articles': [{'id': '202', 'title': 'حادث مروع.. وفاة فلاح بعدما ابتلعته آلة حصاد', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d8%ad%d8%a7%d8%af%d8%ab-%d9%85%d8%a3%d8%b3%d8%a7%d9%88%d9%8a-%d8%a7%d9%84%d8%ac%d8%af%d9%8a%d8%af%d8%a9/', 'summary': 'حادث مروع.. وفاة فلاح بعدما ابتلعته آلة حصاد.  – متابعات اهتز دوار أولاد سيدي بوعلام بجماعة مكرس في إقليم الجديدة، صباح اليوم الجمعة، على وقع حادث مروع بعدما ابتلعت آلة حصاد فلاحًا في الخمسينات من عمره....  حادث مروع.. وفاة فلاح بعدما ابتلعته آلة حصاد     .', 'size': 2}, {'id': '241', 'title': 'الجديدة.. آلة حصاد تودي بحياة فلاح بدوار أولاد سيدي بوعلام', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d9%84%d8%ac%d8%af%d9%8a%d8%af%d8%a9-%d8%a2%d9%84%d8%a9-%d8%ad%d8%b5%d8%a7%d8%af-%d8%aa%d9%88%d8%af%d9%8a-%d8%a8%d8%ad%d9%8a%d8%a7%d8%a9-%d9%81%d9%84%d8%a7%d8%ad-%d8%a8%d8%af%d9%88%d8%a7%d8%b1/', 'summary': 'الجديدة.. آلة حصاد تودي بحياة فلاح بدوار أولاد سيدي بوعلام. شهد دوار أولاد سيدي بوعلام بجماعة مكرس، إقليم الجديدة، اليوم الجمعة، حادثا مأساويا خلف حالة من الذهول والحزن في صفوف الساكنة، بعدما لقي فلاح مصرعه في ظروف مؤلمة أثناء مزاولة عمله في الحقول. وبحسب ما أفادت به مصادر محلية، كان الضحية بصدد تشغيل آلة لحصاد الذرة قبل أن تبتلعه بشكل مفاجئ، متسببة في …  الجديدة.. آلة حصاد تودي بحياة فلاح بدوار أولاد سيدي بوعلام     .', 'size': 2}], 'main_title': 'حادث مروع.. وفاة فلاح بعدما ابتلعته آلة حصاد'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    