<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 25/07/2025 - 12h27</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '2', 'articles': [{'id': '81', 'title': 'وسيط المملكة يرفع تقريره السنوي للملك..زيادة قياسية في التظلمات وهذه القطاعات الأكثر تعرضا للشكاوى', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/national/409845.html', 'summary': 'وسيط المملكة يرفع تقريره السنوي للملك..زيادة قياسية في التظلمات وهذه القطاعات الأكثر تعرضا للشكاوى. رفع وسيط المملكة تقريره السنوي لعام 2024 إلى الملك محمد السادس، حيث سجل زيادة ملحوظة في عدد التظلمات والملفات التي تمت معالجتها مقارنة بالعام الماضي.', 'size': 3}, {'id': '204', 'title': 'مؤسسة محمد السادس لإعادة إدماج السجناء تطلق الأنشطة الصيفية لفائدة أبناء المفرج عنهم في قضايا التطرف والإرهاب', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/470537.html', 'summary': 'مؤسسة محمد السادس لإعادة إدماج السجناء تطلق الأنشطة الصيفية لفائدة أبناء المفرج عنهم في قضايا التطرف والإرهاب. أعطت مؤسسة محمد السادس لإعادة إدماج السجناء، الانطلاقة الرسمية للموسم الجديد للأنشطة التربوية الصيفية لفائدة أبناء المفرج عنهم في قضايا التطرف والإرهاب.', 'size': 3}, {'id': '237', 'title': 'مؤسسة محمد السادس لإعادة إدماج السجناء تدشن الأنشطة الصيفية لأبناء المفرج عنهم في قضايا التطرف', 'source': 'almassaa.com', 'link': 'https://almassaa.com/%d9%85%d8%a4%d8%b3%d8%b3%d8%a9-%d9%85%d8%ad%d9%85%d8%af-%d8%a7%d9%84%d8%b3%d8%a7%d8%af%d8%b3-%d9%84%d8%a5%d8%b9%d8%a7%d8%af%d8%a9-%d8%a5%d8%af%d9%85%d8%a7%d8%ac-%d8%a7%d9%84%d8%b3%d8%ac%d9%86%d8%a7/', 'summary': 'مؤسسة محمد السادس لإعادة إدماج السجناء تدشن الأنشطة الصيفية لأبناء المفرج عنهم في قضايا التطرف. المساء اليوم: أعطت مؤسسة محمد السادس لإعادة إدماج السجناء الانطلاقة الرسمية للموسم الجديد للأنشطة التربوية الصيفية لفائدة أبناء المفرج عنهم في قضايا التطرف والإرهاب. وأوضحت المؤسسة، في بيان لها اليوم الخميس، أن هذه المبادرة، المنظمة', 'size': 3}], 'main_title': 'وسيط المملكة يرفع تقريره السنوي للملك..زيادة قياسية في التظلمات وهذه القطاعات الأكثر تعرضا للشكاوى'}, {'community_id': '1', 'articles': [{'id': '97', 'title': 'هذا هو عدد البطاقات البنكية المتداولة في المغرب خلال 2024', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/economy/409862.html', 'summary': 'هذا هو عدد البطاقات البنكية المتداولة في المغرب خلال 2024. كشف التقرير السنوي حول الإشراف البنكي الصادر عن بنك المغرب أن عدد البطاقات البنكية المتداولة في المغرب بلغ 22,6 مليون بطاقة خلال سنة 2024، بزيادة', 'size': 2}, {'id': '178', 'title': 'التحول الرقمي يتسارع: 13.8 مليون حساب أداء وطفرة بـ33% بسبب البرامج الاجتماعية', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d8%aa%d8%ad%d9%88%d9%84-%d8%a7%d9%84%d8%b1%d9%82%d9%85%d9%8a-%d9%8a%d8%aa%d8%b3%d8%a7%d8%b1%d8%b9-13-8-%d9%85%d9%84%d9%8a%d9%88%d9%86-%d8%ad%d8%b3%d8%a7%d8%a8-%d8%a3%d8%af%d8%a7%d8%a1/', 'summary': 'التحول الرقمي يتسارع: 13.8 مليون حساب أداء وطفرة بـ33% بسبب البرامج الاجتماعية. سجلت منظومة الأداء الرقمي في المغرب قفزة كبيرة خلال سنة 2024، حيث أفاد بنك المغرب بأن عدد حسابات الأداء المفتوحة لدى المؤسسات المؤهلة بلغ 13,8 مليون حساب، ما يمثل نموا بنسبة 33 في المائة مقارنة بسنة 2023. ويعزى هذا الارتفاع اللافت، حسب التقرير السنوي لبنك المغرب حول الإشراف البنكي، إلى التوسع الملحوظ في فتح الحسابات  التحول الرقمي يتسارع: 13.8 مليون حساب أداء وطفرة بـ33% بسبب البرامج الاجتماعية     .', 'size': 2}], 'main_title': 'هذا هو عدد البطاقات البنكية المتداولة في المغرب خلال 2024'}, {'community_id': '3', 'articles': [{'id': '115', 'title': 'المنصوري تفند التسريبات المغرضة وتعلن لجوءها للقضاء ضد مروجي المعلومات المزيفة', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/politic/409879.html', 'summary': 'المنصوري تفند التسريبات المغرضة وتعلن لجوءها للقضاء ضد مروجي المعلومات المزيفة. نفت فاطمة الزهراء المنصوري، وزيرة إعداد التراب الوطني والتعمير والإسكان وسياسة المدينة، وعمدة مدينة مراكش، صحة ما تم تداوله من مزاعم وتسريبات تتعلق ببيع عقارات', 'size': 2}, {'id': '144', 'title': 'المنصوري تنفي بيع أراضٍ تابعة للدولة.. وتوضح: العقارات مملوكة لعائلتي منذ 1978', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/319238/', 'summary': 'المنصوري تنفي بيع أراضٍ تابعة للدولة.. وتوضح: العقارات مملوكة لعائلتي منذ 1978. نفت وزيرة إعداد التراب الوطني والتعمير والإسكان وسياسة المدينة، فاطمة الزهراء المنصوري، ما راج مؤخرًا على مواقع التواصل الاجتماعي بشأن بيع عقارات بمدينة مراكش تُعدّ من أملاك الدولة. وقالت فاطمة الزهراء المنصوري، في بلاغ توضيحي، إن الأراضي موضوع الحديث تعود ملكيتها الأصلية لوالدها المرحوم عبد الرحمان المنصوري، الذي اقتناها من مالكيها الخواص سنة 1978، وليس', 'size': 2}], 'main_title': 'المنصوري تفند التسريبات المغرضة وتعلن لجوءها للقضاء ضد مروجي المعلومات المزيفة'}, {'community_id': '0', 'articles': [{'id': '122', 'title': 'صياد النعامة يلقاها يلقاها.. حكم جديد ضد جيراندو في كندا', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%b5%d9%8a%d8%a7%d8%af-%d8%a7%d9%84%d9%86%d8%b9%d8%a7%d9%85%d8%a9-%d9%8a%d9%84%d9%82%d8%a7%d9%87%d8%a7-%d9%8a%d9%84%d9%82%d8%a7%d9%87%d8%a7-%d8%ad%d9%83%d9%85-%d8%ac%d8%af%d9%8a%d8%af-%d8%b6%d8%af/', 'summary': 'صياد النعامة يلقاها يلقاها.. حكم جديد ضد جيراندو في كندا. أدانت المحكمة العليا بكيبيك، اليوم الخميس (24 يوليوز)، المدعو هشام جيراندو، بالسجن النافذ لمدة شهر مع إنجاز 150 ساعة من الخدمة المجتمعية، ودفع غرامة مالية قدرها 10,000 دولار كندي. ويأتي هذا الحكم المدين لممارسات جيراندو الاحتيالية في إطار دعوى رفعها القاضي المغربي عبد الرحيم حنين أمام المحاكم الكندية، بعد تعرضه للتشهير من قبل “جيراندو”. وللمدعو جيراندو', 'size': 5}, {'id': '137', 'title': 'القضاء الكندي يدين هشام جيراندو.. 30 يوما سجنا وغرامة بـ10 آلاف دولار', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/319254/', 'summary': 'القضاء الكندي يدين هشام جيراندو.. 30 يوما سجنا وغرامة بـ10 آلاف دولار. في تطور قضائي لافت، أصدرت المحكمة العليا في مقاطعة كيبيك الكندية، يوم الخميس 24 يوليوز 2025، حكماً قضائياً ضد هشام جيراندو، المقيم بكندا، وذلك بعد دعوى قضائية رفعها ضده القاضي المغربي عبد الرحيم حنين. وقضت المحكمة بإدانة جيراندو بالسجن لمدة 30 يوماً، مع إلزامه بأداء 150 ساعة من الخدمة المجتمعية، ودفع غرامة مالية بلغت 10,000', 'size': 5}, {'id': '191', 'title': 'القضاء الكندي يقضي بالسجن النافذ في حق هشام جيراندو', 'source': 'rue20.com', 'link': 'https://rue20.com/923316.html', 'summary': 'القضاء الكندي يقضي بالسجن النافذ في حق هشام جيراندو. . الرباط أدانت المحكمة العليا بكيبيك، اليوم الخميس 24 يوليوز 2025، اليوتيوبر المغربي المقيم بكندا هشام جيراندو، بالسجن النافذ لمدة شهر مع إنجاز 150 ساعة من الخدمة المجتمعية، ودفع غرامة مالية قدرها 10,000 دولار كندي، وذلك في إطار دعوى رفعها القاضي المغربي عبد الرحيم حنين أما المحاكم الكندية، بعد تعرضه للتشهير من قبل المعني بالأمر. وكان الخبر القضاء الكندي يقضي بالسجن النافذ في حق هشام جيراندو  .', 'size': 5}, {'id': '225', 'title': 'عاجل.. القضاء الكندي يحكم على جيراندو بالحبس النافذ و150 ساعة من الخدمة و10 آلاف دولار غرامة', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/225153/', 'summary': 'عاجل.. القضاء الكندي يحكم على جيراندو بالحبس النافذ و150 ساعة من الخدمة و10 آلاف دولار غرامة. أدانت المحكمة العليا بكيبيك، اليوم الخميس 24 يوليوز 2025، اليوتيوبر المغربي المقيم بكندا هشام جيراندو، بالسجن النافذ لمدة شهر مع إنجاز 150 ساعة من الخدمة المجتمعية، ودفع غرامة مالية قدرها 10,000 دولار كندي، وذلك في إطار دعوى رفعها القاضي المغربي عبد الرحيم حنين أما المحاكم الكندية، بعد تعرضه للتشهير من قبل المعني بالأمر. وكان هشام جيراندو،', 'size': 5}, {'id': '244', 'title': 'القضاء الكندي يقضي بالسجن النافذ في حق هشام جيراندو ويلزمه بخدمة الشأن العام عوض مهنته الأصلية “كنادل مقهى”', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d9%84%d9%82%d8%b6%d8%a7%d8%a1-%d8%a7%d9%84%d9%83%d9%86%d8%af%d9%8a-%d9%8a%d9%82%d8%b6%d9%8a-%d8%a8%d8%a7%d9%84%d8%b3%d8%ac%d9%86-%d8%a7%d9%84%d9%86%d8%a7%d9%81%d8%b0-%d9%81%d9%8a-%d8%ad%d9%82/', 'summary': 'القضاء الكندي يقضي بالسجن النافذ في حق هشام جيراندو ويلزمه بخدمة الشأن العام عوض مهنته الأصلية “كنادل مقهى”. أدانت المحكمة العليا بكيبيك، اليوم الخميس 24 يوليوز 2025، اليوتيوبر المغربي المقيم بكندا هشام جيراندو، بالسجن النافذ لمدة شهر مع إنجاز 150 ساعة من الخدمة المجتمعية، ودفع غرامة مالية قدرها 10,000 دولار كندي، وذلك في إطار دعوى رفعها القاضي المغربي عبد الرحيم حنين أمام المحاكم الكندية، بعد تعرضه للتشهير من قبل المعني بالأمر. وكان هشام جيراندو، …  القضاء الكندي يقضي بالسجن النافذ في حق هشام جيراندو ويلزمه بخدمة الشأن العام عوض مهنته الأصلية “كنادل مقهى”     .', 'size': 5}], 'main_title': 'صياد النعامة يلقاها يلقاها.. حكم جديد ضد جيراندو في كندا'}, {'community_id': '5', 'articles': [{'id': '142', 'title': 'الدار البيضاء.. تدخل أمني ينهي نزاعا بين مهاجرين أفارقة ويُسفر عن توقيفات', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/319235/', 'summary': 'الدار البيضاء.. تدخل أمني ينهي نزاعا بين مهاجرين أفارقة ويُسفر عن توقيفات. أسفرت العمليات الأمنية التي باشرتها عناصر الشرطة بمنطقة أمن الحي الحسني بمدينة الدار البيضاء، مساء أمس الأربعاء 23 يوليوز الجاري، عن توقيف مواطنيين ينحدران من دول إفريقيا جنوب الصحراء، وذلك للاشتباه في تورطهما في قضية تتعلق بتبادل الضرب والجرح المقرون بالسرقة. وكانت مصالح الأمن الوطني قد توصلت بإشعار حول تعرض المشاركين في حفل يقيمه مواطنون', 'size': 2}, {'id': '167', 'title': 'توقيف مهاجرين من إفريقيا جنوب الصحراء إثر اشتباك عنيف وسرقات في “الألفة”', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1088048.html', 'summary': 'توقيف مهاجرين من إفريقيا جنوب الصحراء إثر اشتباك عنيف وسرقات في “الألفة”. تمكنت عناصر الشرطة التابعة لمنطقة أمن الحي الحسني بمدينة الدار البيضاء، مساء الأربعاء 23 يوليوز الجاري، من توقيف مواطنين ينحدران من دول إفريقيا جنوب الصحراء، وذلك للاشتباه في تورطهما في أحداث عنف خطيرة مقرونة بأعمال سرقة، وقعت خلال حفل خاص بمنطقة “الألفة”. وحسب المعطيات الأولية المتوفرة، فقد باشرت مصالح الأمن الوطني تدخلها عقب تلقيها إشعارا ظهرت المقالة توقيف مهاجرين من إفريقيا جنوب الصحراء إثر اشتباك عنيف وسرقات في “الألفة”  .', 'size': 2}], 'main_title': 'الدار البيضاء.. تدخل أمني ينهي نزاعا بين مهاجرين أفارقة ويُسفر عن توقيفات'}, {'community_id': '4', 'articles': [{'id': '304', 'title': 'ظهور فاعلين جدد ورقم المعاملات يتراجع.. مجلس المنافسة يصدر تقريرا جديدا عن سوق الغازوال والبنزين بالمغرب', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/economy/409889.html', 'summary': 'ظهور فاعلين جدد ورقم المعاملات يتراجع.. مجلس المنافسة يصدر تقريرا جديدا عن سوق الغازوال والبنزين بالمغرب. أفاد مجلس المنافسة بأن رقم معاملات شركات التوزيع بالجملة للغازوال والبنزين التسع بلغت 77,3 مليار درهم خلال سنة 2024، مسجلا انخفاضا بنسبة 3 في المائة', 'size': 2}, {'id': '350', 'title': '32 شركة تتقاسم سوق استيراد المحروقات بالمغرب.. وشركات التوزيع تستحوذ على 82% من الواردات', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1088109.html', 'summary': '32 شركة تتقاسم سوق استيراد المحروقات بالمغرب.. وشركات التوزيع تستحوذ على 82% من الواردات. كشف مجلس المنافسة بأن الواردات الإجمالية من الغازوال والبنزين بلغت 1,62 مليون طن، بقيمة 12 مليار درهم برسم الفصل الأول من سنة 2025، مسجلة تغيرات بلغت على التوالي نسبة 10 في المائة وناقص 6,9 في المائة مقارنة مع الفترة نفسها من سنة 2024. وأوضح تقرير لمجلس المنافسة حول الفصل الأول من سنة 2025 وتحليله لمؤشرات ظهرت المقالة 32 شركة تتقاسم سوق استيراد المحروقات بالمغرب.. وشركات التوزيع تستحوذ على 82% من الواردات  .', 'size': 3}, {'id': '358', 'title': 'خلال الفصل الأول من 2025.. واردات الغازوال والبنزين تصل إلى 1,62 مليون طن', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%ae%d9%84%d8%a7%d9%84-%d8%a7%d9%84%d9%81%d8%b5%d9%84-%d8%a7%d9%84%d8%a3%d9%88%d9%84-%d9%85%d9%86-2025-%d9%88%d8%a7%d8%b1%d8%af%d8%a7%d8%aa-%d8%a7%d9%84%d8%ba%d8%a7%d8%b2%d9%88%d8%a7%d9%84-%d9%88/', 'summary': 'خلال الفصل الأول من 2025.. واردات الغازوال والبنزين تصل إلى 1,62 مليون طن. أفاد مجلس المنافسة أن الواردات الإجمالية من الغازوال والبنزين بلغت 1,62 مليون طن، بقيمة 12 مليار درهم برسم الفصل الأول من سنة 2025، مسجلة تغيرات بلغت، على التوالي، نسبة 10 في المائة وناقص 6,9 في المائة مقارنة بالفترة نفسها من سنة 2024. وأوضح تقرير لمجلس المنافسة حول الفصل الأول من سنة 2025 وتحليله لمؤشرات الأداء  خلال الفصل الأول من 2025.. واردات الغازوال والبنزين تصل إلى 1,62 مليون طن     .', 'size': 2}], 'main_title': '32 شركة تتقاسم سوق استيراد المحروقات بالمغرب.. وشركات التوزيع تستحوذ على 82% من الواردات'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    