<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 13/10/2025 - 12h24</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '26', 'title': 'الطقس غدا الإثنين.. ضباب محلي وأجواء غائمة على السواحل الشمالية والوسطى', 'source': 'ar.hibapress.com', 'link': 'https://ar.hibapress.com/details-665434.html', 'summary': 'الطقس غدا الإثنين.. ضباب محلي وأجواء غائمة على السواحل الشمالية والوسطى. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليوم غد الاثنين، تشكل كتل ضبابية محليا على السواحل الشمالية والوسطى خلال الصباح والليل. كما يرتقب أن تكون السماء غائمة بالواجهة المتوسطية وشمال غرب الأقاليم الصحراوية للمملكة، مع نزول قطرات مطرية جد خفيفة. وستتراوح درجات الحرارة الدنيا، ما بين 08 و 14 درجة بمرتفعات الأطلس، وما بين 14 و', 'size': 4}, {'id': '67', 'title': 'توقعات أحوال الطقس غدا الاثنين', 'source': 'www.alahdat.net', 'link': 'https://www.alahdat.net/archives/207314', 'summary': 'توقعات أحوال الطقس غدا الاثنين.  تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليوم غد الاثنين، تشكل كتل ضبابية محليا على السواحل الشمالية والوسطى خلال الصباح والليل. كما يرتقب أن تكون السماء غائمة بالواجهة المتوسطية وشمال غرب الأقاليم الصحراوية للمملكة، مع نزول قطرات مطرية جد خفيفة. وستتراوح درجات الحرارة الدنيا، ما بين 08 و 14 درجة بمرتفعات الأطلس، ومابين 14', 'size': 4}, {'id': '158', 'title': 'طقس الإثنين.. قطرات مطرية مرتقبة بهذه المناطق', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-593550.html', 'summary': 'طقس الإثنين.. قطرات مطرية مرتقبة بهذه المناطق. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليوم الاثنين، تشكل كتل ضبابية محليا على السواحل الشمالية والوسطى خلال الصباح والليل. كما يرتقب أن تكون السماء غائمة بالواجهة المتوسطية وشمال غرب الأقاليم الصحراوية للمملكة، مع نزول قطرات مطرية جد خفيفة. وستتراوح درجات الحرارة الدنيا، ما بين 08 و 14 درجة بمرتفعات الأطلس، وما بين 14', 'size': 4}, {'id': '410', 'title': 'توقعات أحوال الطقس اليوم الإثنين', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d8%a7%d9%84%d9%8a%d9%88%d9%85-%d8%a7%d9%84%d8%a5%d8%ab%d9%86%d9%8a%d9%86-9/', 'summary': 'توقعات أحوال الطقس اليوم الإثنين. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة لليوم الاثنين 13 أكتوبر 2025، تشكل كتل ضبابية محليا على السواحل الشمالية والوسطى خلال الصباح والليل. كما يرتقب أن تكون السماء غائمة بالواجهة المتوسطية وشمال غرب الأقاليم الصحراوية للمملكة، مع نزول قطرات مطرية جد خفيفة. وستتراوح درجات الحرارة الدنيا، ما بين 08 و 14 درجة بمرتفعات الأطلس، …  توقعات أحوال الطقس اليوم الإثنين     .', 'size': 4}], 'main_title': 'الطقس غدا الإثنين.. ضباب محلي وأجواء غائمة على السواحل الشمالية والوسطى'}, {'community_id': '3', 'articles': [{'id': '28', 'title': 'واقعة صادمة بشاطئ سبتة.. أم تخاطر بحياة ابنها الصغير في محاولة للعبور سباحة نحو الضفة الأخرى', 'source': 'ar.hibapress.com', 'link': 'https://ar.hibapress.com/details-665426.html', 'summary': 'واقعة صادمة بشاطئ سبتة.. أم تخاطر بحياة ابنها الصغير في محاولة للعبور سباحة نحو الضفة الأخرى. شهد شاطئ مدينة سبتة المحتلة، اليوم، حادثًا مؤثرًا بعدما أقدمت سيدة رفقة ابنها البالغ من العمر 6 سنوات على محاولة العبور سباحة من سواحل الفنيدق في اتجاه سبتة المحتلة. وحسب شهود عيان، فقد شوهدت الأم وهي تمسك بطفلها الصغير فوق “كمّارة” بلاستيكية، في محاولة يائسة لتجاوز الأمواج العاتية. المشهد كان مؤلمًا وصادمًا، حيث كاد الاثنان', 'size': 2}, {'id': '203', 'title': 'أم ترمي بنفسها في البحر رفقة طفلها في محاولة للهجرة سباحة نحو سبتة', 'source': 'rue20.com', 'link': 'https://rue20.com/944447.html', 'summary': 'أم ترمي بنفسها في البحر رفقة طفلها في محاولة للهجرة سباحة نحو سبتة.  . متابعة في مشهد مأساوي يُجسّد أقسى درجات اليأس والبحث عن فرصة لحياة أفضل، أقدمت أمّ مغربية على مغامرة خطيرة برفقة طفلها القاصر، محاوِلة العبور سباحة من شاطئ مدينة الفنيدق نحو مدينة سبتة المحتلة. وبحسب مصادر إعلامية محلية، فقد رصد عناصر الحرس المدني الإسباني السيدة وهي تُصارع الأمواج العاتية رفقة طفل لا يتجاوز الخبر أم ترمي بنفسها في البحر رفقة طفلها في محاولة للهجرة سباحة نحو سبتة  .', 'size': 2}], 'main_title': 'واقعة صادمة بشاطئ سبتة.. أم تخاطر بحياة ابنها الصغير في محاولة للعبور سباحة نحو الضفة الأخرى'}, {'community_id': '2', 'articles': [{'id': '29', 'title': 'النقابة الوطنية للصحافة المغربية تثمن توجيهات الملك حول الإعلام والمسؤولية المشتركة', 'source': 'ar.hibapress.com', 'link': 'https://ar.hibapress.com/details-665424.html', 'summary': 'النقابة الوطنية للصحافة المغربية تثمن توجيهات الملك حول الإعلام والمسؤولية المشتركة. تابعت النقابة الوطنية للصحافة المغربية باهتمام بالغ الخطاب الملكي السامي بمناسبة افتتاح السنة التشريعية الجديدة، والذي جاء في ظرف سياسي واجتماعي دقيق، حاملاً توجيهات واضحة بشأن دور الإعلام في تعزيز الثقة بين الدولة والمجتمع، وتحصين الاختيار الديمقراطي، وتقوية جسور التواصل بين المؤسسات والمواطن، لا سيما فيما يتعلق بحقوقه وحرياته، في إطار المسؤولية المشتركة. وأكد الخطاب', 'size': 2}, {'id': '241', 'title': 'النقابة الوطنية للصحافة المغربية: خطاب الملك بالبرلمان تضمن دعوة صريحة لتعزيز الثقة في الجسم الصحافي الوطني', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/228373/', 'summary': 'النقابة الوطنية للصحافة المغربية: خطاب الملك بالبرلمان تضمن دعوة صريحة لتعزيز الثقة في الجسم الصحافي الوطني. عبّرت النقابة الوطنية للصحافة المغربية عن إشادتها الكبيرة بالمضامين العميقة التي حملها الخطاب الملكي السامي الذي ألقاه جلالة الملك محمد السادس، يوم الجمعة، بمناسبة افتتاح السنة التشريعية الجديدة، معتبرة أن الخطاب جاء في ظرف سياسي واجتماعي دقيق، ووجّه رسائل قوية حول المسؤولية المشتركة في بناء الثقة بين الدولة والمجتمع، وتعزيز أدوار الإعلام الوطني كجسر', 'size': 2}], 'main_title': 'النقابة الوطنية للصحافة المغربية تثمن توجيهات الملك حول الإعلام والمسؤولية المشتركة'}, {'community_id': '1', 'articles': [{'id': '66', 'title': 'منتخب المغرب يفوز على أمريكا 3-1 وتأهل لنصف نهائي كأس العالم للشباب', 'source': 'www.alahdat.net', 'link': 'https://www.alahdat.net/archives/207318', 'summary': 'منتخب المغرب يفوز على أمريكا 3-1 وتأهل لنصف نهائي كأس العالم للشباب.  تأهل المنتخب الوطني المغرب لأقل من 20 سنة إلى نصف نهائي كأس العالم لهذه الفئة الجارية أطوارها في الشيلي عقب تفوقه على نظيره الامريكي بثلاثة أهداف لواحد في المباراة التي جمعتهما مساء اليوم الأحد على أرضية ملعب “إل تينيينتي” بمدينة رانكاغوا، (87 كلم جنوب سانتياغو ) برسم ربع نهائي منافسات كأس العالم لأقل من', 'size': 2}, {'id': '159', 'title': 'المنتخب المغربي يهزم أمريكا ويتأهل إلى المربع الذهبي للمونديال', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-593559.html', 'summary': 'المنتخب المغربي يهزم أمريكا ويتأهل إلى المربع الذهبي للمونديال. تأهل المنتخب الوطني المغرب لأقل من 20 سنة إلى نصف نهائي كأس العالم المقام في الشيلي، وذلك عقب فوزه على نظيره الامريكي بثلاثة أهداف لواحد في المباراة التي جمعتهما مساء اليوم الأحد على أرضية ملعب “إل تينيينتي” بمدينة رانكاغوا لحساب ربع نهائي منافسات “المونديال”. وكان المنتخب المغربي سباقا للتسجيل بواسطة الظهير الايسر', 'size': 2}], 'main_title': 'منتخب المغرب يفوز على أمريكا 3-1 وتأهل لنصف نهائي كأس العالم للشباب'}, {'community_id': '5', 'articles': [{'id': '91', 'title': 'نهاية حكم "حماس" في قطاع غزة', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/world/414360.html', 'summary': 'نهاية حكم "حماس" في قطاع غزة. أفاد مصدر في حركة المقاومة الإسلامية (حماس) مقرب من الوفد المفاوض، اليوم الأحد لوكالة فرانس برس، أن الحركة لن تشارك في حكم غزة خلال المرحلة', 'size': 2}, {'id': '234', 'title': 'حماس لن تشارك في حكم غزة خلال المرحلة الانتقالية', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d8%ad%d9%85%d8%a7%d8%b3-%d9%84%d9%86-%d8%aa%d8%b4%d8%a7%d8%b1%d9%83-%d9%81%d9%8a-%d8%ad%d9%83%d9%85-%d8%ba%d8%b2%d8%a9-%d8%ae%d9%84%d8%a7%d9%84-%d8%a7%d9%84%d9%85%d8%b1%d8%ad%d9%84%d8%a9-%d8%a7%d9%84/', 'summary': 'حماس لن تشارك في حكم غزة خلال المرحلة الانتقالية. حماس تتخلى عن حكم غزة  – متابعات أفاد مصدر في حركة المقاومة الإسلامية (حماس) مقرب من الوفد المفاوض، اليوم الأحد لوكالة فرانس برس، أن الحركة لن تشارك في...  حماس لن تشارك في حكم غزة خلال المرحلة الانتقالية     .', 'size': 2}], 'main_title': 'نهاية حكم "حماس" في قطاع غزة'}, {'community_id': '7', 'articles': [{'id': '145', 'title': 'كأس العالم.. أشبال الأطلس يكتبون التاريخ من جديد', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/326061/', 'summary': 'كأس العالم.. أشبال الأطلس يكتبون التاريخ من جديد. في إنجاز جديد يكرّس الحضور القوي لكرة القدم المغربية على الساحة العالمية، نجح المنتخب الوطني المغربي لأقل من 20 سنة في حجز بطاقة العبور إلى نصف نهائي كأس العالم للشباب المقامة بدولة الشيلي، بعد فوز مستحق ومقنع على نظيره الأمريكي بثلاثة أهداف مقابل هدف واحد، في المباراة التي جمعت بينهما اليوم الأحد على أرضية ملعب', 'size': 2}, {'id': '371', 'title': 'كأس العالم للشباب 2025.. المغرب يتعرف على خصمه في نصف النهائي', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d9%83%d8%a3%d8%b3-%d8%a7%d9%84%d8%b9%d8%a7%d9%84%d9%85-%d9%84%d9%84%d8%b4%d8%a8%d8%a7%d8%a8-2025-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8-%d9%8a%d8%aa%d8%b9%d8%b1%d9%81-%d8%b9%d9%84%d9%89-%d8%ae%d8%b5/', 'summary': 'كأس العالم للشباب 2025.. المغرب يتعرف على خصمه في نصف النهائي. تعرف المنتخب الوطني المغربي لأقل من 20 سنة رسميا على خصمه في الدور نصف النهائي من مسابقة كأس العالم "الشيلي 2025". وسيواجه أشبال الأطلس المنتخب الفرنسي، بعد غد الأربعاء، انطلاقا من الساعة التاسعة مساء بتوقيت المغرب، في مباراة قوية تعد بالكثير من الإثارة. وكان المنتخب الوطني قد ضمن تأهله إلى المربع الذهبي بعد فوزه المستحق  كأس العالم للشباب 2025.. المغرب يتعرف على خصمه في نصف النهائي     .', 'size': 2}], 'main_title': 'كأس العالم.. أشبال الأطلس يكتبون التاريخ من جديد'}, {'community_id': '4', 'articles': [{'id': '217', 'title': 'انطلاق نظام الدخول والخروج الإلكتروني تدريجيا في منطقة شنغن', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d8%a7%d9%86%d8%b7%d9%84%d8%a7%d9%82-%d9%86%d8%b8%d8%a7%d9%85-%d8%a7%d9%84%d8%af%d8%ae%d9%88%d9%84-%d9%88%d8%a7%d9%84%d8%ae%d8%b1%d9%88%d8%ac-%d8%a7%d9%84%d8%a5%d9%84%d9%83%d8%aa%d8%b1%d9%88%d9%86/', 'summary': 'انطلاق نظام الدخول والخروج الإلكتروني تدريجيا في منطقة شنغن. أعلن الاتحاد الأوروبي، دخول نظام الدخول والخروج الإلكتروني إلى منطقة شنغن، حيز التنفيذ اعتبارا من اليوم الأحد. وذكر بيان صادر عن المفوضية الأوروبية أن النظام  انطلاق نظام الدخول والخروج الإلكتروني تدريجيا في منطقة شنغن     .', 'size': 2}, {'id': '321', 'title': 'رقمنة إدارة الحدود.. تطبيق نظام الدخول والخروج الإلكتروني تدريجيا في منطقة “شنغن”', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%b1%d9%82%d9%85%d9%86%d8%a9-%d8%a5%d8%af%d8%a7%d8%b1%d8%a9-%d8%a7%d9%84%d8%ad%d8%af%d9%88%d8%af-%d8%aa%d8%b7%d8%a8%d9%8a%d9%82-%d9%86%d8%b8%d8%a7%d9%85-%d8%a7%d9%84%d8%af%d8%ae%d9%88%d9%84-%d9%88/', 'summary': 'رقمنة إدارة الحدود.. تطبيق نظام الدخول والخروج الإلكتروني تدريجيا في منطقة “شنغن”. أعلن الاتحاد الأوروبي، دخول نظام الدخول والخروج الإلكتروني إلى منطقة شنغن، حيز التنفيذ اعتبارا، من أمس الأحد (12 أكتوبر). وذكر بيان صادر عن المفوضية الأوروبية أن النظام الجديد (EES) يهدف إلى رقمنة إدارة الحدود على أن يطبق تدريجيا في 29 بلدا. كما يهدف النظام، بحسب البيان، إلى زيادة فعالية وكفاءة الضوابط على الحدود الخارجية للاتحاد', 'size': 2}], 'main_title': 'انطلاق نظام الدخول والخروج الإلكتروني تدريجيا في منطقة شنغن'}, {'community_id': '6', 'articles': [{'id': '245', 'title': 'مونديال الشيلي: العناد المغربي يتفوق على الانضباط الأمريكي.. وموعد مع فرنسا في نصف النهائي', 'source': 'almassaa.com', 'link': 'https://almassaa.com/%d9%85%d9%88%d9%86%d8%af%d9%8a%d8%a7%d9%84-%d8%a7%d9%84%d8%b4%d9%8a%d9%84%d9%8a-%d8%a7%d9%84%d8%b9%d9%86%d8%a7%d8%af-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8%d9%8a-%d9%8a%d8%aa%d9%81%d9%88%d9%82-%d8%b9/', 'summary': 'مونديال الشيلي: العناد المغربي يتفوق على الانضباط الأمريكي.. وموعد مع فرنسا في نصف النهائي. المساء اليوم – و م ع: تأهل المنتخب الوطني المغربي لأقل من 20 سنة إلى نصف نهائي كأس العالم لهذه الفئة الجارية أطوارها في الشيلي، عقب تفوقه البين على نظيره الامريكي بثلاثة أهداف لواحد في', 'size': 2}, {'id': '390', 'title': 'مونديال أقل من 20 سنة.. المغرب يواجه فرنسا في نصف النهائي', 'source': 'machahid24.com', 'link': 'https://machahid24.com/sport/478328.html', 'summary': 'مونديال أقل من 20 سنة.. المغرب يواجه فرنسا في نصف النهائي. عرف المنتخب الوطني المغربي لأقل من 20 سنة على منافسه في الدور نصف النهائي من منافسات كأس العالم التي تحتضنها الشيلي، حيث سيواجه المنتخب الفرنسي يوم الأربعاء 15 أكتوبر 2025', 'size': 2}], 'main_title': 'مونديال الشيلي: العناد المغربي يتفوق على الانضباط الأمريكي.. وموعد مع فرنسا في نصف النهائي'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    