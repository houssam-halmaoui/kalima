<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 13/09/2025 - 06h14</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '82', 'title': 'الحموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/national/412605.html', 'summary': 'الحموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي. استقبل المدير العام للأمن الوطني ولمراقبة التراب الوطني عبد اللطيف حموشي, أمس الخميس بالرباط، المديرة العامة للأمن الداخلي الفرنسي السيدة سيلين بيرتون، التي كانت مرفوقة', 'size': 4}, {'id': '196', 'title': 'حموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي', 'source': 'howiyapress.com', 'link': 'https://howiyapress.com/%d8%ad%d9%85%d9%88%d8%b4%d9%8a-%d9%8a%d8%aa%d8%a8%d8%a7%d8%ad%d8%ab-%d8%a8%d8%a7%d9%84%d8%b1%d8%a8%d8%a7%d8%b7-%d9%85%d8%b9-%d8%a7%d9%84%d9%85%d8%af%d9%8a%d8%b1%d8%a9-%d8%a7%d9%84%d8%b9%d8%a7%d9%85/', 'summary': 'حموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي. استقبل المدير العام للأمن الوطني ولمراقبة التراب الوطني عبد اللطيف حموشي، أمس الخميس بالرباط، المديرة العامة للأمن الداخلي الفرنسي سيلين  حموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي     .', 'size': 2}, {'id': '207', 'title': 'السيد الحموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226923/', 'summary': 'السيد الحموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي. استقبل المدير العام للأمن الوطني ولمراقبة التراب الوطني عبد اللطيف حموشي, أمس الخميس بالرباط، المديرة العامة للأمن الداخلي الفرنسي السيدة سيلين بيرتون، التي كانت مرفوقة بوفد أمني رفيع المستوى. وذكر بلاغ للمديرية العامة لمراقبة التراب الوطني أن المباجثات بين السيد حموشي ونظيرته الفرنسية انصبت حول سبل تطوير آليات التعاون الثنائي في المجال الأمني، فضلا', 'size': 3}, {'id': '213', 'title': 'تطوير التعاون الأمني في مباحثات عبد اللطيف حموشي والمديرة العامة للأمن بفرنسا', 'source': 'almassaa.com', 'link': 'https://almassaa.com/113971-2/', 'summary': 'تطوير التعاون الأمني في مباحثات عبد اللطيف حموشي والمديرة العامة للأمن بفرنسا. المساء اليوم – الرباط: استقبل المدير العام للأمن الوطني ولمراقبة التراب الوطني عبد اللطيف حموشي, أمس الخميس بالرباط، المديرة العامة للأمن الداخلي الفرنسي سيلين بيرتون، التي كانت مرفوقة بوفد أمني رفيع المستوى. وذكر بيان للمديرية', 'size': 3}], 'main_title': 'الحموشي يتباحث بالرباط مع المديرة العامة للأمن الداخلي الفرنسي'}, {'community_id': '1', 'articles': [{'id': '89', 'title': 'إدارة سجن عين السبع تكذب مزاعم نقل السجين عبد النبي بعيوي إثر أزمة صحية', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/412612.html', 'summary': 'إدارة سجن عين السبع تكذب مزاعم نقل السجين عبد النبي بعيوي إثر أزمة صحية. ردا على الأخبار المتداولة التي تدعي نقل السجين (ع.ب)، المعتقل احتياطيا بالسجن المحلي عين السبع 1، إلى المستشفى "بعد تعرضه لأزمة صحية حادة"، خرجت إدارة', 'size': 2}, {'id': '208', 'title': 'إدارة سجن عكاشة: إخراج السجين بعيوي إلى المستشفى لا علاقة له بالتعرض لأية وعكة صحية', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226921/', 'summary': 'إدارة سجن عكاشة: إخراج السجين بعيوي إلى المستشفى لا علاقة له بالتعرض لأية وعكة صحية. ردا على الأخبار المتداولة التي تدعي نقل السجين (عبد النبي بعيوي)، المعتقل احتياطيا بالسجن المحلي عين السبع 1، إلى المستشفى “بعد تعرضه لأزمة صحية حادة”، تتقدم إدارة هذه المؤسسة إلى الرأي العام بالتوضيحات التالية: – إن إخراج السجين المذكور إلى المستشفى تم بناء على موعد مسبق وفي إطار تتبع حالته الصحية، ولا علاقة لذلك بتعرضه', 'size': 2}], 'main_title': 'إدارة سجن عين السبع تكذب مزاعم نقل السجين عبد النبي بعيوي إثر أزمة صحية'}, {'community_id': '2', 'articles': [{'id': '135', 'title': '“الكاف” يعلن موعد انطلاق بيع تذاكر كأس أمم إفريقيا “المغرب 2025”', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1099256.html', 'summary': '“الكاف” يعلن موعد انطلاق بيع تذاكر كأس أمم إفريقيا “المغرب 2025”. أعلن الاتحاد الإفريقي لكرة القدم عن انطلاق عملية التسجيل لاقتناء تذاكر كأس أمم إفريقيا المقرر انطلاقها نهاية العام الجاري بالمملكة. وأوضح الاتحاد الإفريقي أن المرحلة الأولى من طرح التذاكر ستنطلق يوم 25 شتنبر 2025، بينما ستبدأ المرحلة الثانية يوم 21 أكتوبر 2025، على أن تُطرح المرحلة الثالثة يوم 21 نونبر 2025، ما يمنح الجمهور فترة ظهرت المقالة “الكاف” يعلن موعد انطلاق بيع تذاكر كأس أمم إفريقيا “المغرب 2025”  .', 'size': 2}, {'id': '156', 'title': '"الكاف" تعلن الموعد الرسمي لانطلاق عملية بيع تذاكر "كان" المغرب', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d9%83%d8%a7%d9%81-%d8%aa%d8%b9%d9%84%d9%86-%d8%a7%d9%84%d9%85%d9%88%d8%b9%d8%af-%d8%a7%d9%84%d8%b1%d8%b3%d9%85%d9%8a-%d9%84%d8%a7%d9%86%d8%b7%d9%84%d8%a7%d9%82-%d8%b9%d9%85%d9%84/', 'summary': '"الكاف" تعلن الموعد الرسمي لانطلاق عملية بيع تذاكر "كان" المغرب. أعلنت الكونفدرالية الإفريقية لكرة القدم، اليوم الجمعة، عن الموعد الرسمي لانطلاق عملية بيع تذاكر نهائيات كأس أمم إفريقيا "المغرب 2025". وحسب بلاغ رسمي للجهاز الكروي، فإن عملية بيع التذاكر ستنطلق عبر مراحل أولاها ستكون يوم 25 شتنبر الجاري. المرحلة الأولى كما أوضح المصدر ذاته، ستكون يومي 25 و26 شتنبر، حصريا للجماهير التي تتوفر على بطاقة  "الكاف" تعلن الموعد الرسمي لانطلاق عملية بيع تذاكر "كان" المغرب     .', 'size': 2}], 'main_title': '“الكاف” يعلن موعد انطلاق بيع تذاكر كأس أمم إفريقيا “المغرب 2025”'}, {'community_id': '3', 'articles': [{'id': '145', 'title': 'المغرب يوقع مذكرة تفاهم مع Mistral AI لتعزيز التحول الرقمي والذكاء الاصطناعي (فيديو)', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1099198.html', 'summary': 'المغرب يوقع مذكرة تفاهم مع Mitral AI لتعزيز التحول الرقمي والذكاء الاصطناعي (فيديو). وقعت أمل الفلاح السغروشني، الوزيرة المنتدبة المكلفة بالانتقال الرقمي وإصلاح الإدارة، اليوم الجمعة 12 شتنبر 2025 بالرباط، مذكرة تفاهم استراتيجية مع شركة Mitral AI، الرائدة الأوروبية في مجال الذكاء الاصطناعي. \ufeff ووفقا لبلاغ صحفي للوزارة المنتدبة المكلفة بالانتقال الرقمي وإصلاح الإدراة، فإن هذه الشراكة تأتي لتجسيد الرؤية الملكية الطموحة للمغرب في تبني الذكاء الاصطناعي كقاطرة ظهرت المقالة المغرب يوقع مذكرة تفاهم مع Mitral AI لتعزيز التحول الرقمي والذكاء الاصطناعي (فيديو)  .', 'size': 2}, {'id': '223', 'title': 'الوزيرة السغروشني: مشروع التعاون مع الشركة العالمية “Mistral AI” يجسد توصيات المناظرة الوطنية الأولى للذكاء الاصطناعي', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d9%84%d9%88%d8%b2%d9%8a%d8%b1%d8%a9-%d8%a7%d9%84%d8%b3%d8%ba%d8%b1%d9%88%d8%b4%d9%86%d9%8a-%d9%85%d8%b4%d8%b1%d9%88%d8%b9-%d8%a7%d9%84%d8%aa%d8%b9%d8%a7%d9%88%d9%86-%d9%85%d8%b9-%d8%a7%d9%84/', 'summary': 'الوزيرة السغروشني: مشروع التعاون مع الشركة العالمية “Mitral AI” يجسد توصيات المناظرة الوطنية الأولى للذكاء الاصطناعي. أكدت الوزيرة المنتدبة المكلفة بالانتقال الرقمي وإصلاح الإدارة، أمل الفلاح السغروشني، اليوم الجمعة 12 شتنبر 2025 بالرباط، على هامش لقاء رفيع المستوى حول آفاق وتحديات الذكاء الاصطناعي، أن المغرب يواصل تعزيز قدراته الرقمية من خلال شراكات استراتيجية مع شركات عالمية متخصصة في الذكاء الاصطناعي. وفي هذا السياق، أوضحت الوزيرة في تصريح لموقع “” …  الوزيرة السغروشني: مشروع التعاون مع الشركة العالمية “Mitral AI” يجسد توصيات المناظرة الوطنية الأولى للذكاء الاصطناعي     .', 'size': 2}], 'main_title': 'المغرب يوقع مذكرة تفاهم مع Mistral AI لتعزيز التحول الرقمي والذكاء الاصطناعي (فيديو)'}, {'community_id': '4', 'articles': [{'id': '317', 'title': 'النسخة الأكثر ترابطا في تاريخ البطولة.. انطلاق العد التنازلي لـ100 يوم على بدء “كان 2025”', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d9%86%d8%b3%d8%ae%d8%a9-%d8%a7%d9%84%d8%a3%d9%83%d8%ab%d8%b1-%d8%aa%d8%b1%d8%a7%d8%a8%d8%b7%d8%a7-%d9%81%d9%8a-%d8%aa%d8%a7%d8%b1%d9%8a%d8%ae-%d8%a7%d9%84%d8%a8%d8%b7%d9%88%d9%84%d8%a9/', 'summary': 'النسخة الأكثر ترابطا في تاريخ البطولة.. انطلاق العد التنازلي لـ100 يوم على بدء “كان 2025”. أكد الاتحاد الإفريقي لكرة القدم (كاف) ولجنة التنظيم المحلية، اليوم الجمعة (12 شتنبر)، بمناسبة انطلاق العد التنازلي لـ100 يوم على بدء منافسات كأس إفريقيا للأمم لكرة القدم (المغرب 2025)، أن هذه الدورة ستكون النسخة الأكثر ترابطا في تاريخ البطولة، بفضل إطلاق تطبيق يروم تحسين تجربة المشجعين. وأبرزت الهيئتان، في بيان نشره الاتحاد الإفريقي لكرة القدم', 'size': 3}, {'id': '377', 'title': 'الكشف عن موعد انطلاق بيع تذاكر كأس إفريقيا “المغرب 2025”', 'source': 'machahid24.com', 'link': 'https://machahid24.com/sport/475193.html', 'summary': 'الكشف عن موعد انطلاق بيع تذاكر كأس إفريقيا “المغرب 2025”. أعلن الاتحاد الإفريقي لكرة القدم (كاف) ولجنة التنظيم المحلية، اليوم الجمعة، بمناسبة انطلاق العد التنازلي لـ100 يوم على بدء منافسات كأس إفريقيا للأمم لكرة القدم (المغرب 2025)، عن الشروع يوم 25 شتنبر الجاري في عملية بيع تذاكر مباريات البطولة، على أن تسبقها مرحلة التسجيل الأولي خلال الفترة ما بين 12 و24 شتنبر. وأكدت الهيئتان، في …', 'size': 3}, {'id': '401', 'title': 'الاتحاد الإفريقي لكرة القدم: “كان” المغرب النسخة الأكثر ترابطا في تاريخ المنافسات', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226955/', 'summary': 'الاتحاد الإفريقي لكرة القدم: “كان” المغرب النسخة الأكثر ترابطا في تاريخ المنافسات. و.م.ع/ أكد الاتحاد الإفريقي لكرة القدم (كاف) ولجنة التنظيم المحلية، اليوم الجمعة، بمناسبة انطلاق العد التنازلي لـ100 يوم على بدء منافسات كأس إفريقيا للأمم لكرة القدم (المغرب 2025)، أن هذه الدورة ستكون النسخة الأكثر ترابطا في تاريخ البطولة، بفضل إطلاق تطبيق يروم تحسين تجربة المشجعين. وأبرزت الهيئتان، في بيان نشره الاتحاد الإفريقي لكرة القدم على', 'size': 3}], 'main_title': 'النسخة الأكثر ترابطا في تاريخ البطولة.. انطلاق العد التنازلي لـ100 يوم على بدء “كان 2025”'}, {'community_id': '5', 'articles': [{'id': '334', 'title': 'الوداد يفتتح الموسم بانتصار صعب على الكوكب المراكشي', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/323220/', 'summary': 'الوداد يفتتح الموسم بانتصار صعب على الكوكب المراكشي. حقق الوداد الرياضي بداية موفقة في مشواره بالبطولة الوطنية الاحترافية لكرة القدم لموسم 2025/2026، بعدما تفوق على ضيفه الكوكب المراكشي بهدف دون رد، في المباراة التي جرت مساء اليوم على أرضية المركب الرياضي محمد الخامس بالدار البيضاء. وشهدت الدقائق الأولى من اللقاء حذرًا تكتيكيًا من الجانبين، قبل أن يكسر الكوكب المراكشي إيقاع المباراة بالحصول على', 'size': 2}, {'id': '346', 'title': 'الوداد يفتتح مشواره بالبطولة الاحترافية بانتصار ثمين على الكوكب المراكشي', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1099306.html', 'summary': 'الوداد يفتتح مشواره بالبطولة الاحترافية بانتصار ثمين على الكوكب المراكشي. نجح نادي الوداد الرياضي في تحقيق الانتصار في أول جولات البطولة الاحترافية، وذلك بعد الإطاحة بضيفه الكوكب المراكشي بهدف نظيف، خلال اللقاء الذي جرت أطواره على أرضية المركب الرياضي محمد الخامس بالدار البيضاء. ودخل نادي الكوكب المراكشي بحماس كبير، حيث خلق مجموعة من الفرص خلال الدقائق الأولى من الشوط الأول، ليتمكن من الحصول على ركلة ظهرت المقالة الوداد يفتتح مشواره بالبطولة الاحترافية بانتصار ثمين على الكوكب المراكشي  .', 'size': 2}], 'main_title': 'الوداد يفتتح الموسم بانتصار صعب على الكوكب المراكشي'}, {'community_id': '6', 'articles': [{'id': '349', 'title': 'المداخيل الجمركية تتجاوز 65 مليار درهم عند متم غشت الماضي', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1099271.html', 'summary': 'المداخيل الجمركية تتجاوز 65 مليار درهم عند متم غشت الماضي. المداخيل الجمركية تتجاوز 65 مليار درهم عند متم غشت الماضي ظهرت المقالة المداخيل الجمركية تتجاوز 65 مليار درهم عند متم غشت الماضي  .', 'size': 2}, {'id': '365', 'title': 'قفزة قياسية في المداخيل الجمركية: 65 مليار درهم حتى غشت بزيادة 8٪', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d9%82%d9%81%d8%b2%d8%a9-%d9%82%d9%8a%d8%a7%d8%b3%d9%8a%d8%a9-%d9%81%d9%8a-%d8%a7%d9%84%d9%85%d8%af%d8%a7%d8%ae%d9%8a%d9%84-%d8%a7%d9%84%d8%ac%d9%85%d8%b1%d9%83%d9%8a%d8%a9-65-%d9%85%d9%84%d9%8a/', 'summary': 'قفزة قياسية في المداخيل الجمركية: 65 مليار درهم حتى غشت بزيادة 8٪. أفادت الخزينة العامة للمملكة بأن المداخيل الجمركية الصافية تجاوزت 65 مليار درهم مع نهاية غشت 2025، مسجلة ارتفاعاً بنسبة 8,3٪ مقارنة بنفس الفترة من السنة الماضية. وذكرت الخزينة أن هذا المجموع يشمل الرسوم الجمركية وضريبة القيمة المضافة على الواردات والضريبة الداخلية على استهلاك المنتجات الطاقية، بعد احتساب المبالغ المستردة والإعفاءات البالغة 63 مليون درهم. وبلغ  قفزة قياسية في المداخيل الجمركية: 65 مليار درهم حتى غشت بزيادة 8٪     .', 'size': 2}], 'main_title': 'المداخيل الجمركية تتجاوز 65 مليار درهم عند متم غشت الماضي'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    