<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 26/06/2025 - 12h25</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '3', 'articles': [{'id': '165', 'title': 'الملف الشائك على طاولة مباحثات بين المغرب وفرنسا', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-577054.html', 'summary': 'الملف الشائك على طاولة مباحثات بين المغرب وفرنسا. المجموعة المشتركة الدائمة المغربية-الفرنسية حول الهجرة، اليوم الأربعاء بباريس، اجتماعها السابع في صيغته العامة، برئاسة مشتركة لكل من الوالي مدير الهجرة ومراقبة الحدود بوزارة الداخلية خالد الزروالي، ومدير الهجرة بوزارة الداخلية الفرنسية فريديريك جورام. وأوضح بلاغ مشترك لوزارتي الداخلية بالمغرب وفرنسا أن هذا اللقاء يأتي امتدادا للإعلان حول “الشراكة الاستثنائية الوطيدة”، الذي وقعه بتاريخ', 'size': 3}, {'id': '212', 'title': 'انعقاد الاجتماع السابع للمجموعة المشتركة الدائمة المغربية – الفرنسية حول الهجرة', 'source': 'machahid24.com', 'link': 'https://machahid24.com/politique/467548.html', 'summary': 'انعقاد الاجتماع السابع للمجموعة المشتركة الدائمة المغربية – الفرنسية حول الهجرة. عقدت المجموعة المشتركة الدائمة المغربية – الفرنسية حول الهجرة، اليوم الأربعاء بباريس، اجتماعها السابع في صيغته العامة، برئاسة مشتركة لكل من الوالي مدير الهجرة ومراقبة الحدود بوزارة الداخلية خالد الزروالي، ومدير الهجرة بوزارة الداخلية الفرنسية فريديريك جورام. وأوضح بلاغ مشترك لوزارتي الداخلية بالمغرب وفرنسا، أن هذا اللقاء يأتي امتدادا للإعلان حول “الشراكة الاستثنائية الوطيدة“، الذي …', 'size': 3}, {'id': '244', 'title': 'باريس .. انعقاد الاجتماع السابع للمجموعة المشتركة الدائمة المغربية – الفرنسية حول الهجرة', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/223449/', 'summary': 'باريس .. انعقاد الاجتماع السابع للمجموعة المشتركة الدائمة المغربية – الفرنسية حول الهجرة. عقدت المجموعة المشتركة الدائمة المغربية – الفرنسية حول الهجرة، اليوم الأربعاء بباريس، اجتماعها السابع في صيغته العامة، برئاسة مشتركة لكل من الوالي مدير الهجرة ومراقبة الحدود بوزارة الداخلية خالد الزروالي، ومدير الهجرة بوزارة الداخلية الفرنسية فريديريك جورام. وأوضح بلاغ مشترك لوزارتي الداخلية بالمغرب وفرنسا، أن هذا اللقاء يأتي امتدادا للإعلان حول “الشراكة الاستثنائية الوطيدة “،', 'size': 3}], 'main_title': 'الملف الشائك على طاولة مباحثات بين المغرب وفرنسا'}, {'community_id': '4', 'articles': [{'id': '208', 'title': 'توقيع إعلان نوايا بين المغرب وفرنسا لتعزيز التعاون في مجال الوقاية من العنف ضد النساء', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/467554.html', 'summary': 'توقيع إعلان نوايا بين المغرب وفرنسا لتعزيز التعاون في مجال الوقاية من العنف ضد النساء. متابعة وقع المغرب وفرنسا، اليوم الأربعاء بمراكش، إعلان نوايا يروم تعزيز التعاون الثنائي في مجال التكوين والوقاية من العنف ضد النساء. ويهم الإعلان الذي وقعته وزيرة التضامن والإدماج الاجتماعي والأسرة، نعيمة ابن يحيى، والوزيرة الفرنسية المنتدبة المكلفة بالمساواة بين النساء والرجال ومكافحة التمييز، أورور بيرجي، تقاسم أدوات التكوين والخبرات بين البلدين، وتنظيم دورات تكوينية حول …', 'size': 2}, {'id': '245', 'title': 'مراكش.. توقيع إعلان نوايا بين المغرب وفرنسا لتعزيز التعاون في مجال العنف ضد النساء', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/223445/', 'summary': 'مراكش.. توقيع إعلان نوايا بين المغرب وفرنسا لتعزيز التعاون في مجال العنف ضد النساء. و م ع وقع المغرب وفرنسا، اليوم الأربعاء بمراكش، إعلان نوايا يروم تعزيز التعاون الثنائي في مجال التكوين والوقاية من العنف ضد النساء. ويهم الإعلان الذي وقعته وزيرة التضامن والإدماج الاجتماعي والأسرة، نعيمة ابن يحيى، والوزيرة الفرنسية المنتدبة المكلفة بالمساواة بين النساء والرجال ومكافحة التمييز، أورور بيرجي، تقاسم أدوات التكوين والخبرات بين البلدين، وتنظيم', 'size': 2}], 'main_title': 'توقيع إعلان نوايا بين المغرب وفرنسا لتعزيز التعاون في مجال الوقاية من العنف ضد النساء'}, {'community_id': '5', 'articles': [{'id': '291', 'title': 'رئيس الحكومة يوقع قرار إعفاء إيمان بلمعطي مديرة "أنابيك"', 'source': 'www.hespress.com', 'link': 'https://www.hespress.com/%d8%b1%d8%a6%d9%8a%d8%b3-%d8%a7%d9%84%d8%ad%d9%83%d9%88%d9%85%d8%a9-%d9%8a%d9%88%d9%82%d8%b9-%d9%82%d8%b1%d8%a7%d8%b1-%d8%a5%d8%b9%d9%81%d8%a7%d8%a1-%d8%a5%d9%8a%d9%85%d8%a7%d9%86-%d8%a8%d9%84%d9%85-1582267.html', 'summary': 'رئيس الحكومة يوقع قرار إعفاء إيمان بلمعطي مديرة "أنابيك". كشف مصدر جيد الاطلاع أن عزيز أخنوش، رئيس الحكومة، وقّع على مرسوم إعفاء إيمان بلمعطي، المديرة العامة للوكالة الوطنية لإنعاش التشغيل والكفاءات “أنابيك”، باقتراح من يونس السكوري، وزير الإدماج الاقتصادي والمقاولة الصغرى والشغل والكفاءات؛ وذلك يوم 24 يونيو الجاري. وأكد المصدر عينه أن بلمعطي “تعدّ، بعد توقيع قائد الجهاز التنفيذي على القرار، معفية بصفة نهائية  رئيس الحكومة يوقع قرار إعفاء إيمان بلمعطي مديرة "أنابيك"     - هسبريس جريدة إلكترونية مغربية .', 'size': 2}, {'id': '382', 'title': 'أخنوش يؤشر على إعفاء بلمعطي من إدارة الوكالة الوطنية لإنعاش التشغيل', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1080777.html', 'summary': 'أخنوش يؤشر على إعفاء بلمعطي من إدارة الوكالة الوطنية لإنعاش التشغيل. علمت جريدة “العمق المغربي” الالكترونية من مصادر موثوقة، أن رئيس الحكومة عزيز أخنوش، وافق إعفاء إيمان بلمعطي المديرة العامة للوكالة الوطنية لإنعاش التشغيل والكفاءات (أنابيك) من مهامها، وذلك بناء على اقتراح من يونس السكوري وزير الإدماج الاقتصادي والمقاولة الصغرى والشغل والكفاءات. وحسب ما أوضحت مصادر الجريدة، فإن قرار إعفاء بلمعطي جاء عبر مرسوم حمل توقيع ظهرت المقالة أخنوش يؤشر على إعفاء بلمعطي من إدارة الوكالة الوطنية لإنعاش التشغيل  .', 'size': 2}], 'main_title': 'رئيس الحكومة يوقع قرار إعفاء إيمان بلمعطي مديرة "أنابيك"'}, {'community_id': '6', 'articles': [{'id': '331', 'title': 'هلال يدعو إلى تحمل المسؤولية الجماعية بشكل عاجل لحماية الشعوب من الفظائع', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/social/408241.html', 'summary': 'هلال يدعو إلى تحمل المسؤولية الجماعية بشكل عاجل لحماية الشعوب من الفظائع. أبرز الممثل الدائم للمغرب لدى منظمة الأمم المتحدة، السفير عمر هلال، بصفته رئيسا مشاركا لمجموعة الأصدقاء المعنية بمسؤولية الحماية، أمس الأربعاء بنيويورك، الحاجة العاجلة إلى', 'size': 2}, {'id': '373', 'title': 'الأمم المتحدة.. المغرب يدعو لحماية الشعوب من الفظائع', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1080824.html', 'summary': 'الأمم المتحدة.. المغرب يدعو لحماية الشعوب من الفظائع. أكد الممثل الدائم للمغرب لدى منظمة الأمم المتحدة، السفير عمر هلال، بصفته رئيسا مشاركا لمجموعة الأصدقاء المعنية بمسؤولية الحماية، أمس الأربعاء بنيويورك، الحاجة العاجلة إلى تحمل المسؤولية الجماعية من أجل حماية الشعوب من الفظائع. وفي كلمة باسم هذه المجموعة، التي تضم 54 دولة عضوا والاتحاد الأوروبي، خلال المناقشة السنوية للجمعية العامة الأممية بشأن مسؤولية الحماية، ظهرت المقالة الأمم المتحدة.. المغرب يدعو لحماية الشعوب من الفظائع  .', 'size': 2}, {'id': '401', 'title': 'بنيويورك.. هلال يدعو إلى تحمل المسؤولية الجماعية بشكل عاجل لحماية الشعوب من الفظائع', 'source': 'machahid24.com', 'link': 'https://machahid24.com/politique/467617.html', 'summary': 'بنيويورك.. هلال يدعو إلى تحمل المسؤولية الجماعية بشكل عاجل لحماية الشعوب من الفظائع. أبرز الممثل الدائم للمغرب لدى منظمة الأمم المتحدة، السفير عمر هلال، بصفته رئيسا مشاركا لمجموعة الأصدقاء المعنية بمسؤولية الحماية، أمس الأربعاء بنيويورك، الحاجة العاجلة إلى تحمل المسؤولية الجماعية من أجل حماية الشعوب من الفظائع.', 'size': 3}], 'main_title': 'بنيويورك.. هلال يدعو إلى تحمل المسؤولية الجماعية بشكل عاجل لحماية الشعوب من الفظائع'}, {'community_id': '1', 'articles': [{'id': '356', 'title': 'البرلمان يدخل على خط اقصاء نص فلسطين من امتحان ابتدائي بالدار البيضاء', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/316632/', 'summary': 'البرلمان يدخل على خط اقصاء نص فلسطين من امتحان ابتدائي بالدار البيضاء. أثار قرار المديرية الإقليمية للتربية الوطنية بالفداء مرس السلطان، التابعة لأكاديمية جهة الدار البيضاء سطات، جدلا واسعا، بعدما أقدمت على تغيير نص الانطلاق في امتحان اللغة العربية الموحد للسنة السادسة ابتدائي، دورة يونيو 2025، بسبب تطرقه للقضية الفلسطينية. برلمانيون ومتابعون للشأن التربوي اعتبروا أن هذه الخطوة “صادمة” و”مستفزة للمشاعر الوطنية”. القرار، الذي اتخذ في', 'size': 2}, {'id': '369', 'title': 'رفض “فلسطين” في امتحان بالدار البيضاء يصل إلى البرلمان', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-577109.html', 'summary': 'رفض “فلسطين” في امتحان بالدار البيضاء يصل إلى البرلمان. وصف عبد الصمد حيكر، عضو المجموعة النيابية للعدالة والتنمية، رفض المديرية الإقليمية للتربية الوطنية بالفداء مرس السلطان، بجهة الدار البيضاء سطات، اعتماد نصين للغة العربية في الامتحان الموحد الإقليمي للمستوى السادس ابتدائي دورة يونيو 2025، يتحدثان عن القضية الفلسطينية، بالقرار الصادم والغريب. جاء ذلك في سؤال كتابي وجهه لوزير التربية الوطنية والتعليم', 'size': 2}], 'main_title': 'البرلمان يدخل على خط اقصاء نص فلسطين من امتحان ابتدائي بالدار البيضاء'}, {'community_id': '2', 'articles': [{'id': '358', 'title': 'المغاربة يستعينون بقروض الابناك لمواجهة الغلاء', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/316626/', 'summary': 'المغاربة يستعينون بقروض الابناك لمواجهة الغلاء. أفاد بنك المغرب بان القروض الموجهة للقطاع غير المالي ارتفعت بنسبة 3,9 في الماية خلال الفصل الأول من سنة 2025. وأوضح بنك المغرب، في تقريره الأخير حول السياسة النقدية، الصادر عقب الاجتماع الفصلي الثاني لمجلسه برسم سنة 2025، ان هذا النمو يعزى إلى تسارع نمو القروض الموجهة للأسر من 2,3 في المائة إلى 2,6 في', 'size': 2}, {'id': '389', 'title': 'حجم القروض في ارتفاع مع تسارع لجوء الأسر إلى الاقتراض', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%ad%d8%ac%d9%85-%d8%a7%d9%84%d9%82%d8%b1%d9%88%d8%b6-%d9%81%d9%8a-%d8%a7%d8%b1%d8%aa%d9%81%d8%a7%d8%b9-%d9%85%d8%b9-%d8%aa%d8%b3%d8%a7%d8%b1%d8%b9-%d9%84%d8%ac%d9%88%d8%a1-%d8%a7%d9%84%d8%a3%d8%b3/', 'summary': 'حجم القروض في ارتفاع مع تسارع لجوء الأسر إلى الاقتراض. كشف بنك المغرب أن القروض الموجهة للقطاع غير المالي ارتفعت بنسبة 3,9 في المائة خلال الفصل الأول من سنة 2025. وأوضح بنك المغرب، في تقريره الأخير حول السياسة النقدية، الصادر عقب الاجتماع الفصلي الثاني لمجلسه برسم سنة 2025، أن هذا النمو يعزى إلى تسارع نمو القروض الموجهة للأسر من 2,3 في المائة إلى 2,6 في  حجم القروض في ارتفاع مع تسارع لجوء الأسر إلى الاقتراض     .', 'size': 3}, {'id': '426', 'title': 'ارتفاع القروض الموجهة للقطاع غير المالي بـ3,9%', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d8%b1%d8%aa%d9%81%d8%a7%d8%b9-%d8%a7%d9%84%d9%82%d8%b1%d9%88%d8%b6-%d8%a7%d9%84%d9%85%d9%88%d8%ac%d9%87%d8%a9-%d9%84%d9%84%d9%82%d8%b7%d8%a7%d8%b9-%d8%ba%d9%8a%d8%b1-%d8%a7%d9%84%d9%85%d8%a7/', 'summary': 'ارتفاع القروض الموجهة للقطاع غير المالي بـ3,9%. أفاد بنك المغرب بأن القروض الموجهة للقطاع غير المالي سجلت ارتفاعا بنسبة 3,9% خلال الربع الأول من سنة 2025. وأوضح البنك المركزي، في تقريره الأخير حول السياسة النقدية الصادر عقب الاجتماع الفصلي الثاني لمجلسه، أن هذا الارتفاع يعود بالأساس إلى تسارع وتيرة نمو القروض الممنوحة للأسر، التي انتقلت من 2,3% إلى 2,6%، وكذا …  ارتفاع القروض الموجهة للقطاع غير المالي بـ3,9%     .', 'size': 2}], 'main_title': 'حجم القروض في ارتفاع مع تسارع لجوء الأسر إلى الاقتراض'}, {'community_id': '0', 'articles': [{'id': '360', 'title': 'تثبيت كسوة الكعبة الجديدة على الجهات الأربع مع مطلع العام الهجري', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/316619/', 'summary': 'تثبيت كسوة الكعبة الجديدة على الجهات الأربع مع مطلع العام الهجري. شهد صحن المسجد الحرام، أمس الخميس، تثبيت كسوة الكعبة المشرفة الجديدة على الجهات الأربع، تزامنا مع دخول العام الهجري الجديد، وذلك بإشراف الهيئة العامة للعناية بشؤون المسجد الحرام والمسجد النبوي. وفور وصول الكسوة إلى المسجد الحرام، صباح اليوم، تولى الفريق الفني المختص مهمة نقلها مباشرة إلى الجهات الأربع للكعبة، حيث تم تثبيتها بإجراءات دقيقة، تتماشى', 'size': 2}, {'id': '428', 'title': 'تثبيت كسوة الكعبة الجديدة على الجهات الأربع', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d8%ab%d8%a8%d9%8a%d8%aa-%d9%83%d8%b3%d9%88%d8%a9-%d8%a7%d9%84%d9%83%d8%b9%d8%a8%d8%a9-%d8%a7%d9%84%d8%ac%d8%af%d9%8a%d8%af%d8%a9-%d8%b9%d9%84%d9%89-%d8%a7%d9%84%d8%ac%d9%87%d8%a7%d8%aa-%d8%a7/', 'summary': 'تثبيت كسوة الكعبة الجديدة على الجهات الأربع. شهد صحن المسجد الحرام، اليوم الخميس، تثبيت كسوة الكعبة المشرفة الجديدة على الجهات الأربع، تزامنا مع دخول العام الهجري الجديد. وتولى الفريق الفني المختص، فور وصول الكسوة إلى المسجد الحرام، صباح اليوم، مهمة نقلها مباشرة إلى الجهات الأربع للكعبة، حيث تم تثبيتها بإجراءات دقيقة، تتماشى مع المعايير الفنية والتنظيمية المعتمدة. وتم تنفيذ عملية …  تثبيت كسوة الكعبة الجديدة على الجهات الأربع     .', 'size': 2}], 'main_title': 'تثبيت كسوة الكعبة الجديدة على الجهات الأربع مع مطلع العام الهجري'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    