<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 23/08/2025 - 12h26</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '77', 'title': 'اختتام دورة تكوينية بأكادير لفائدة عسكريات من 14 دولة', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/divers/411453.html', 'summary': 'اختتام دورة تكوينية بأكادير لفائدة عسكريات من 14 دولة. اختتمت اليوم الجمعة، بمقر قيادة القوات المسلحة الملكية للمنطقة الجنوبية بأكادير، دورة تكوينية موجهة للنساء في عمليات الأمم المتحدة لحفظ السلام. وقد تميز حفل اختتام هذه', 'size': 2}, {'id': '194', 'title': 'عمليات الأمم المتحدة لحفظ السلام.. اختتام دورة تكوينية بأكادير لفائدة عسكريات من 14 دولة', 'source': 'machahid24.com', 'link': 'https://machahid24.com/politique/473399.html', 'summary': 'عمليات الأمم المتحدة لحفظ السلام.. اختتام دورة تكوينية بأكادير لفائدة عسكريات من 14 دولة. اختتمت اليوم الجمعة، بمقر قيادة القوات المسلحة الملكية للمنطقة الجنوبية بأكادير، دورة تكوينية موجهة للنساء في عمليات الأمم المتحدة لحفظ السلام.', 'size': 2}], 'main_title': 'اختتام دورة تكوينية بأكادير لفائدة عسكريات من 14 دولة'}, {'community_id': '1', 'articles': [{'id': '117', 'title': 'ورش تعزيزِ الكرامة.. ارتياح حقوقي لدخول العقوبات البديلة حيز التنفيذ', 'source': 'kifache.com', 'link': 'https://kifache.com/%d9%88%d8%b1%d8%b4-%d8%aa%d8%b9%d8%b2%d9%8a%d8%b2%d9%90-%d8%a7%d9%84%d9%83%d8%b1%d8%a7%d9%85%d8%a9-%d8%a7%d8%b1%d8%aa%d9%8a%d8%a7%d8%ad-%d8%ad%d9%82%d9%88%d9%82%d9%8a-%d9%84%d8%af%d8%ae%d9%88%d9%84/', 'summary': 'ورش تعزيزِ الكرامة.. ارتياح حقوقي لدخول العقوبات البديلة حيز التنفيذ. عبر المجلس الوطني لحقوق الإنسان عن ارتياحه لدخول القانون رقم 43.22 المتعلق بالعقوبات البديلة حيز التنفيذ اليوم الجمعة، مؤكدا أن نجاح هذا الورش رهين بمدى نجاعة تطبيقه وتوفير الإمكانيات اللازمة. صون كرامة الإنسان وأوضحت رئيسة المجلس، آمنة بوعياش، أن تبني العقوبات البديلة يمثل خطوة نوعية نحو تعزيز صون كرامة الإنسان، وترسيخ فلسفة إعادة التأهيل بدل', 'size': 2}, {'id': '146', 'title': 'بوعياش: العقوبات البديلة ثورة حقوقية تعزز كرامة الإنسان وتخفف اكتظاظ السجون', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-586115.html', 'summary': 'بوعياش: العقوبات البديلة ثورة حقوقية تعزز كرامة الإنسان وتخفف اكتظاظ السجون. عبر المجلس الوطني لحقوق الإنسان عن ارتياحه لدخول القانون رقم 43.22 المتعلق بالعقوبات البديلة حيز التنفيذ، يومه الجمعة، معتبرا أن هذه الخطوة تمثل “ورشا حقوقيا هاما في قلب نموذج دولة الحق والقانون”. وأكدت آمنة بوعياش، رئيسة المجلس الوطني لحقوق الإنسان، أن تعزيز صون كرامة الإنسان، والنهوض بفلسفة إعادة التأهيل بدل العقاب بالحرمان من', 'size': 2}], 'main_title': 'ورش تعزيزِ الكرامة.. ارتياح حقوقي لدخول العقوبات البديلة حيز التنفيذ'}, {'community_id': '4', 'articles': [{'id': '176', 'title': 'رئاسة النيابة العامة تصدر دليلا استرشاديا لتنفيذ العقوبات البديلة', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/282350-2/', 'summary': 'رئاسة النيابة العامة تصدر دليلا استرشاديا لتنفيذ العقوبات البديلة. أعلنت رئاسة النيابة العامة، اليوم الجمعة، عن إصدار دليل استرشادي موجه لقضاة النيابة العامة حول تنفيذ العقوبات البديلة، وذلك بالتزامن مع دخول القانون رقم 43.22 المتعلق بالعقوبات البديلة حيز التنفيذ إلى جانب مرسومه التطبيقي. دليل عملي لمواكبة إصلاح المنظومة الجنائية أوضح هشام البلاوي الوكيل العام للملك لدى محكمة النقض ورئيس النيابة العامة أن  رئاسة النيابة العامة تصدر دليلا استرشاديا لتنفيذ العقوبات البديلة     .', 'size': 3}, {'id': '217', 'title': 'رئاسة النيابة العامة تصدر دليلا استرشاديا لقضاة النيابة العامة حول تنفيذ العقوبات البديلة', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226245/', 'summary': 'رئاسة النيابة العامة تصدر دليلا استرشاديا لقضاة النيابة العامة حول تنفيذ العقوبات البديلة. أصدرت رئاسة النيابة العامة دليلا استرشاديا لقضاة النيابة العامة حول تنفيذ العقوبات البديلة، وذلك في إطار مواكبة تفعيل القانون رقم 43.22 المتعلق بالعقوبات البديلة والمرسوم التطبيقي له، الذي دخل حيز التنفيذ ابتداء من اليوم الجمعة 22 غشت 2025. وأوضح السيد هشام البلاوي، الوكيل العام للملك لدى محكمة النقض ورئيس النيابة العامة، في تقديمه للدليل', 'size': 3}, {'id': '225', 'title': 'رئاسة النيابة العامة تصدر دليلاً استرشادياً جديداً لقضاة النيابة حول تنفيذ العقوبات البديلة', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%b1%d8%a6%d8%a7%d8%b3%d8%a9-%d8%a7%d9%84%d9%86%d9%8a%d8%a7%d8%a8%d8%a9-%d8%a7%d9%84%d8%b9%d8%a7%d9%85%d8%a9-%d8%aa%d8%b5%d8%af%d8%b1-%d8%af%d9%84%d9%8a%d9%84%d8%a7%d9%8b-%d8%a7%d8%b3%d8%aa%d8%b1/', 'summary': 'رئاسة النيابة العامة تصدر دليلاً استرشادياً جديداً لقضاة النيابة حول تنفيذ العقوبات البديلة. أصدرت رئاسة النيابة العامة دليلا استرشاديا موجها لقضاة النيابة بشأن كيفية تنفيذ العقوبات البديلة، في إطار مواكبتها لتفعيل القانون رقم 43.22 المتعلق بالعقوبات البديلة، وكذا مرسومه التطبيقي، اللذين دخلا حيز التنفيذ ابتداء من اليوم الجمعة 22 غشت 2025. وفي هذا السياق، أبرز هشام البلاوي، الوكيل العام للملك لدى محكمة النقض ورئيس النيابة العامة، …  رئاسة النيابة العامة تصدر دليلاً استرشادياً جديداً لقضاة النيابة حول تنفيذ العقوبات البديلة     .', 'size': 3}], 'main_title': 'رئاسة النيابة العامة تصدر دليلا استرشاديا لتنفيذ العقوبات البديلة'}, {'community_id': '3', 'articles': [{'id': '272', 'title': 'حريق مهول يلتهم سوق السوق الأسبوعي بالريصاني', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411498.html', 'summary': 'حريق مهول يلتهم سوق السوق الأسبوعي بالريصاني. أفادت مصالح الوقاية المدنية أن حريقا اندلع، مساء أمس الجمعة، في محلات تجارية تقليدية بالسوق الأسبوعي المعروف بـ"ماتش" بمدينة الريصاني. وأوضح المصدر ذاته أن السلطات المحلية', 'size': 3}, {'id': '305', 'title': 'حريق مهول يلتهم سوقا تقليديا بالريصاني.. الوقاية المدنية تسيطر على النيران بدون خسائر بشرية', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1094639.html', 'summary': 'حريق مهول يلتهم سوقا تقليديا بالريصاني.. الوقاية المدنية تسيطر على النيران بدون خسائر بشرية. بالسوق الأسبوعي المعروف بـ"ماتش" بمدينة الريصاني ظهرت المقالة حريق مهول يلتهم سوقا تقليديا بالريصاني.. الوقاية المدنية تسيطر على النيران بدون خسائر بشرية  .', 'size': 3}, {'id': '312', 'title': 'الوقاية المدنية: لا خسائر بشرية في حريق السوق الأسبوعي بالريصاني', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d9%88%d9%82%d8%a7%d9%8a%d8%a9-%d8%a7%d9%84%d9%85%d8%af%d9%86%d9%8a%d8%a9-%d9%84%d8%a7-%d8%ae%d8%b3%d8%a7%d8%a6%d8%b1-%d8%a8%d8%b4%d8%b1%d9%8a%d8%a9-%d9%81%d9%8a-%d8%ad%d8%b1%d9%8a%d9%82/', 'summary': 'الوقاية المدنية: لا خسائر بشرية في حريق السوق الأسبوعي بالريصاني. أفادت مصالح الوقاية المدنية أن حريقا اندلع، مساء أمس الجمعة، في محلات تجارية تقليدية بالسوق الأسبوعي المعروف بـ"ماتش" بمدينة الريصاني. وأوضح المصدر ذاته أن السلطات المحلية ومصالح الوقاية المدنية، وفور إشعارها بالحادث، انتقلت إلى عين المكان لاتخاذ التدابير اللازمة لإخماد الحريق، حيث تمت تعبئة وسائل لوجستية ومادية مهمة، ولاسيما سيارات إسعاف وشاحنات صهريجية، بهدف تطويق  الوقاية المدنية: لا خسائر بشرية في حريق السوق الأسبوعي بالريصاني     .', 'size': 3}], 'main_title': 'حريق مهول يلتهم سوق السوق الأسبوعي بالريصاني'}, {'community_id': '2', 'articles': [{'id': '277', 'title': 'عرض أمن المواطنين وسلامة عناصر الشرطة لاعتداء وشيك.. القرطاس لتوقيف شخص في الريصاني', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%b9%d8%b1%d8%b6-%d8%a3%d9%85%d9%86-%d8%a7%d9%84%d9%85%d9%88%d8%a7%d8%b7%d9%86%d9%8a%d9%86-%d9%88%d8%b3%d9%84%d8%a7%d9%85%d8%a9-%d8%b9%d9%86%d8%a7%d8%b5%d8%b1-%d8%a7%d9%84%d8%b4%d8%b1%d8%b7%d8%a9/', 'summary': 'عرض أمن المواطنين وسلامة عناصر الشرطة لاعتداء وشيك.. القرطاس لتوقيف شخص في الريصاني. اضطر مفتش شرطة يعمل بالمفوضية الجهوية للأمن بمدينة الريصاني لاستخدام سلاحه الوظيفي، أمس الجمعة (22 غشت)، لتحييد الخطر الصادر عن شخص يبلغ من العمر 28 سنة، من ذوي السوابق القضائية العديدة، والذي كان في حالة اندفاع قوية وعرض أمن المواطنين وسلامة عناصر الشرطة لاعتداء وشيك باستعمال أداة حادة. وذكر مصدر أمني أن مصالح الشرطة بالريصاني', 'size': 4}, {'id': '311', 'title': 'الريصاني.. مفتش شرطة يضطر لاستخدام سلاحه الوظيفي', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d8%b1%d9%8a%d8%b5%d8%a7%d9%86%d9%8a-%d9%85%d9%81%d8%aa%d8%b4-%d8%b4%d8%b1%d8%b7%d8%a9-%d9%8a%d8%b6%d8%b7%d8%b1-%d9%84%d8%a7%d8%b3%d8%aa%d8%ae%d8%af%d8%a7%d9%85-%d8%b3%d9%84%d8%a7%d8%ad/', 'summary': 'الريصاني.. مفتش شرطة يضطر لاستخدام سلاحه الوظيفي. اضطر مفتش شرطة يعمل بالمفوضية الجهوية للأمن بمدينة الريصاني لاستخدام سلاحه الوظيفي، أمس الجمعة، لتحييد الخطر الصادر عن شخص يبلغ من العمر 28 سنة، من ذوي السوابق القضائية العديدة، والذي كان في حالة اندفاع قوية وعر ض أمن المواطنين وسلامة عناصر الشرطة لاعتداء وشيك باستعمال أداة حادة. وذكر مصدر أمني أن مصالح الشرطة بالريصاني كانت  الريصاني.. مفتش شرطة يضطر لاستخدام سلاحه الوظيفي     .', 'size': 4}, {'id': '324', 'title': 'الريصاني.. مفتش شرطة يستعمل السلاح الوظيفي لتحييد خطر ذي سوابق قضائية', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/473473.html', 'summary': 'الريصاني.. مفتش شرطة يستعمل السلاح الوظيفي لتحييد خطر ذي سوابق قضائية. اضطر مفتش شرطة يعمل بالمفوضية الجهوية للأمن بمدينة الريصاني لاستخدام سلاحه الوظيفي، أمس الجمعة، لتحييد الخطر الصادر عن شخص يبلغ من العمر 28 سنة، من ذوي السوابق القضائية العديدة، والذي كان في حالة اندفاع قوية وعرض أمن المواطنين وسلامة عناصر الشرطة لاعتداء وشيك باستعمال أداة حادة.', 'size': 4}, {'id': '336', 'title': 'الريصاني .. مفتش شرطة يفتح النار على صاحب سوابق عرّض أمن المواطنين وسلامة الشرطة لاعتداء وشيك', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/226251/', 'summary': 'الريصاني .. مفتش شرطة يفتح النار على صاحب سوابق عرّض أمن المواطنين وسلامة الشرطة لاعتداء وشيك. الريصاني – اضطر مفتش شرطة يعمل بالمفوضية الجهوية للأمن بمدينة الريصاني لاستخدام سلاحه الوظيفي، أمس الجمعة، لتحييد الخطر الصادر عن شخص يبلغ من العمر 28 سنة، من ذوي السوابق القضائية العديدة، والذي كان في حالة اندفاع قوية وعرّض أمن المواطنين وسلامة عناصر الشرطة لاعتداء وشيك باستعمال أداة حادة. وذكر مصدر أمني أن مصالح الشرطة بالريصاني', 'size': 4}], 'main_title': 'عرض أمن المواطنين وسلامة عناصر الشرطة لاعتداء وشيك.. القرطاس لتوقيف شخص في الريصاني'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    