<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 16/08/2025 - 12h23</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '5', 'articles': [{'id': '94', 'title': 'نشرة إنذارية: موجة حر مع "الشركي" وزخات رعدية من الجمعة إلى الاثنين بعدد من مناطق المملكة', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/national/411093.html', 'summary': 'نشرة إنذارية: موجة حر مع "الشركي" وزخات رعدية من الجمعة إلى الاثنين بعدد من مناطق المملكة. أفادت المديرية العامة للأرصاد الجوية بأنه يرتقب تسجيل موجة حر مع "الشركي"، من اليوم الجمعة إلى غاية الاثنين المقبل، وزخات رعدية مصحوبة بتساقط للبرد وبهبات', 'size': 2}, {'id': '177', 'title': 'موجة حر مع “الشركي” من الجمعة إلى الاثنين بعدد من مناطق المملكة', 'source': 'soltana.ma', 'link': 'https://soltana.ma/1357647.html', 'summary': 'موجة حر مع “الشركي” من الجمعة إلى الاثنين بعدد من مناطق المملكة. أفادت المديرية العامة للأرصاد الجوية بأنه يرتقب تسجيل موجة حر مع «الشركي»، من اليوم الجمعة إلى غاية الاثنين المقبل، وزخات رعدية مصحوبة بتساقط للبرد وبهبات رياح، اليوم، بعدد من مناطق المملكة. وأوضحت المديرية، في نشرة إنذارية من مستوى يقظة برتقالي، أنه من المرتقب تسجيل درجات حرارة تتراوح ما بين 42 و46 درجة، اليوم الجمعة، بكل', 'size': 2}], 'main_title': 'نشرة إنذارية: موجة حر مع "الشركي" وزخات رعدية من الجمعة إلى الاثنين بعدد من مناطق المملكة'}, {'community_id': '1', 'articles': [{'id': '114', 'title': 'مأساة تهز الجزائر .. سقوط حافلة من جسر تسبب في عدد من الوفيات والجرحى', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/world/411115.html', 'summary': 'مأساة تهز الجزائر .. سقوط حافلة من جسر تسبب في عدد من الوفيات والجرحى. هزّت فاجعة مروعة منطقة الحراش، شرقي العاصمة الجزائرية، مساء الجمعة، بعدما أودى حادث سير مميت بحياة 18 شخصا وأصاب 9 آخرين بجروح متفاوتة الخطورة، اثنان', 'size': 2}, {'id': '328', 'title': 'مقتل 18 شخصا غرقا بعد سقوط حافلة مسافرين بنهر وسط الجزائر العاصمة', 'source': 'almassaa.com', 'link': 'https://almassaa.com/%d9%85%d9%82%d8%aa%d9%84-18-%d8%b4%d8%ae%d8%b5%d8%a7-%d8%ba%d8%b1%d9%82%d8%a7-%d8%a8%d8%b9%d8%af-%d8%b3%d9%82%d9%88%d8%b7-%d8%ad%d8%a7%d9%81%d9%84%d8%a9-%d9%85%d8%b3%d8%a7%d9%81%d8%b1%d9%8a%d9%86/', 'summary': 'مقتل 18 شخصا غرقا بعد سقوط حافلة مسافرين بنهر وسط الجزائر العاصمة. المساء اليوم: لقي 18 شخصا مصرعهم غرقا وإصابة 9 آخرين، إثر حادث سقوط حافلة لنقل المسافرين، بوادي الحراش وسط العاصمة الجزائرية. وأعلن بيان للمديرية العامة للحماية المدنية (الدفاع المدني)، أن حافلة لنقل المسافرين انحرفت وسقطت', 'size': 2}], 'main_title': 'مأساة تهز الجزائر .. سقوط حافلة من جسر تسبب في عدد من الوفيات والجرحى'}, {'community_id': '4', 'articles': [{'id': '126', 'title': 'الطريق نحو الكرة الذهبية.. دور جديد ينتظر حكيمي', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d8%b7%d8%b1%d9%8a%d9%82-%d9%86%d8%ad%d9%88-%d8%a7%d9%84%d9%83%d8%b1%d8%a9-%d8%a7%d9%84%d8%b0%d9%87%d8%a8%d9%8a%d8%a9-%d8%af%d9%88%d8%b1-%d8%ac%d8%af%d9%8a%d8%af-%d9%8a%d9%86%d8%aa%d8%b8/', 'summary': 'الطريق نحو الكرة الذهبية.. دور جديد ينتظر حكيمي. يعيش نادي باريس سان جيرمان الفرنسي صيفا حافلا بالتغييرات على مستوى القيادة داخل الفريق، تغييرات قد تمنح الدولي المغربي أشرف حكيمي دفعة جديدة في مسيرته، وربما تقربه أكثر من سباق الكرة الذهبية 2025. وعلى مدى 5 مواسم، حمل المدافع البرازيلي ماركينيوس شارة القيادة، مستفيدا من ثقة المدرب لويس إنريكي وآلية التصويت داخل غرفة الملابس، وإلى', 'size': 2}, {'id': '311', 'title': 'تحولات في باريس تخدم حكيمي', 'source': 'www.alayam24.com', 'link': 'https://www.alayam24.com/articles-585176.html', 'summary': 'تحولات في باريس تخدم حكيمي. يشهد نادي باريس سان جيرمان تغييرات كبيرة على مستوى القيادة داخل الفريق هذا الصيف، في خطوة قد تعزز من فرص الدولي المغربي أشرف حكيمي في سباق الكرة الذهبية لعام 2025. فبعد خمسة مواسم قاد خلالها ماركينيوس الفريق واضعًا شارة القيادة، وفق نظام تصويت داخلي أقرّه المدرب لويس إنريكي بين لاعبي الفريق،', 'size': 2}], 'main_title': 'الطريق نحو الكرة الذهبية.. دور جديد ينتظر حكيمي'}, {'community_id': '0', 'articles': [{'id': '137', 'title': 'مصير المتهور بطل السياقة الاستعراضية بالقنيطرة', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321170/', 'summary': 'مصير المتهور بطل السياقة الاستعراضية بالقنيطرة. تمكنت عناصر المصلحة الولائية للشرطة القضائية بمدينة القنيطرة زوال اليوم الجمعة 15 غشت الجاري، من توقيف شخص يبلغ من العمر 27 سنة، يشتبه في تورطه في السياقة بطريقة استعراضية بالشارع العام وتعريض مستعملي الطريق للخطر. وكان المشتبه فيه قد أقدم على خوض سباقات غير مرخصة باستعمال سيارات على الطريق، فضلا عن سياقتها بسرعة مفرطة وبطريقة', 'size': 4}, {'id': '189', 'title': 'توقيف عشريني بالقنيطرة بسبب “السياقة الاستعراضية” بالشارع العام', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/472827.html', 'summary': 'توقيف عشريني بالقنيطرة بسبب “السياقة الاستعراضية” بالشارع العام. تمكنت عناصر المصلحة الولائية للشرطة القضائية بمدينة القنيطرة، زوال اليوم الجمعة 15 غشت الجاري، من توقيف شخص يبلغ من العمر 27 سنة يُشتبه في تورطه في السياقة بطريقة استعراضية بالشارع العام وتعريض مستعملي الطريق للخطر. وكان المشتبه فيه قد أقدم على خوض سباقات غير مرخصة باستعمال سيارات على الطريق، فضلا عن سياقتها بسرعة مفرطة وبطريقة …', 'size': 3}, {'id': '224', 'title': 'الأمن يتفاعل بسرعة مع شرائط فيديو ويطيح بعشريني متورط في السياقة الاستعراضية وتعريض الناس للخطر', 'source': 'www.cawalisse.com', 'link': 'https://www.cawalisse.com/225980/', 'summary': 'الأمن يتفاعل بسرعة مع شرائط فيديو ويطيح بعشريني متورط في السياقة الاستعراضية وتعريض الناس للخطر. تمكنت عناصر المصلحة الولائية للشرطة القضائية بمدينة القنيطرة، زوال اليوم الجمعة 15 غشت الجاري، من توقيف شخص يبلغ من العمر 27 سنة يُشتبه في تورطه في السياقة بطريقة استعراضية بالشارع العام وتعريض مستعملي الطريق للخطر. وكان المشتبه فيه قد أقدم على خوض سباقات غير مرخصة باستعمال سيارات على الطريق، فضلا عن سياقتها بسرعة مفرطة وبطريقة', 'size': 2}, {'id': '238', 'title': 'عرّض مستعملي الطريق للخطر.. السياقة الاستعراضية تتسبب في توقيف شاب بالقنيطرة', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%b9%d8%b1%d9%91%d8%b6-%d9%85%d8%b3%d8%aa%d8%b9%d9%85%d9%84%d9%8a-%d8%a7%d9%84%d8%b7%d8%b1%d9%8a%d9%82-%d9%84%d9%84%d8%ae%d8%b7%d8%b1-%d8%a7%d9%84%d8%b3%d9%8a%d8%a7%d9%82%d8%a9-%d8%a7%d9%84%d8%a7/', 'summary': 'عرّض مستعملي الطريق للخطر.. السياقة الاستعراضية تتسبب في توقيف شاب بالقنيطرة. تمكنت عناصر المصلحة الولائية للشرطة القضائية بمدينة القنيطرة زوال اليوم الجمعة (15 غشت)، من توقيف شخص يبلغ من العمر 27 سنة، يشتبه في تورطه في السياقة بطريقة استعراضية بالشارع العام وتعريض مستعملي الطريق للخطر. وكان المشتبه فيه قد أقدم على خوض سباقات غير مرخصة باستعمال سيارات على الطريق، فضلا عن سياقتها بسرعة مفرطة …  عرّض مستعملي الطريق للخطر.. السياقة الاستعراضية تتسبب في توقيف شاب بالقنيطرة     .', 'size': 3}], 'main_title': 'مصير المتهور بطل السياقة الاستعراضية بالقنيطرة'}, {'community_id': '3', 'articles': [{'id': '168', 'title': 'السياحة المغربية تحقق قفزة بـ13% في ليالي المبيت خلال النصف الأول من 2025', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d8%b3%d9%8a%d8%a7%d8%ad%d8%a9-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8%d9%8a%d8%a9-%d8%aa%d8%ad%d9%82%d9%82-%d9%82%d9%81%d8%b2%d8%a9-%d8%a8%d9%8013-%d9%81%d9%8a-%d9%84%d9%8a%d8%a7%d9%84%d9%8a/', 'summary': 'السياحة المغربية تحقق قفزة بـ13% في ليالي المبيت خلال النصف الأول من 2025. أفاد مرصد السياحة بأن معدل ليالي المبيت المسجَّلة في مؤسسات الإيواء السياحي المصنَّفة بالمغرب، ارتفع بنسبة 13% خلال النصف الأول من سنة 2025، مقارنة بالفترة نفسها من السنة الماضية. وأوضح المرصد، في تقرير حول إحصائيات السياحة بالمغرب لشهر يونيو 2025، أن هذا النمو يعزى إلى ارتفاع السياحة الوطنية بنسبة 5%، وارتفاع السياحة الدولية بنسبة 16%.  السياحة المغربية تحقق قفزة بـ13% في ليالي المبيت خلال النصف الأول من 2025     .', 'size': 2}, {'id': '282', 'title': 'السياحة بالمغرب.. ليالي المبيت ترتفع بـ13% في النصف الأول من 2025', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d8%b3%d9%8a%d8%a7%d8%ad%d8%a9-%d8%a8%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8-%d9%84%d9%8a%d8%a7%d9%84%d9%8a-%d8%a7%d9%84%d9%85%d8%a8%d9%8a%d8%aa-%d8%aa%d8%b1%d8%aa%d9%81%d8%b9-%d8%a8%d9%801/', 'summary': 'السياحة بالمغرب.. ليالي المبيت ترتفع بـ13% في النصف الأول من 2025. أفاد مرصد السياحة بأن معدل ليالي المبيت المسجلة بمؤسسات الإيواء السياحي المصنفة سجل ارتفاعا بـ13 في المائة برسم النصف الأول من سنة 2025 مقارنة بالفترة ذاتها من السنة الماضية. وأفاد المرصد، في وثيقة حول إحصائيات السياحة بالمغرب برسم شهر يونيو 2025، بأن هذا التطور يعزى إلى ارتفاع السياحة الوطنية بنسبة 5 في المائة، وارتفاع السياحة', 'size': 2}], 'main_title': 'السياحة المغربية تحقق قفزة بـ13% في ليالي المبيت خلال النصف الأول من 2025'}, {'community_id': '2', 'articles': [{'id': '193', 'title': 'في زيارة إلى شفشاون.. أطفال القدس يتعرفون على محطة من محطات تاريخ المغرب', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/472820.html', 'summary': 'في زيارة إلى شفشاون.. أطفال القدس يتعرفون على محطة من محطات تاريخ المغرب. و.م.ع قام أطفال القدس، أمس الخميس، في إطار فعاليات الدورة 16 للمخيم الصيفي المنظم لفائدتهم، تحت الرعاية السامية للملك محمد السادس، بزيارة لمدينة شفشاون، محطة من المحطات التي يقفون فيها على تاريخ المغرب طيلة إقامتهم بالمملكة. وتعتبر مدينة شفشاون محطة مهمة في برنامج دورة “حارة المغاربة” للمخيم الصيفي لأطفال القدس، تعرف خلالها الأطفال المقدسيون ومؤطروهم …', 'size': 2}, {'id': '240', 'title': 'شفشاون.. أطفال القدس يتعرفون على محطة مهمة من تاريخ المغرب', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%b4%d9%81%d8%b4%d8%a7%d9%88%d9%86-%d8%a3%d8%b7%d9%81%d8%a7%d9%84-%d8%a7%d9%84%d9%82%d8%af%d8%b3-%d9%8a%d8%aa%d8%b9%d8%b1%d9%81%d9%88%d9%86-%d8%b9%d9%84%d9%89-%d9%85%d8%ad%d8%b7%d8%a9-%d9%85%d9%87/', 'summary': 'شفشاون.. أطفال القدس يتعرفون على محطة مهمة من تاريخ المغرب. زار أطفال القدس، أمس الخميس 14 غشت الجاري، في إطار فعاليات الدورة 16 للمخيم الصيفي المنظم لفائدتهم، تحت الرعاية السامية للملك محمد السادس، مدينة شفشاون، محطة من المحطات التي يقفون فيها على تاريخ المغرب طيلة إقامتهم بالمملكة. وتعدّ مدينة شفشاون محطة مهمة في برنامج دورة “حارة المغاربة” للمخيم الصيفي لأطفال القدس، تعرف خلالها …  شفشاون.. أطفال القدس يتعرفون على محطة مهمة من تاريخ المغرب     .', 'size': 2}], 'main_title': 'في زيارة إلى شفشاون.. أطفال القدس يتعرفون على محطة من محطات تاريخ المغرب'}, {'community_id': '6', 'articles': [{'id': '319', 'title': 'حالة الطقس: موجة الحر مستمرة هذا السبت', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%ad%d8%a7%d9%84%d8%a9-%d8%a7%d9%84%d8%b7%d9%82%d8%b3-%d9%85%d9%88%d8%ac%d8%a9-%d8%a7%d9%84%d8%ad%d8%b1-%d9%85%d8%b3%d8%aa%d9%85%d8%b1%d8%a9-%d8%ae%d8%b0%d8%a7-%d8%a7%d9%84%d8%b3%d8%a8%d8%aa/', 'summary': 'حالة الطقس: موجة الحر مستمرة هذا السبت. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليوم السبت، أن يظل الطقس حارا إلى محليا حار شيئا ما بكل من السهول الداخلية الشمالية والوسطى، والجنوب الشرقي، وداخل سوس والأقاليم الجنوبية، وحارا نوعا ما بالمنطقة الشرقية. وسيلاحظ، خلال الصباح والليل، تشكل سحب منخفضة مرفوقة بكتل من الضباب بالقرب من سواحل المحيط الأطلسي وسواحل البحر الأبيض المتوسط.  حالة الطقس: موجة الحر مستمرة هذا السبت     .', 'size': 2}, {'id': '333', 'title': 'توقعات أحوال الطقس اليوم السبت', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%aa%d9%88%d9%82%d8%b9%d8%a7%d8%aa-%d8%a3%d8%ad%d9%88%d8%a7%d9%84-%d8%a7%d9%84%d8%b7%d9%82%d9%8a-%d8%a7%d9%84%d9%8a%d9%88%d9%85-%d8%a7%d9%84%d8%b3%d8%a8%d8%aa/', 'summary': 'توقعات أحوال الطقس اليوم السبت. تتوقع المديرية العامة للأرصاد الجوية، بالنسبة ليومه السبت، أن يظل الطقس حارا إلى محليا حار شيئا ما بكل من السهول الداخلية الشمالية والوسطى، والجنوب الشرقي، وداخل سوس والأقاليم الجنوبية، وحارا نوعا ما بالمنطقة الشرقية. وسيلاحظ، خلال الصباح والليل، تشكل سحب منخفضة مرفوقة بكتل من الضباب بالقرب من سواحل المحيط الأطلسي وسواحل البحر الأبيض …  توقعات أحوال الطقس اليوم السبت     .', 'size': 2}], 'main_title': 'حالة الطقس: موجة الحر مستمرة هذا السبت'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    