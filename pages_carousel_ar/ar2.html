<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أهم الأخبار - Treemap Carousel</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.4.1/swiper-bundle.min.js"></script>
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
              
        }
        
        .swiper {
            width: 100%;
            height: 90vh;
            margin-top: 10px;
        }
        
        .swiper-slide {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 10px;
            width: calc(100% - 20px); /* Utilisez calc pour soustraire les marges */
            margin-left: auto;
            margin-right: auto;

        }
        
        .treemap-container {
           width: 100%;
            height: 100%;
            margin-bottom: 10px;
            direction: rtl; /* Changez rtl en ltr */
            position: relative;
          z-index: 1;

        }
        
        .community-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            position: relative;
              z-index: 10;
              padding: 10px;
              background: rgba(255, 255, 255, 0.8); /* Fond semi-transparent pour contraste */
              text-align: center;
        }
        
        .node {
            overflow: hidden;
            border: 1px solid white;
            position: absolute;
            transition: all 0.3s;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .node:hover {
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .node-content {
            padding: 8px;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .node-title {
            font-size: 14px;  
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .node-source {
            font-size: 12px;  
            color: #666;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            font-size: 16px; 
            max-width: 90%;
            width: 350px;
            color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            direction: rtl;
            text-align: right;
        }
        
        .tooltip-title {
            font-size: 16px;  
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tooltip-source {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .tooltip-summary {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .swiper-pagination {
            position: relative;
            bottom: 0;
            margin-top: 15px;
        }
        
        .swiper-pagination-bullet {
            width: 12px;
            height: 12px;
            background-color: #ccc;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .swiper-pagination-bullet-active {
            background-color: #007aff;
            opacity: 1;
            width: 20px;
            border-radius: 6px;
        }
        
        .swiper-button-next, .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.4);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .swiper-button-next:hover, .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 18px;
        }
        
        header {
            background-color: #333;
            color: white;
            text-align: center;
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media screen and (max-width: 768px) {
            .node-title {
                font-size: 14px;  
            }
            .node-source {
                font-size: 12px;  
            }
            .community-title {
                font-size: 16px;  
            }
            .tooltip {
                max-width: 90%;
                padding: 12px;
            }
            .tooltip-title {
                font-size: 16px;
            }
            .swiper-button-next, .swiper-button-prev {
                width: 36px;
                height: 36px;
            }
        }
    </style>
    
    
    
</head>
<body>
    <header> 
        <div class="header-title">أهم الأخبار لآخر 24 ساعة

</div>    
        <div class="header-subtitle"> آخر تحديث : 24/08/2025 - 12h23</div>  
    </header>
    
    

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="treemap-carousel"> </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        const treemapData = [{'community_id': '0', 'articles': [{'id': '63', 'title': 'الإثنين فاتح ربيع الأول في المغرب..وعيد المولد النبوي الشريف يوم 5 شتنبر', 'source': 'www.alahdat.net', 'link': 'https://www.alahdat.net/archives/205315', 'summary': 'الإثنين فاتح ربيع الأول في المغرب..وعيد المولد النبوي الشريف يوم 5 شتنبر. الأحداث من الرباط أعلنت وزارة الأوقاف والشؤون الإسلامية أن فاتح شهر ربيع الأول لعام 1447 هـ سيصادف يوم بعد غد الاثنين وعيد المولد النبوي يوم 12 ربيع الأول 1447 هـ موافق 05 شتنبر 2025 م. وذكرت الوزارة، في بلاغ لها، أنها راقبت هلال شهر ربيع الأول لعام 1447 هـ، مساء يوم السبت 29 صفر 1447', 'size': 2}, {'id': '169', 'title': 'ذكرى المولد النبوي تحل يوم 5 شتنبر بالمغرب', 'source': 'rue20.com', 'link': 'https://rue20.com/930744.html', 'summary': 'ذكرى المولد النبوي تحل يوم 5 شتنبر بالمغرب.  / الرباط أعلنت وزارة الأوقاف والشؤون الإسلامية أن فاتح شهر ربيع الأول لعام 1447 هـ سيصادف يوم بعد غد الاثنين وعيد المولد النبوي يوم 12 ربيع الأول 1447 هـ موافق 05 شتنبر 2025 م. وذكرت الوزارة، في بلاغ لها، أنها راقبت هلال شهر ربيع الأول لعام 1447 هـ، مساء يوم السبت 29 صفر الخبر ذكرى المولد النبوي تحل يوم 5 شتنبر بالمغرب  .', 'size': 3}, {'id': '172', 'title': 'وزارة الأوقاف تكشف تاريخ عيد المولد النبوي بالمغرب', 'source': 'machahid24.com', 'link': 'https://machahid24.com/home/473522.html', 'summary': 'وزارة الأوقاف تكشف تاريخ عيد المولد النبوي بالمغرب. أعلنت وزارة الأوقاف والشؤون الإسلامية، أن فاتح شهر ربيع الأول لعام 1447 هـ سيصادف يوم بعد غد الاثنين وعيد المولد النبوي يوم 12 ربيع الأول 1447 هـ موافق 05 شتنبر 2025 م.', 'size': 2}], 'main_title': 'ذكرى المولد النبوي تحل يوم 5 شتنبر بالمغرب'}, {'community_id': '1', 'articles': [{'id': '72', 'title': 'حريق مهول يلتهم سوق السوق الأسبوعي بالريصاني', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/society/411498.html', 'summary': 'حريق مهول يلتهم سوق السوق الأسبوعي بالريصاني. أفادت مصالح الوقاية المدنية أن حريقا اندلع، مساء أمس الجمعة، في محلات تجارية تقليدية بالسوق الأسبوعي المعروف بـ"ماتش" بمدينة الريصاني. وأوضح المصدر ذاته أن السلطات المحلية', 'size': 2}, {'id': '159', 'title': 'الوقاية المدنية: لا خسائر بشرية في حريق السوق الأسبوعي بالريصاني', 'source': 'ar.telquel.ma', 'link': 'https://ar.telquel.ma/%d8%a7%d9%84%d9%88%d9%82%d8%a7%d9%8a%d8%a9-%d8%a7%d9%84%d9%85%d8%af%d9%86%d9%8a%d8%a9-%d9%84%d8%a7-%d8%ae%d8%b3%d8%a7%d8%a6%d8%b1-%d8%a8%d8%b4%d8%b1%d9%8a%d8%a9-%d9%81%d9%8a-%d8%ad%d8%b1%d9%8a%d9%82/', 'summary': 'الوقاية المدنية: لا خسائر بشرية في حريق السوق الأسبوعي بالريصاني. أفادت مصالح الوقاية المدنية أن حريقا اندلع، مساء أمس الجمعة، في محلات تجارية تقليدية بالسوق الأسبوعي المعروف بـ"ماتش" بمدينة الريصاني. وأوضح المصدر ذاته أن السلطات المحلية ومصالح الوقاية المدنية، وفور إشعارها بالحادث، انتقلت إلى عين المكان لاتخاذ التدابير اللازمة لإخماد الحريق، حيث تمت تعبئة وسائل لوجستية ومادية مهمة، ولاسيما سيارات إسعاف وشاحنات صهريجية، بهدف تطويق  الوقاية المدنية: لا خسائر بشرية في حريق السوق الأسبوعي بالريصاني     .', 'size': 2}], 'main_title': 'حريق مهول يلتهم سوق السوق الأسبوعي بالريصاني'}, {'community_id': '2', 'articles': [{'id': '98', 'title': 'المنتخب المغربي يتعرف على خصمه في نصف نهائي "الشان"', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/sport/lionatlas/411525.html', 'summary': 'المنتخب المغربي يتعرف على خصمه في نصف نهائي "الشان". تعرف المنتخب المغربي على منافسه في نصف نهائي بطولة أمم إفريقيا للاعبين المحليين، حيث سيواجه المنتخب السنغالي يوم الثلاثاء المقبل على أرضية ملعب مانديلا الوطني،', 'size': 2}, {'id': '178', 'title': 'المنتخب المغربي يواجه السنغال في نصف نهائي “الشان”', 'source': 'machahid24.com', 'link': 'https://machahid24.com/sport/473506.html', 'summary': 'المنتخب المغربي يواجه السنغال في نصف نهائي “الشان”. يواجه المنتخب المغربي في مباراة نصف نهائي بطولة أمم إفريقيا للاعبين المحليين لكرة القدم 2024، منتخب السنغال.', 'size': 2}], 'main_title': 'المنتخب المغربي يتعرف على خصمه في نصف نهائي "الشان"'}, {'community_id': '4', 'articles': [{'id': '103', 'title': 'برأسية قوية.. رحيمي يمنح العين فوزًا مثيرًا في الوقت القاتل', 'source': 'www.akhbarona.com', 'link': 'https://www.akhbarona.com/sport/proplayers/411531.html', 'summary': 'برأسية قوية.. رحيمي يمنح العين فوزًا مثيرًا في الوقت القاتل. قاد اللاعب المغربي، الحسين رحيمي، فريقه "العين" للفوز على مضيفه "دبا الفجيرة" بنتيجة ثلاثة أهداف مقابل هدفين، في المباراة التي جمعتهما، اليوم السبت بملعب الفجيرة،', 'size': 2}, {'id': '108', 'title': 'الدوري الإماراتي.. المغربي الحسين رحيمي يقود “العين” للفوز على”دبا الفجيرة”', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d8%af%d9%88%d8%b1%d9%8a-%d8%a7%d9%84%d8%a5%d9%85%d8%a7%d8%b1%d8%a7%d8%aa%d9%8a-%d8%a7%d9%84%d9%85%d8%ba%d8%b1%d8%a8%d9%8a-%d8%a7%d9%84%d8%ad%d8%b3%d9%8a%d9%86-%d8%b1%d8%ad%d9%8a%d9%85/', 'summary': 'الدوري الإماراتي.. المغربي الحسين رحيمي يقود “العين” للفوز على”دبا الفجيرة”. قاد اللاعب المغربي، الحسين رحيمي، فريقه “العين” للفوز على مضيفه “دبا الفجيرة” بنتيجة ثلاثة أهداف مقابل هدفين، في المباراة التي جمعتهما، اليوم السبت بملعب الفجيرة، ضمن منافسات الجولة الثانية من الدوري الإماراتي “أدنوك للمحترفين” لكرة القدم. وسجل رحيمي، الذي دخل بديلا، هدف الفوز للعين في الدقيقة 90 + 6 د من ضربة رأسية قوية، مانحا', 'size': 2}], 'main_title': 'برأسية قوية.. رحيمي يمنح العين فوزًا مثيرًا في الوقت القاتل'}, {'community_id': '5', 'articles': [{'id': '110', 'title': 'دراسة حديثة.. باحثون يطورون تقنية لتسريع الحقن الوريدي البطيء', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%af%d8%b1%d8%a7%d8%b3%d8%a9-%d8%ad%d8%af%d9%8a%d8%ab%d8%a9-%d8%a8%d8%a7%d8%ad%d8%ab%d9%88%d9%86-%d9%8a%d8%b7%d9%88%d8%b1%d9%88%d9%86-%d8%aa%d9%82%d9%86%d9%8a%d8%a9-%d9%84%d8%aa%d8%b3%d8%b1%d9%8a/', 'summary': 'دراسة حديثة.. باحثون يطورون تقنية لتسريع الحقن الوريدي البطيء. طور باحثون من جامعة ستانفورد الأمريكية تقنية جديدة تتيح الحقن السريع لأدوية كانت تتطلب في السابق حقنا وريديا بطيئا. وأكدت الدراسة، التي نشرتها مؤخرا دورية علوم الطب الانتقالي، وجود طريقة جديدة لتغليف البروتينات تتيح تخزينها بتركيزات عالية وتقديمها للمرضى باستخدام المحاقن العادية أو أجهزة الحقن الذاتي. وغلف الباحثون الجسيمات الصغيرة بمادة جديدة طورت خصيصا وتعرف', 'size': 2}, {'id': '277', 'title': 'تطوير تقنية لتسريع الحقن الوريدي البطيء', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321584/', 'summary': 'تطوير تقنية لتسريع الحقن الوريدي البطيء. طور باحثون من جامعة ستانفورد الأمريكية تقنية جديدة تتيح الحقن السريع لأدوية كانت تتطلب في السابق حقنا وريديا بطيئا. وأكدت الدراسة، التي نشرتها مؤخرا دورية علوم الطب الانتقالي، وجود طريقة جديدة لتغليف البروتينات تتيح تخزينها بتركيزات عالية وتقديمها للمرضى باستخدام المحاقن العادية أو أجهزة الحقن الذاتي. وغلف الباحثون الجسيمات الصغيرة بمادة جديدة طورت خصيصا وتعرف', 'size': 2}], 'main_title': 'دراسة حديثة.. باحثون يطورون تقنية لتسريع الحقن الوريدي البطيء'}, {'community_id': '7', 'articles': [{'id': '112', 'title': 'النيران تعود إلى إقليم شفشاون.. أتت على حوالي 80 هكتارا من غابة “بوهاشم”\u202c', 'source': 'kifache.com', 'link': 'https://kifache.com/%d8%a7%d9%84%d9%86%d9%8a%d8%b1%d8%a7%d9%86-%d8%aa%d8%b9%d9%88%d8%af-%d8%a5%d9%84%d9%89-%d8%a5%d9%82%d9%84%d9%8a%d9%85-%d8%b4%d9%81%d8%b4%d8%a7%d9%88%d9%86-%d8%a3%d8%aa%d8%aa-%d8%b9%d9%84%d9%89/', 'summary': 'النيران تعود إلى إقليم شفشاون.. أتت على حوالي 80 هكتارا من غابة “بوهاشم”\u202c. تواصل فرق الإطفاء بإقليم شفشاون جهودها بتنسيق مع السلطات المحلية والدرك الملكي والقوات المسلحة، اليوم السبت (23 غشت)، من أجل مواجهة الحريق الذي اندلع بغابة بوهاشم قرب من جماعة الدردارة بإقليم شفشاون. وأدت ألسنة النيران، وفق اللجنة الإقليمية لمحاربة الحرائق، إلى إتلاف حوالي 80 هكتارا من الغطاء الغابوي شملت مساحات من أشجار البلوط الفليني والأعشاب', 'size': 2}, {'id': '308', 'title': 'النيران تلتهم 80 هكتارا من غابة بوهاشم\u202c بإقليم شفشاون', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%a7%d9%84%d9%86%d9%8a%d8%b1%d8%a7%d9%86-%d8%aa%d9%84%d8%aa%d9%87%d9%85-80-%d9%87%d9%83%d8%aa%d8%a7%d8%b1%d8%a7-%d9%85%d9%86-%d8%ba%d8%a7%d8%a8%d8%a9-%d8%a8%d9%88%d9%87%d8%a7%d8%b4%d9%85/', 'summary': 'النيران تلتهم 80 هكتارا من غابة بوهاشم\u202c بإقليم شفشاون. اندلع حريق جديد بغابة بوهاشم القريبة من جماعة الدردارة بإقليم شفشاون، منذ يوم الخميس، ليعيد إلى الواجهة شبح الحرائق الذي بات يهدد غابات المنطقة بشكل متكرر. وحسب معطيات اللجنة الإقليمية لمحاربة الحرائق، فقد التهمت ألسنة النيران ما يقارب 80 هكتارا من المساحات الغابوية، أغلبها من أشجار البلوط الفليني والأعشاب الثانوية، فيما تبقى هذه …  النيران تلتهم 80 هكتارا من غابة بوهاشم\u202c بإقليم شفشاون     .', 'size': 2}], 'main_title': 'النيران تعود إلى إقليم شفشاون.. أتت على حوالي 80 هكتارا من غابة “بوهاشم”\u202c'}, {'community_id': '3', 'articles': [{'id': '221', 'title': 'طنجة.. توقيف شخصين يشتبه في تورطهما في قضية تتعلق بترويج المخدرات والمؤثرات العقلية', 'source': 'www.barlamane.com', 'link': 'https://www.barlamane.com/%d8%b7%d9%86%d8%ac%d8%a9-%d8%aa%d9%88%d9%82%d9%8a%d9%81-%d8%b4%d8%ae%d8%b5%d9%8a%d9%86-%d9%8a%d8%b4%d8%aa%d8%a8%d9%87-%d9%81%d9%8a-%d8%aa%d9%88%d8%b1%d8%b7%d9%87%d9%85%d8%a7-%d9%81%d9%8a-%d9%82/', 'summary': 'طنجة.. توقيف شخصين يشتبه في تورطهما في قضية تتعلق بترويج المخدرات والمؤثرات العقلية. تمكنت عناصر المصلحة الولائية للشرطة القضائية لولاية أمن طنجة بتاريخ 22 غشت الجاري من توقيف شخصين أحدهما من ذوي السوابق القضائية، وذلك للاشتباه في تورطهما في قضية تتعلق بترويج المخدرات والمؤثرات العقلية. وحسب مصدر أمني، جرى توقيف المعنيين بالأمر على مستوى المجمع السكني “ديار طنجة” حيث أسفرت عملية الضبط والتفتيش المنجزة في هذه …  طنجة.. توقيف شخصين يشتبه في تورطهما في قضية تتعلق بترويج المخدرات والمؤثرات العقلية     .', 'size': 2}, {'id': '223', 'title': 'قرارات جديدة للحد من تهور سائقي الدراجات النارية بجهة الشمال', 'source': 'www.alousboue.ma', 'link': 'https://www.alousboue.ma/123391/', 'summary': 'قرارات جديدة للحد من تهور سائقي الدراجات النارية بجهة الشمال. طنجة – الأسبوع شهدت جهة الشمال في السنوات الأخيرة ارتفاعاً مقلقاً في عدد حوادث السير الناتجة عن الاستعمال المتهور للدراجات النارية، حيث تحولت هذه الوسيلة من وسيلة نقل عملية إلى أداة للعبث والاستعراض، مما أدى إلى إزهاق أرواح بريئة وخلف إصابات خطيرة وعاهات مستديمة. وتعود أسباب هذه الحوادث بالأساس إلى الاستعراضات الخطيرة، والقيادة …  قرارات جديدة للحد من تهور سائقي الدراجات النارية بجهة الشمال     .', 'size': 2}], 'main_title': 'طنجة.. توقيف شخصين يشتبه في تورطهما في قضية تتعلق بترويج المخدرات والمؤثرات العقلية'}, {'community_id': '6', 'articles': [{'id': '272', 'title': 'وزارة المالية تدرب موظفيها على الأمازيغية والإنجليزية', 'source': 'aljarida24.ma', 'link': 'https://aljarida24.ma/p/actualites/321601/', 'summary': 'وزارة المالية تدرب موظفيها على الأمازيغية والإنجليزية. أطلقت وزارة الاقتصاد والمالية طلب عروض دولي يخصص أزيد من 2.6 مليون درهم لتنظيم دورات تكوينية حضورية لفائدة موظفيها. المشروع يتوزع على شقين أساسيين، وهو تعلم اللغة الأمازيغية واللغة الإنجليزية المهنية، بهدف تعزيز كفاءات الأطر الإدارية وطنيا ودوليا. الشق الأول من المبادرة يهم اللغة الأمازيغية بميزانية تناهز 864 ألف درهم، في إطار تفعيل الطابع الرسمي', 'size': 2}, {'id': '285', 'title': 'وزارة المالية تطلق صفقة ضخمة لتدريب موظفيها على التواصل بالأمازيغية والانجليزية', 'source': 'al3omk.com', 'link': 'https://al3omk.com/1094863.html', 'summary': 'وزارة المالية تطلق صفقة ضخمة لتدريب موظفيها على التواصل بالأمازيغية والانجليزية. أطلقت وزارة الاقتصاد والمالية طلب عروض دولي مفتوح يهدف إلى تنظيم دورات تكوينية حضورية لفائدة موظفيها، بميزانية تقديرية إجمالية تتجاوز 2.6 مليون درهم، وتتوزع على قسمين رئيسيين: الأول مخصص للتكوين في اللغة الأمازيغية، والثاني للغة الإنجليزية المهنية، في خطوة لتعزيز كفاءات أطر الوزارة على الصعيدين الوطني والدولي. وبحسب دفتر التحملات الذي اطلعت عليه “العمق”، قد ظهرت المقالة وزارة المالية تطلق صفقة ضخمة لتدريب موظفيها على التواصل بالأمازيغية والانجليزية  .', 'size': 2}], 'main_title': 'وزارة المالية تدرب موظفيها على الأمازيغية والإنجليزية'}];
        
        const tooltip = d3.select("#tooltip");
        
        const communityColors = d3.scaleOrdinal()
            .domain(treemapData.map(d => d.community_id))
            .range(d3.quantize(d3.interpolateRainbow, treemapData.length));
        
        let clickTimer = null;
        let clickCount = 0;
        
        function createTreemap(data, containerId) {
            const container = d3.select(`#${containerId}`);
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;
            
            const sources = [...new Set(data.articles.map(d => d.source))];
            const color = d3.scaleOrdinal()
                .domain(sources)
                .range(d3.quantize(d3.interpolateHcl("#007FFF", "#FFA500"), sources.length));
            
            
            
            const hierarchyData = {
                name: "root",
                children: data.articles
            };
            
            const root = d3.hierarchy(hierarchyData)
                .sum(d => d.size || 1)
                .sort((a, b) => b.value - a.value);
            
            const treemap = d3.treemap()
                .size([width, height])
                .padding(4)
                .round(true);
            
            treemap(root);
            
            const nodes = container.selectAll(".node")
                .data(root.leaves())
                .enter()
                .append("div")
                .attr("class", "node")
                .style("left", d => `${d.x0}px`)
                .style("top", d => `${d.y0}px`)
                .style("width", d => `${d.x1 - d.x0}px`)
                .style("height", d => `${d.y1 - d.y0}px`)
                .style("background-color", d => color(d.data.source))
                .on("click", function(event, d) {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        showTooltip(event, d);
                        
                        clickTimer = setTimeout(function() {
                            clickCount = 0;
                        }, 300);
                    } else {
                        // Double clic - ouvrir le lien
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        if (d.data.link && d.data.link !== "#") {
                            window.open(d.data.link, '_blank');
                        }
                    }
                })
                .on("mouseover", function(event, d) {
                    if (window.innerWidth > 768) {
                        showTooltip(event, d);
                    }
                })
                .on("mousemove", function(event) {
                    if (window.innerWidth > 768) {
                        moveTooltip(event);
                    }
                })
                .on("mouseout", function() {
                    if (window.innerWidth > 768 && clickCount === 0) {
                        hideTooltip();
                    }
                });
            
            nodes.append("div")
                .attr("class", "node-content")
                .html(d => `
                    <div class="node-title">${d.data.title ?  d.data.title : 'Sans titre'}</div>
                    <div class="node-source">${d.data.source}</div>
                `);
        }
        
        function showTooltip(event, d) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = d.data.summary || '';

            const cleanSummary = tempDiv.textContent || tempDiv.innerText || '';

            tooltip.style("opacity", 1)
                .html(`
                    <div class="tooltip-title">${d.data.title}</div>
                    <div class="tooltip-source">${d.data.source}</div>
                    <div class="tooltip-summary">${cleanSummary ? cleanSummary : ''}</div>
                `);

            moveTooltip(event);
        }
        
        function moveTooltip(event) {
            const tooltipNode = tooltip.node();
            const tooltipWidth = tooltipNode.offsetWidth;
            const tooltipHeight = tooltipNode.offsetHeight;
            
            let left = event.pageX + 15;
            let top = event.pageY + 15;
            
            if (left + tooltipWidth > window.innerWidth) {
                left = event.pageX - tooltipWidth - 15;
            }
            
            if (top + tooltipHeight > window.innerHeight) {
                top = event.pageY - tooltipHeight - 15;
            }
            
            if (window.innerWidth <= 768) {
                left = (window.innerWidth - tooltipWidth) / 2;
                top = window.scrollY + (window.innerHeight - tooltipHeight) / 3;
            }
            
            tooltip.style("left", `${left}px`)
                .style("top", `${top}px`);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !event.target.closest('.node') && 
                !event.target.closest('.tooltip')) {
                hideTooltip();
            }
        });
        
        function initCarousel() {
            const carouselContainer = document.getElementById('treemap-carousel');
            
            treemapData.forEach((data, index) => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                
                const title = document.createElement('div');
                title.className = 'community-title';
                title.textContent = data.main_title;
                slide.appendChild(title);
                
                const treemapContainer = document.createElement('div');
                treemapContainer.className = 'treemap-container';
                treemapContainer.id = `treemap-${data.community_id}`;
                slide.appendChild(treemapContainer);
                
                carouselContainer.appendChild(slide);
            });
            
            const swiper = new Swiper(".mySwiper", {
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                    
                },
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                spaceBetween: 30,
                
                keyboard: {
                    enabled: true,
                },
                grabCursor: true, 
                effect: "slide", 
                speed: 600, 
                loop: true, 
                spaceBetween: 30,
                on: {
                    slideChange: function() {
                        setTimeout(function() {
                            window.dispatchEvent(new Event('resize'));
                            hideTooltip();
                        }, 300);
                    }
                }
            });
            
            setTimeout(() => {
                treemapData.forEach(data => {
                    createTreemap(data, `treemap-${data.community_id}`);
                });
            }, 300);
            
            window.addEventListener('resize', () => {
                treemapData.forEach(data => {
                    const container = document.getElementById(`treemap-${data.community_id}`);
                    container.innerHTML = ''; 
                    createTreemap(data, `treemap-${data.community_id}`);
                });
                hideTooltip();
            });
        }
        
        window.addEventListener('load', initCarousel);
        
    </script>
    
</body>



</html>
    